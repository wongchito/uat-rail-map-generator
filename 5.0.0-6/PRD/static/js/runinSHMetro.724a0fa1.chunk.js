"use strict";(self.webpackChunkrail_map_generator=self.webpackChunkrail_map_generator||[]).push([[1273],{3824:function(n,t,e){e.d(t,{Az:function(){return h},QE:function(){return d},ML:function(){return f},h6:function(){return m},LD:function(){return g},pS:function(){return p}});var r=e(885),i=e(5671),s=e(3144),a=e(2982),c=e(7762),l=e(4942),o=e(1413),u=e(713),h=function(n,t,e){return Object.keys(n).reduce((function(r,i){return(0,o.Z)((0,o.Z)({},r),{},(0,l.Z)({},i,n[i].children.reduce((function(r,s){return(0,o.Z)((0,o.Z)({},r),{},(0,l.Z)({},s,1+t(n,s)+e(n,i)))}),{})))}),{})},d=function n(t,e,r){if(t===e)return{len:0,nodes:[t]};var i=[],s=[];Object.keys(r[t]).forEach((function(a){var c=n(a,e,r);c.len<0||(i.push(r[t][a]+c.len),c.nodes.unshift(t),s.push(c.nodes))}));var a=Math.max.apply(Math,i);return{len:a,nodes:s[i.indexOf(a)]}},f=function(n,t,e){var r=d("linestart","lineend",t);if(r.nodes.includes(n))return d(r.nodes[1],n,t).len;for(var i=e.filter((function(t){return t.includes(n)}))[0],s=n;!r.nodes.includes(s);)s=i[i.indexOf(s)-1];for(var a=n;!r.nodes.includes(a);)a=i[i.indexOf(a)+1];var c="linestart"===s,l=[];return c||"lineend"===a?c?(l[0]=0,l[1]=d(r.nodes[1],a,t).len,l[2]=d(i[1],n,t).len,l[3]=d(n,a,t).len):(l[0]=d(r.nodes[1],s,t).len,l[1]=d(s,r.nodes.slice(-2)[0],t).len,l[2]=d(s,n,t).len,l[3]=d(n,i.slice(-2)[0],t).len):(l[0]=d(r.nodes[1],s,t).len,l[1]=d(s,a,t).len,l[2]=d(s,n,t).len,l[3]=d(n,a,t).len),l[0]+l[2]*l[1]/(l[2]+l[3])},m=function(n,t,e){var r;return console.log("computing stations' states"),(0,a.Z)(new Set((r=[]).concat.apply(r,(0,a.Z)(t)))).reduce((function(r,i){return(0,o.Z)((0,o.Z)({},r),{},(0,l.Z)({},i,i===n?0:(e===u.wA.right?function(n,t,e){var r,i=(0,c.Z)(e);try{for(i.s();!(r=i.n()).done;){var s=r.value,a=s.indexOf(n),l=s.indexOf(t);if(-1!==a&&a<l)return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(n,i,t):function(n,t,e){var r,i=(0,c.Z)(e);try{for(i.s();!(r=i.n()).done;){var s=r.value,a=s.indexOf(n),l=s.indexOf(t);if(-1!==l&&l<a)return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(n,i,t))?1:-1))}),{})},g=function(){function n(t){var e=this;(0,i.Z)(this,n),this.yShares={},this.xShares={},this.namePoss={},this.stnList={},this.criticalPath={},this.leftWideFactor=function(n){return 0},this.rightWideFactor=function(n){return 0},this.pathWeight=function(n,t){return e.stnList[n].children.includes(t)?1+e.rightWideFactor(n)+e.leftWideFactor(t):-1/0},this.pathTurnParams=function(n){var t=35-17.5*Math.sqrt(3),e=n-2*t;return{tr:35,dx_a:17.5,dy_a:t,dx_l:e*Math.sqrt(3),dy_l:e}},this.pathTurnSE=function(n){var t=e.pathTurnParams(n),r=t.tr,i=t.dx_a,s=t.dy_a,a=t.dx_l,c=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,1 ").concat(i,",").concat(s," l ").concat(a,",").concat(c," a ").concat(r,",").concat(r," 0 0,0 ").concat(i,",").concat(s)},this.pathTurnNE=function(n){var t=e.pathTurnParams(n),r=t.tr,i=t.dx_a,s=t.dy_a,a=t.dx_l,c=t.dy_l;return"a ".concat(r,",").concat(r," 0 0,0 ").concat(i,",").concat(-s," l ").concat(a,",").concat(-c," a ").concat(r,",").concat(r," 0 0,1 ").concat(i,",").concat(-s)},this.stnList=t.stnList,this.criticalPath=t.criticalPath}return(0,s.Z)(n,[{key:"getYShare",value:function(n,t){if(n in this.yShares)return this.yShares[n];if(["linestart","lineend"].includes(n)||this.stnList[n].parents.length>1||this.stnList[n].children.length>1)return this.yShares[n]=0,0;var e=this.stnList[n].parents[0];if(e){if(1===this.stnList[e].children.length){var r=this.getYShare(e);return this.yShares[n]=r,r}var i=0===this.stnList[e].children.indexOf(n)?1:-1;return this.yShares[n]=i,i}return this.yShares[n]=0,0}},{key:"_linePath",value:function(n,t,e,i,s,a,c,l){var o=this,u=(0,r.Z)([],3),h=u[0],d=u[1],f=u[2],m=[],g=this.pathTurnParams(a),p=g.dx_a+g.dx_l/2,x=(t[1]-t[0])/c.len*2,v=((t[1]-t[0])/c.len-2*p)/2;return v+x<0&&console.warn("SVG width too small! ".concat(v+x)),n.forEach((function(t){var r=i[t],c=s[t];if(!d&&0!==d)return h=t,f=r,d=c,void(1===n.length?m.push("M ".concat(r,",").concat(c)):e[0].includes(t)?e[0].includes(n[1])?m.push("M ".concat(r,",").concat(c)):(i[n[1]]>0&&m.push("M ".concat(r,",").concat(c+l)),s[n[1]]<0&&m.push("M ".concat(r,",").concat(c-l))):m.push("M ".concat(r,",").concat(c)));c>d?(m.push("h ".concat(0===c?r-f-x*o.leftWideFactor(t)-v-2*p:x*o.rightWideFactor(h)+v)),m.push(o.pathTurnSE(a))):c<d&&(m.push("h ".concat(0===c?r-f-x*o.leftWideFactor(t)-v-2*p:x*o.rightWideFactor(h)+v)),m.push(o.pathTurnNE(a))),m.push("H ".concat(r)),h=t,f=r,d=c})),m.join(" ").replace(/( H ([\d.]+))+/g," H $2")}}],[{key:"getYShares",value:function(n,t){console.log("computing y shares");var e=new this({stnList:n});return Object.keys(n).forEach((function(n){["linestart","lineend"].includes(n)||n in e.yShares||e.getYShare(n,t)})),e.yShares}},{key:"drawLine",value:function(n,t,e,r,i,s,a,c){var l=this,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:9.68,u={main:[],pass:[]};return n.forEach((function(h,d){var f=(h=h.filter((function(n){return!["linestart","lineend"].includes(n)}))).filter((function(n){return t[n]>=0})),m=h.filter((function(n){return t[n]<=0}));1===f.length&&(m=h),0===f.filter((function(n){return-1!==m.indexOf(n)})).length&&f.length&&(m[0]===h[0]?m.push(f[0]):f[0]===h[0]&&f[f.length-1]===h[h.length-1]&&m.length?(m=h,f=[]):m.unshift(f[f.length-1])),u.main.push(new l({stnList:e,criticalPath:c})._linePath(f,r,n,i,s,a,c,o)),u.pass.push(new l({stnList:e,criticalPath:c})._linePath(m,r,n,i,s,a,c,o))})),u}}]),n}(),p=function(n,t){var e=(n=n.filter((function(n){return!["linestart","lineend"].includes(n)}))).filter((function(n){return t[n]>=0})),r=n.filter((function(n){return t[n]<=0}));return 1===e.length&&(r=n),0===e.filter((function(n){return-1!==r.indexOf(n)})).length&&e.length&&(r[0]===n[0]?r.push(e[0]):e[0]===n[0]&&e[e.length-1]===n[n.length-1]&&r.length?(r=n,e=[]):r.unshift(e[e.length-1])),{main:e,pass:r}}},1401:function(n,t,e){e.d(t,{b:function(){return s},I:function(){return a}});var r=e(2982),i=e(3824),s=function(n,t){return n.map((function(n){var e=t.filter((function(t){return t.includes(n.from)&&t.includes(n.to)}));if(1!==e.length)return{linePath:[],colors:n.colors};var r=e.flat(),i=r.indexOf(n.from),s=r.indexOf(n.to);return{linePath:i<s?r.slice(i,s+1):r.slice(s,i+1),colors:n.colors}})).filter((function(n){return 0!==n.linePath.length}))},a=function(n,t){return n.map((function(n){var e=(0,i.pS)(n.linePath,t);return{main:[{linePath:e.main,colors:n.colors}],pass:[{linePath:e.pass,colors:n.colors}]}})).reduce((function(n,t){return n.main=[].concat((0,r.Z)(n.main),(0,r.Z)(t.main)),n.pass=[].concat((0,r.Z)(n.pass),(0,r.Z)(t.pass)),n}),{main:[],pass:[]})}},5387:function(n,t,e){e.r(t);var r=e(1413),i=e(5987),s=e(2982),a=e(2791),c=e(6169),l=e(6705),o=e(1401),u=e(184),h=["nextName"];t.default=function(){var n=(0,c.CG)((function(n){return n.helper})).routes,t=(0,c.CG)((function(n){return n.param})),e=t.svg_height-300,r=(0,a.useMemo)((function(){return n.filter((function(n){return n.includes(t.current_stn_idx)})).map((function(n){return n[n.indexOf(t.current_stn_idx)+("l"===t.direction?1:-1)]})).reduce((function(n,t){return n.includes(t)?n:n.concat(t)}),[])}),[n.toString(),t.current_stn_idx,t.direction]),i=(0,a.useMemo)((function(){return n.filter((function(n){return n.includes(t.current_stn_idx)})).map((function(n){return n[n.indexOf(t.current_stn_idx)+("l"===t.direction?-1:1)]})).reduce((function(n,t){return n.includes(t)?n:n.concat(t)}),[])}),[n.toString(),t.current_stn_idx,t.direction]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(d,{}),(0,u.jsx)("g",{transform:"translate(0,".concat(e,")"),children:(0,u.jsx)(f,{prevStnIds:r,nextStnIds:i})})]})};var d=(0,a.memo)((function(){return(0,u.jsxs)("defs",{children:[(0,u.jsx)("marker",{id:"slope",viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,u.jsx)("path",{d:"M0,0L1,1H-1z",fill:"var(--rmg-theme-colour)"})}),(0,u.jsxs)("filter",{id:"pujiang_outline_runin",colorInterpolationFilters:"sRGB",filterUnits:"userSpaceOnUse",x:"0",y:"-1000",width:"5000",height:"2000",children:[(0,u.jsx)("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"0",result:"e1"}),(0,u.jsx)("feMorphology",{operator:"erode",in:"SourceAlpha",radius:"1",result:"e2"}),(0,u.jsx)("feComposite",{in:"e1",in2:"e2",operator:"xor",result:"outline"}),(0,u.jsx)("feComposite",{in:"outline",in2:"SourceGraphic",operator:"over",result:"output"})]})]})})),f=function(n){var t=n.prevStnIds,e=n.nextStnIds,r=(0,c.CG)((function(n){return n.param})),i=r.info_panel_type,s=r.svgWidth,a=r.stn_list,l=s.runin/2,o=1===e.length&&["linestart","lineend"].includes(e[0]),h=1===t.length&&["linestart","lineend"].includes(t[0]),d=e.map((function(n){return a[n].name})),f=t.map((function(n){return a[n].name})),v=10+(e.length>1?-50*(d[0][0].split("\\").length-1)+-30*(d[0][1].split("\\").length-1):0),S=10+(t.length>1?-50*(f[0][0].split("\\").length-1)+-30*(f[0][1].split("\\").length-1):0);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(p,{prevStnIds:t,nextStnIds:e,nextBranchLineDy:v,prevBranchLineDy:S}),o&&"sh2020"!==i?(0,u.jsx)(m,{mode:"terminal",prevStnIds:t,nextStnIds:e}):h&&"sh2020"!==i?(0,u.jsx)(m,{mode:"original",prevStnIds:t,nextStnIds:e}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(g,{prevStnIds:t,nextStnIds:e}),(0,u.jsx)("g",{transform:"translate(".concat(l,",160)"),textAnchor:"middle",children:(0,u.jsx)(x,{})})]}),(h||!o)&&(0,u.jsx)(j,{stnIds:n.nextStnIds}),(o||!h)&&(0,u.jsx)(_,{stnIds:n.prevStnIds})]})},m=function(n){var t,e=n.mode,r=n.prevStnIds,i=n.nextStnIds,s=(0,c.CG)((function(n){return n.param})),a=s.current_stn_idx,l=s.theme,h=s.svgWidth,d=s.direction,f=s.coline,m=(0,c.CG)((function(n){return n.helper})).branches,g={l:{original:{x:h.runin-36,anchor:"end"},terminal:{x:36,anchor:"start"}},r:{original:{x:36,anchor:"start"},terminal:{x:h.runin-36,anchor:"end"}}},p=(0,o.b)(f,m),v="terminal"===e?r:i,_=i.length>1?"var(--rmg-theme-colour)":null!==(t=p.filter((function(n){return n.linePath.includes(a)&&n.linePath.includes(v[0])})).map((function(n){return n.colors[0][2]}))[0])&&void 0!==t?t:"var(--rmg-theme-colour)";return(0,u.jsxs)(u.Fragment,{children:["original"===e&&(0,u.jsx)("path",{transform:"translate(0,".concat(f.length?"198":"220",")").concat(f.length?"scale(1,2)":""),stroke:_,strokeWidth:12,d:"l"===d?"M ".concat(h.runin-24,",16 H 36"):"M24,16 H ".concat(h.runin-36),markerEnd:"url(#slope)"}),"terminal"===e&&(0,u.jsx)("g",{filter:"#999999"===l[2]?"url(#pujiang_outline_runin)":void 0,children:(0,u.jsx)("path",{transform:"translate(0,".concat(f.length?"198":"220",")").concat(f.length?"scale(1,2)":""),stroke:"var(--rmg-grey)",strokeWidth:12,d:"M24,16 H ".concat(h.runin-24)})}),(0,u.jsx)("g",{transform:"translate(".concat(g[d][e].x,",160)"),textAnchor:g[d][e].anchor,children:(0,u.jsx)(x,{})})]})},g=function(n){var t,e=n.prevStnIds,r=n.nextStnIds,i=(0,c.CG)((function(n){return n.param})),s=i.direction,a=i.svgWidth,h=i.theme,d=i.coline,f=i.current_stn_idx,m=i.stn_list,g=(0,c.CG)((function(n){return n.helper})).branches,p=a.runin/2,x=function(n){return n.includes("linestart")||n.includes("lineend")},v=(0,o.b)(d,g),_=r.length>1?"single":x(r)?v.filter((function(n){return[f,e[0]].every((function(t){return n.linePath.includes(t)}))})).length>0?"multiple":"single":[f,r[0]].every((function(n){return g[0].includes(n)}))&&v.filter((function(n){return[f,r[0]].every((function(t){return n.linePath.includes(t)}))})).length>0?"multiple":"single",j=x(r)?e:r,S=r.length>1?"var(--rmg-theme-colour)":null!==(t=v.filter((function(n){return n.linePath.includes(f)&&n.linePath.includes(j[0])})).map((function(n){return n.colors[0][2]}))[0])&&void 0!==t?t:"var(--rmg-theme-colour)",y=d.length>0&&function(n,t,e,r){return n.slice(1).filter((function(n){return[t,e[0]].every((function(t){return n.includes(t)}))})).filter((function(n){return(0,l.Qo)(n,r)})).length>0}(g,f,r,m)?S:"var(--rmg-theme-colour)",I=d.length>0&&1===r.length&&(!(!x(e)&&!x(r))||!([f,r[0]].every((function(n){return g[0].includes(n)}))&&0!==v.filter((function(n){return n.linePath.includes(f)&&n.linePath.includes(r[0])})).length)),P=d.length>0&&1===e.length;return(0,u.jsxs)("g",{transform:"translate(0,220)",strokeWidth:12,children:[(0,u.jsxs)(u.Fragment,{children:["var(--rmg-theme-colour)"!==y&&(0,u.jsx)("marker",{id:"slope_".concat(y),viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,u.jsx)("path",{d:"M0,0L1,1H-1z",fill:y})}),(0,u.jsx)("path",{stroke:y,d:"M ".concat(p,",16 H ").concat("l"===s?36:a.runin-36),markerEnd:"var(--rmg-theme-colour)"===y?"url(#slope)":"url(#slope_".concat(y,")"),transform:I?"translate(0,-22)scale(1,2)":void 0})]}),"multiple"===_&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("marker",{id:"slope_".concat(S),viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,u.jsx)("path",{d:"M0,0L1,1H-1z",fill:S})}),(0,u.jsx)("path",{stroke:S,d:"M ".concat(p,",16 H ").concat("l"===s?48:a.runin-48),markerEnd:"url(#slope_".concat(S,")"),transform:"translate(0,-12)"})]}),(0,u.jsx)("g",{filter:"#999999"===h[2]?"url(#pujiang_outline_runin)":void 0,transform:"translate(0,".concat(P?-22:0,")scale(1,").concat(P?2:1,")"),children:(0,u.jsx)("path",{stroke:"var(--rmg-grey)",d:"M ".concat(p,",16 H ").concat("l"===s?a.runin-24:24," ")})})]})},p=function(n){var t=n.prevStnIds,e=n.nextStnIds,r=n.nextBranchLineDy,i=n.prevBranchLineDy,s=(0,c.CG)((function(n){return n.param})),a=s.direction,l=s.svgWidth,h=s.current_stn_idx,d=s.coline,f=s.theme,m=(0,c.CG)((function(n){return n.helper})).branches,g=l.runin/2,p=125,x=function(n){return"".concat(n[0],",").concat(n[1])},v=function(n){return"M".concat(x(n.at(0))," ")+n.slice(1).map((function(n){return"L".concat(x(n))})).join(" ")},_="l"===a?[[l.runin/3,p],[l.runin/6,r],[36,r]]:[[l.runin/3*2,p],[l.runin/6*5,r],[l.runin-36,r]],j="l"===a?[[l.runin/3*2,p],[l.runin/6*5,i],[l.runin-24,i]]:[[l.runin/3,p],[l.runin/6,i],[24,i]],S="var(--rmg-theme-colour)";if(d.length>0){var y=(0,o.b)(d,m);e.length>1&&y.filter((function(n){return n.linePath.includes(h)&&e.some((function(t){return n.linePath.includes(t)}))}))&&(_[0][1]-=11,_.unshift([g,114]),S=y.filter((function(n){return n.linePath.includes(h)&&e.some((function(t){return n.linePath.includes(t)}))})).at(0).colors.at(0)[2]),t.length>1&&y.filter((function(n){return n.linePath.includes(h)&&t.some((function(t){return n.linePath.includes(t)}))}))&&(j[0][1]-=11,j.unshift([g,114]))}return(0,u.jsxs)("g",{transform:"translate(0,110)",strokeWidth:12,fill:"none",filter:"#999999"===f[2]?"url(#pujiang_outline_runin)":void 0,children:[(0,u.jsx)("marker",{id:"slope_branch",viewBox:"-1.5 0 3 1.5",refY:.5,children:(0,u.jsx)("path",{d:"M0,0L1,1H-1z",fill:S})}),e.length>1&&(0,u.jsx)("path",{stroke:S,d:v(_),markerEnd:"url(#slope_branch)"}),t.length>1&&(0,u.jsx)("path",{stroke:"var(--rmg-grey)",d:v(j)})]})},x=function(){var n=(0,c.CG)((function(n){return n.param})),t=n.stn_list[n.current_stn_idx].name;return(0,a.useMemo)((function(){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("text",{className:"rmg-name__zh",fontSize:112,children:t[0]}),(0,u.jsx)("text",{className:"rmg-name__en",fontSize:36,dy:50,children:t[1].replace("\\"," ")})]})}),(0,s.Z)(t))},v=function(n){var t=n.nextName,e=(0,i.Z)(n,h);return(0,u.jsx)("g",(0,r.Z)((0,r.Z)({},e),{},{children:(0,a.useMemo)((function(){return(0,u.jsxs)(u.Fragment,{children:[t[0].split("\\").map((function(n,e,r){return(0,u.jsx)("text",{className:"rmg-name__zh",fontSize:48,dy:-50*(r.length-1-e)-30*(t[1].split("\\").length-1),children:n},n)})),t[1].split("\\").map((function(n,t,e){return(0,u.jsx)("text",{className:"rmg-name__en",fontSize:24,dy:28+-30*(e.length-1-t),children:n},n)}))]})}),(0,s.Z)(t))}))},_=function(n){var t=(0,c.CG)((function(n){return n.param})),e=n.stnIds.map((function(n){return t.stn_list[n].name})),r=(n.stnIds.length>1?15:125)+-50*e.map((function(n){return n[0].split("\\").length})).reduce((function(n,t){return n+t}),-e.length)+-30*e.map((function(n){return n[1].split("\\").length})).reduce((function(n,t){return n+t}),-e.length),i=70+(n.stnIds.length>1?-50*(e[0][0].split("\\").length-1)+-30*(e[0][1].split("\\").length-1):0);return(0,u.jsxs)("g",{fill:"gray",textAnchor:"l"===t.direction?"end":"start",transform:"translate(".concat("l"===t.direction?t.svgWidth.runin-36:36,",0)"),children:[(0,u.jsx)(v,{nextName:e[0],transform:"translate(0,183)"}),n.stnIds.length>1&&(0,u.jsx)(v,{nextName:e[1],transform:"translate(0,".concat(i,")")}),(0,u.jsxs)("g",{transform:"translate(0, ".concat(r,")"),children:[(0,u.jsx)("text",{className:"rmg-name__zh",fontSize:22,children:"\u4e0a\u4e00\u7ad9"}),(0,u.jsx)("text",{className:"rmg-name__en",fontSize:12,dx:"l"===t.direction?-70:70,children:"Past Stop"})]})]})},j=function(n){var t=(0,c.CG)((function(n){return n.param})),e=n.stnIds.map((function(n){return t.stn_list[n].name})),r=(n.stnIds.length>1?15:125)+-50*e.map((function(n){return n[0].split("\\").length})).reduce((function(n,t){return n+t}),-e.length)+-30*e.map((function(n){return n[1].split("\\").length})).reduce((function(n,t){return n+t}),-e.length),i=70+(n.stnIds.length>1?-50*(e[0][0].split("\\").length-1)+-30*(e[0][1].split("\\").length-1):0);return(0,u.jsxs)("g",{textAnchor:"l"===t.direction?"start":"end",transform:"translate(".concat("l"===t.direction?36:t.svgWidth.runin-36,",0)"),children:[(0,u.jsx)(v,{nextName:t.stn_list[n.stnIds[0]].name,transform:"translate(0,183)"}),n.stnIds.length>1&&(0,u.jsx)(v,{nextName:t.stn_list[n.stnIds[1]].name,transform:"translate(0,".concat(i,")")}),(0,u.jsxs)("g",{transform:"translate(0, ".concat(r,")"),children:[(0,u.jsx)("text",{className:"rmg-name__zh",fontSize:22,children:"\u4e0b\u4e00\u7ad9"}),(0,u.jsx)("text",{className:"rmg-name__en",fontSize:12,dx:"l"===t.direction?70:-70,children:"Next Stop"})]})]})}}}]);
//# sourceMappingURL=runinSHMetro.724a0fa1.chunk.js.map