(this["webpackJsonprail-map-generator"]=this["webpackJsonprail-map-generator"]||[]).push([[76],{100:function(t,e,n){},111:function(t,e,n){"use strict";n.r(e);var a=n(36),r=n(0),c=n.n(r),s=n(11),i=(n(100),n(66)),l=n(44),o=n(83),b=n(84);i.a.use(o.a).use(b.a).use(l.e).init({fallbackLng:{"zh-CN":["zh-Hans","en"],"zh-Hant":["zh-HK","en"],"zh-HK":["zh-Hant","en"],"zh-TW":["zh-HK","zh-Hant"],default:["en"]},backend:{loadPath:"/RailMapGenerator/locale/{{lng}}.json"},interpolation:{escapeValue:!1}}).then((function(t){document.title=t("title"),document.documentElement.setAttribute("lang",i.a.language)}));var u=n(17),j=n(63),O=n(119),d=n(138),h=n(158),f=n(141),_=n(142),g=n(143),m=n(144),v=n(159),p=n(147),T=n(148),x=n(120),y=n(150),I=n(151),S=n(28),E=n(3),N=Object(d.a)((function(t){return Object(h.a)({rootLight:{backgroundColor:t.palette.primary.main},rootDark:{backgroundColor:t.palette.background.paper},title:{flexGrow:1,color:"#fff"},menuButton:{color:"#fff"}})})),A=function(){var t=Object(O.a)(),e=t.t,n=t.i18n,a=N(),c=Object(f.a)("(prefers-color-scheme: dark)");return r.useMemo((function(){return Object(E.jsx)(_.a,{position:"sticky",className:c?a.rootDark:a.rootLight,children:Object(E.jsxs)(g.a,{variant:"dense",children:[Object(E.jsx)(m.a,{variant:"h6",className:a.title,color:"textPrimary",children:"/RailMapGenerator".includes("uat")?e("titleUAT"):e("title")}),Object(E.jsx)(w,{}),Object(E.jsx)(R,{})]})})}),[c,n.language])},w=function(){var t=Object(O.a)().t,e=N(),n=r.useContext(S.a),a=n.canvasAvailable,c=n.setCanvasToShown,s=r.useState(null),i=Object(u.a)(s,2),l=i[0],o=i[1],b=function(t){return function(){c(t),o(null)}};return r.useMemo((function(){return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(v.a,{title:t("toggle.tooltip"),children:Object(E.jsx)(p.a,{onClick:function(t){return o(t.currentTarget)},className:e.menuButton,children:Object(E.jsx)(T.a,{children:"photo_library"})})}),Object(E.jsxs)(x.a,{anchorEl:l,open:Boolean(l),onClose:function(){return o(null)},children:[a.map((function(e){return Object(E.jsx)(y.a,{onClick:b(e),children:t("toggle."+e)},e)})),Object(E.jsx)(I.a,{style:{margin:"6px 0"}}),Object(E.jsx)(y.a,{onClick:b("all"),children:t("toggle.all")})]})]})}),[a.toString(),l,e.menuButton])},R=function(){var t=Object(O.a)().t,e=N(),n=r.useContext(S.a).setCanvasScale;return r.useMemo((function(){return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsx)(v.a,{title:t("zoom.out"),children:Object(E.jsx)(p.a,{onClick:function(){return n((function(t){return t<=.1?t:t-.1}))},className:e.menuButton,children:Object(E.jsx)(T.a,{children:"zoom_out"})})}),Object(E.jsx)(v.a,{title:t("zoom.in"),children:Object(E.jsx)(p.a,{onClick:function(){return n((function(t){return t+.1}))},className:e.menuButton,children:Object(E.jsx)(T.a,{children:"zoom_in"})})})]})}),[e.menuButton])},k=n(1),M=n(8),C=n(152),P=n(13),z=n(72),D=n(73),G=n(82),H=n(81),L=function(t){Object(G.a)(n,t);var e=Object(H.a)(n);function n(t){var a;return Object(z.a)(this,n),(a=e.call(this,t)).state={hasError:!1},a}return Object(D.a)(n,[{key:"componentDidCatch",value:function(t,e){}},{key:"render",value:function(){return this.state.hasError?Object(E.jsx)("h1",{children:"Something went wrong."}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(t){return{hasError:!0}}}]),n}(c.a.Component),B=n(52),U=Object(d.a)((function(){return Object(h.a)({root:{display:"flex",flexDirection:"row",overflowX:"scroll","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}}})})),F=function(){var t=U(),e=c.a.useContext(S.b).param,n=c.a.useContext(S.a).canvasScale,a=c.a.useCallback((function(t){var a;return{id:t,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",height:e.svg_height*n,viewBox:"0 0 ".concat(e.svgWidth[t]," ").concat(e.svg_height),colorInterpolationFilters:"sRGB",style:(a={},Object(M.a)(a,"--rmg-svg-width",e.svgWidth[t]+"px"),Object(M.a)(a,"--rmg-svg-height",e.svg_height+"px"),Object(M.a)(a,"--rmg-theme-colour",e.theme[2]),Object(M.a)(a,"--rmg-theme-fg",e.theme[3]),a)}}),[e.svg_height,JSON.stringify(e.svgWidth),e.theme[2],e.theme[3],n]);return Object(E.jsx)("div",{className:t.root,children:Object(E.jsxs)(P.d,{children:[Object.keys($).map((function(t){return Object(E.jsx)(P.b,{path:"/".concat(t),children:Object(E.jsx)(W,{rmgStyle:t,canvasAvailable:$[t],svgProps:a})},t)})),Object(E.jsx)(P.a,{to:"/"+(new URLSearchParams(window.location.search).get("style")||"mtr")})]})})},W=Object(r.memo)((function(t){var e=Object(r.useContext)(S.a),n=e.canvasToShown,s=e.setCanvasToShown,i=e.setCanvasAvailable;return Object(r.useEffect)((function(){["share"].concat(Object(a.a)(B.c)).forEach((function(e){e in t.canvasAvailable||"share"===e?document.getElementById("css_"+e).href="/RailMapGenerator"+"/styles/".concat(e,"_").concat(t.rmgStyle,".css"):document.getElementById("css_"+e).href=""})),i(Object.keys(t.canvasAvailable)),s((function(e){return["all"].concat(Object(a.a)(Object.keys(t.canvasAvailable))).includes(e)?e:"all"}))}),[]),Object(E.jsx)(E.Fragment,{children:Object.keys(t.canvasAvailable).map((function(e){return["all",e].includes(n)&&Object(E.jsx)(c.a.Suspense,{fallback:Object(E.jsx)(C.a,{}),children:Object(E.jsx)(L,{children:Object(E.jsxs)("svg",Object(k.a)(Object(k.a)({},t.svgProps(e)),{},{children:[Object(E.jsx)("rect",{id:"canvas-bg",fill:"white",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}}),t.canvasAvailable[e],Object(E.jsx)("rect",{id:"canvas-border",fill:"none",strokeWidth:3,stroke:"none",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}})]}))})},e)}))})})),Z=Object(r.lazy)((function(){return n.e(95).then(n.bind(null,303))})),J=Object(r.lazy)((function(){return n.e(92).then(n.bind(null,295))})),Y=Object(r.lazy)((function(){return n.e(74).then(n.bind(null,272))})),V=Object(r.lazy)((function(){return n.e(93).then(n.bind(null,296))})),X=Object(r.lazy)((function(){return n.e(75).then(n.bind(null,273))})),K=Object(r.lazy)((function(){return n.e(96).then(n.bind(null,274))})),q=Object(r.lazy)((function(){return n.e(94).then(n.bind(null,299))})),$={gzmtr:{runin:Object(E.jsx)(Z,{}),railmap:Object(E.jsx)(J,{})},mtr:{destination:Object(E.jsx)(Y,{}),railmap:Object(E.jsx)(V,{})},shmetro:{destination:Object(E.jsx)(X,{}),runin:Object(E.jsx)(K,{}),railmap:Object(E.jsx)(q,{})}},Q=F,tt=n(29),et=n(156),nt=n(153),at=r.lazy((function(){return Promise.all([n.e(0),n.e(3),n.e(4),n.e(85)]).then(n.bind(null,292))})),rt=r.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(72),n.e(82)]).then(n.bind(null,297))})),ct=r.lazy((function(){return Promise.all([n.e(0),n.e(1),n.e(3),n.e(4),n.e(77)]).then(n.bind(null,301))})),st=r.lazy((function(){return Promise.all([n.e(0),n.e(3),n.e(87)]).then(n.bind(null,291))})),it=r.lazy((function(){return n.e(81).then(n.bind(null,298))})),lt=Object(d.a)((function(t){var e;return Object(h.a)({root:Object(M.a)({display:"flex",flexDirection:"row",height:"100%"},t.breakpoints.down("xs"),{flexDirection:"column"}),typography:{background:t.palette.background.default},tab:(e={padding:"6px 24px",height:48,"& .MuiTab-wrapper":{flexDirection:"row"}},Object(M.a)(e,t.breakpoints.up("sm"),{"& .MuiTab-wrapper":{justifyContent:"flex-start"}}),Object(M.a)(e,t.breakpoints.down("xs"),{minWidth:"calc(100% / 5)"}),Object(M.a)(e,"&.MuiTab-labelIcon",{minHeight:"unset","& .MuiTab-wrapper":{"& > *:first-child":{marginBottom:0},"& > *:not(first-child)":{paddingLeft:8}}}),e),tabs:{overflow:"auto","&::-webkit-scrollbar":{width:0},scrollbarWidth:"none",WebkitOverflowScrolling:"touch"},tabpanel:{overflow:"auto",flex:1,padding:t.spacing(3),paddingBottom:0,height:"calc(100% - ".concat(t.spacing(3),"px)"),display:"flex",justifyContent:"center",alignItems:"flex-start"}})}));function ot(){var t=Object(O.a)(),e=t.t,n=t.i18n,a=lt(),c=Object(tt.a)(),s=Object(f.a)(c.breakpoints.down("xs")),i=r.useState(0),l=Object(u.a)(i,2),o=l[0],b=l[1],j=r.useMemo((function(){return Object(E.jsx)(m.a,{className:"".concat(a.typography," ").concat(a.tabs),component:"div",children:Object(E.jsx)(et.a,{value:o,orientation:s?"horizontal":"vertical",indicatorColor:"primary",textColor:"primary",onChange:function(t,e){return b(e)},variant:"scrollable",scrollButtons:"off",children:[["file","insert_drive_file"],["layout","panorama"],["design","brush"],["stations","directions_transit"],["info","info"]].map((function(t,n){return Object(E.jsx)(nt.a,{label:Object(E.jsx)("span",{children:e("tab."+t[0])}),icon:Object(E.jsx)(T.a,{children:t[1]}),className:a.tab},n)}))})})}),[o,n.language,a.tab,s]);return Object(E.jsxs)("div",{className:a.root,children:[j,Object(E.jsx)(m.a,{className:"".concat(a.typography," ").concat(a.tabpanel),component:"div",role:"tabpanel",children:Object(E.jsx)(r.Suspense,{fallback:Object(E.jsx)(C.a,{}),children:function(t){switch(t){case 0:return Object(E.jsx)(at,{});case 1:return Object(E.jsx)(rt,{});case 2:return Object(E.jsx)(ct,{});case 3:return Object(E.jsx)(st,{});case 4:return Object(E.jsx)(it,{});default:return Object(E.jsx)(at,{})}}(o)})})]})}function bt(){return Object(E.jsx)(r.Suspense,{fallback:Object(E.jsx)(C.a,{}),children:Object(E.jsx)(ot,{})})}var ut=n(49),jt=n(91),Ot=n(154),dt=n(155),ht=Object(jt.a)({palette:{type:"dark",primary:{main:"#bb86fc"},secondary:{main:"#018786"},error:{main:"#cf6679"}},overrides:{MuiDialog:{paper:{minWidth:280}}}}),ft=Object(jt.a)({palette:{primary:{light:"#bb86fc",main:"#6200ee"},secondary:{main:"#018786"},error:{main:"#b00020"}},overrides:{MuiDialog:{paper:{minWidth:280}}}});function _t(){var t=Object(f.a)("(prefers-color-scheme: dark)")?ht:ft,e=Object(r.useState)([]),n=Object(u.a)(e,2),a=n[0],s=n[1],i=Object(r.useState)(localStorage.rmgCanvas),l=Object(u.a)(i,2),o=l[0],b=l[1];Object(r.useEffect)((function(){return localStorage.setItem("rmgCanvas",o)}),[o]);var O=Object(r.useState)(Number(localStorage.rmgScale)>=.1?Number(localStorage.rmgScale):1),d=Object(u.a)(O,2),h=d[0],_=d[1];return Object(r.useEffect)((function(){return localStorage.setItem("rmgScale",h.toFixed(1))}),[h]),Object(E.jsx)(j.a,{basename:"/RailMapGenerator",children:Object(E.jsx)(Ot.a,{theme:t,children:Object(E.jsxs)(S.a.Provider,{value:{rmgStyle:window.location.pathname.split("/")[2],canvasAvailable:a,setCanvasAvailable:s,canvasToShown:o,setCanvasToShown:b,canvasScale:h,setCanvasScale:_},children:[Object(E.jsx)(c.a.Suspense,{fallback:Object(E.jsx)(dt.a,{}),children:Object(E.jsx)(A,{})}),Object(E.jsx)(mt,{})]})})})}var gt,mt=function(){var t=Object(r.useReducer)(S.c,JSON.parse(localStorage.rmgParam)),e=Object(u.a)(t,2),n=e[0],a=e[1],c=JSON.stringify(n);Object(r.useEffect)((function(){return localStorage.setItem("rmgParam",c)}),[c]);var s=Object.keys(n.stn_list).reduce((function(t,e){return t+e+function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(e,n){return e+JSON.stringify(t[n])}),"")}}("parents","children","branch")(n.stn_list[e])}),""),i=Object(r.useMemo)((function(){return Object(ut.a)(n.stn_list)}),[s]),l=Object(r.useMemo)((function(){return Object(ut.b)(n.stn_list)}),[s]),o=Object(ut.d)(i);return Object(E.jsxs)(E.Fragment,{children:[Object(E.jsxs)(S.b.Provider,{value:{param:n,dispatch:a,branches:i,routes:l,deps:s,tpo:o},children:[Object(E.jsx)("div",{style:{overflowY:"auto"},children:Object(E.jsx)(Q,{})}),Object(E.jsx)("div",{style:{flex:1,overflow:"hidden"},children:Object(E.jsx)(bt,{})})]}),Object(E.jsx)("canvas",{style:{display:"none"}})]})},vt=n(62);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)})),(gt=document.head).append.apply(gt,Object(a.a)(["share"].concat(Object(a.a)(B.c)).map((function(t){var e=document.createElement("link");return e.rel="stylesheet",e.id="css_"+t,e}))));var pt=function(){s.render(Object(E.jsx)(_t,{}),document.querySelectorAll("div#root")[0])};if(localStorage.rmgParam){try{Object(vt.c)()}catch(Tt){alert(Tt+"Something error! Please refresh to start from a new canvas. "),console.error(Tt),localStorage.removeItem("rmgParam")}pt()}else n.e(2).then(n.bind(null,217)).then((function(t){localStorage.setItem("rmgParam",JSON.stringify(t.default)),Object(vt.c)()})).then((function(){return pt()}))},28:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return l}));var a=n(8),r=n(1),c=n(0),s=Object(c.createContext)({}),i=Object(c.createContext)({}),l=function(t,e){var n,c,s,i,l,o;switch(e.type){case"GLOBAL":return e.data;case"ANY":return Object(r.a)(Object(r.a)({},t),{},Object(a.a)({},e.key,e.data));case"SET_HEIGHT":return Object(r.a)(Object(r.a)({},t),{},{svg_height:e.value});case"SET_WIDTH":return Object(r.a)(Object(r.a)({},t),{},{svgWidth:Object(r.a)(Object(r.a)({},t.svgWidth),{},Object(a.a)({},e.targetId,e.value))});case"SET_Y":return Object(r.a)(Object(r.a)({},t),{},{y_pc:e.value});case"SET_BRANCH_SPACING":return Object(r.a)(Object(r.a)({},t),{},{branch_spacing:e.value});case"SET_PADDING":return Object(r.a)(Object(r.a)({},t),{},{padding:e.value});case"SET_DIRECTION_GZ_X":return Object(r.a)(Object(r.a)({},t),{},{direction_gz_x:e.value});case"SET_DIRECTION_GZ_Y":return Object(r.a)(Object(r.a)({},t),{},{direction_gz_y:e.value});case"SET_LINE_NAME":return Object(r.a)(Object(r.a)({},t),{},{line_name:e.name});case"SET_THEME":return Object(r.a)(Object(r.a)({},t),{},{theme:e.theme});case"SET_DIRECTION":return Object(r.a)(Object(r.a)({},t),{},{direction:"l"===t.direction?"r":"l"});case"SET_PLATFORM":return Object(r.a)(Object(r.a)({},t),{},{platform_num:e.platform});case"SET_TEXT_STAGGER":return Object(r.a)(Object(r.a)({},t),{},{namePosMTR:Object(r.a)(Object(r.a)({},t.namePosMTR),{},{isStagger:e.checked})});case"SET_TEXT_FLIP":return Object(r.a)(Object(r.a)({},t),{},{namePosMTR:Object(r.a)(Object(r.a)({},t.namePosMTR),{},{isFlip:!t.namePosMTR.isFlip})});case"SET_DEST_LEGACY":return Object(r.a)(Object(r.a)({},t),{},{customiseMTRDest:Object(r.a)(Object(r.a)({},t.customiseMTRDest),{},{isLegacy:e.isLegacy})});case"SET_TERMINAL_OVERRIDE":return Object(r.a)(Object(r.a)({},t),{},{customiseMTRDest:Object(r.a)(Object(r.a)({},t.customiseMTRDest),{},{terminal:e.terminal})});case"SET_LINE_NUM":return Object(r.a)(Object(r.a)({},t),{},{line_num:e.num});case"SET_PSD_NUM":return Object(r.a)(Object(r.a)({},t),{},{psd_num:e.num});case"SET_PANEL_TYPE":return Object(r.a)(Object(r.a)({},t),{},{info_panel_type:e.variant});case"ADD_NOTE_GZMTR":return Object(r.a)(Object(r.a)({},t),{},{notesGZMTR:null===(n=t.notesGZMTR)||void 0===n?void 0:n.concat([["","",0,0,!1]])});case"REMOVE_NOTE_GZMTR":return Object(r.a)(Object(r.a)({},t),{},{notesGZMTR:null===(c=t.notesGZMTR)||void 0===c?void 0:c.filter((function(t,n){return n!==e.idx}))});case"UPDATE_NOTE_GZMTR":return Object(r.a)(Object(r.a)({},t),{},{notesGZMTR:null===(s=t.notesGZMTR)||void 0===s?void 0:s.map((function(t,n){return n===e.idx?e.note:t}))});case"SET_CURRENT_STATION":return Object(r.a)(Object(r.a)({},t),{},{current_stn_idx:e.stnId});case"REVERSE_STATIONS":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object.keys(t.stn_list).reduce((function(e,n){return Object(r.a)(Object(r.a)({},e),{},Object(a.a)({},n,function(e){switch(e){case"linestart":return Object(r.a)(Object(r.a)({},t.stn_list.lineend),{},{parents:[],children:t.stn_list.lineend.parents.slice().reverse(),branch:{left:[],right:t.stn_list.lineend.branch.left}});case"lineend":return Object(r.a)(Object(r.a)({},t.stn_list.linestart),{},{parents:t.stn_list.linestart.children.slice().reverse(),children:[],branch:{left:t.stn_list.linestart.branch.right,right:[]}});default:return Object(r.a)(Object(r.a)({},t.stn_list[e]),{},{parents:t.stn_list[e].children.map((function(t){return"linestart"===t?"lineend":"lineend"===t?"linestart":t})).reverse(),children:t.stn_list[e].parents.map((function(t){return"linestart"===t?"lineend":"lineend"===t?"linestart":t})).reverse(),branch:{left:t.stn_list[e].branch.right,right:t.stn_list[e].branch.left}})}}(n)))}),{})});case"UPDATE_STATION_NAME":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{name:e.name})))});case"UPDATE_STATION_SECONDARY_NAME":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{secondaryName:e.name})))});case"UPDATE_STATION_NUM":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{num:e.num})))});case"ADD_STATION_INTERCHANGE_INFO":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{transfer:Object(r.a)(Object(r.a)({},t.stn_list[e.stnId].transfer),{},{info:function(n){var a=n.setIdx,r=n.info,c=t.stn_list[e.stnId].transfer.info.slice();return c[a]=(c[a]||[]).concat([r]),c}(e)})})))});case"REMOVE_STATION_INTERCHANGE_INFO":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{transfer:Object(r.a)(Object(r.a)({},t.stn_list[e.stnId].transfer),{},{info:t.stn_list[e.stnId].transfer.info.map((function(t,n){return n===e.setIdx?t.slice(0,e.intIdx).concat(t.slice(e.intIdx+1)):t}))})})))});case"UPDATE_STATION_INTERCHANGE_INFO":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{transfer:Object(r.a)(Object(r.a)({},t.stn_list[e.stnId].transfer),{},{info:null===(i=t.stn_list[e.stnId].transfer)||void 0===i?void 0:i.info.map((function(t,n){return n===e.setIdx?t.map((function(t,n){return n===e.intIdx?[0,1,2,3,4,5].map((function(n){return void 0===e.info[n]?t[n]:e.info[n]})):t})):t}))})})))});case"UPDATE_STATION_OSI_NAME":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{transfer:Object(r.a)(Object(r.a)({},t.stn_list[e.stnId].transfer),{},{osi_names:[e.name]})})))});case"UPDATE_STATION_TICK_DIREC":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{transfer:Object(r.a)(Object(r.a)({},t.stn_list[e.stnId].transfer),{},{tick_direc:e.direction})})))});case"UPDATE_STATION_PAID_AREA":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{transfer:Object(r.a)(Object(r.a)({},t.stn_list[e.stnId].transfer),{},{paid_area:e.isPaid})})))});case"UPDATE_STATION_BRANCH_TYPE":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{branch:Object(r.a)(Object(r.a)({},t.stn_list[e.stnId].branch),{},Object(a.a)({},e.direction,[e.branchType,t.stn_list[e.stnId].branch[e.direction][1]]))})))});case"UPDATE_STATION_BRANCH_FIRST":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},(l={},Object(a.a)(l,e.branches[0].stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.branches[0].stnId]),{},{branch:Object(r.a)(Object(r.a)({},t.stn_list[e.branches[0].stnId].branch),{},Object(a.a)({},e.branches[0].direction,[t.stn_list[e.branches[0].stnId].branch[e.branches[0].direction][0],e.branches[0].first]))})),Object(a.a)(l,e.branches[1].stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.branches[1].stnId]),{},{branch:Object(r.a)(Object(r.a)({},t.stn_list[e.branches[1].stnId].branch),{},Object(a.a)({},e.branches[1].direction,[t.stn_list[e.branches[1].stnId].branch[e.branches[1].direction][0],e.branches[1].first]))})),l))});case"UPDATE_STATION_BRANCH_POS":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},(o={},Object(a.a)(o,e.left,Object(r.a)(Object(r.a)({},t.stn_list[e.left]),{},{parents:t.stn_list[e.left].parents.slice().reverse()})),Object(a.a)(o,e.right,Object(r.a)(Object(r.a)({},t.stn_list[e.right]),{},{children:t.stn_list[e.right].children.slice().reverse()})),o))});case"UPDATE_STATION_FACILITY":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{facility:e.facility})))});case"UPDATE_STATION_SERVICES":return Object(r.a)(Object(r.a)({},t),{},{stn_list:Object(r.a)(Object(r.a)({},t.stn_list),{},Object(a.a)({},e.stnId,Object(r.a)(Object(r.a)({},t.stn_list[e.stnId]),{},{services:Array.from(e.isChecked?new Set(t.stn_list[e.stnId].services).add(e.serviceId):t.stn_list[e.stnId].services.filter((function(t){return t!==e.serviceId})))})))});case"UPDATE_STATION_LIST":return Object(r.a)(Object(r.a)({},t),{},{stn_list:e.stnList});default:return t}}},49:function(t,e,n){"use strict";n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return l})),n.d(e,"d",(function(){return o}));var a=n(17),r=n(0),c=n.n(r),s=function t(e,n){if(["linestart","lineend"].includes(e)||n[e].parents.length>1||n[e].children.length>1)return 0;var a=n[e].parents[0];return a?1===n[a].children.length?t(a,n):0===n[a].children.indexOf(e)?1:-1:0},i=function(t){console.log("computing branches");for(var e=["linestart"],n=[["linestart"]],a=0;e.length;){var r=e.shift(),c=n[a].slice().reverse()[0]||null;for(c&&"linestart"!==r?n[a].push(r):n[a]=[r];"lineend"!==r;){var s=t[c=r].children;if(function(){switch(s.length){case 1:r=s[0];break;case 2:var i=t[c].branch.right[1];"through"===t[c].branch.right[0]?(n.push([r]),e.push(i)):0===a&&(n.push([c]),e.push(i)),r=s.filter((function(t){return t!==i}))[0]}}(),n[a].push(r),c===t[r].branch.left[1])break}a++}return n},l=function(t){console.log("computing routes");for(var e=["linestart"],n=[["linestart"]],a=0;e.length;){var r=e.shift(),c=n[a].slice().reverse()[0]||null;for(c&&"linestart"!==r?n[a].push(r):n[a]=[r];"lineend"!==r;){var s=t[c=r].children;if(function(){switch(s.length){case 1:r=s[0];break;case 2:var i=t[c].branch.right[1];"through"===t[c].branch.right[0]?(n.push(n[a].slice()),e.push(i)):0===a&&(n.push([c]),e.push(i)),r=s.filter((function(t){return t!==i}))[0]}}(),n[a].push(r),c===t[r].branch.left[1]&&"nonthrough"===t[r].branch.left[0])break}a++}return n},o=function(t){var e=c.a.useState([]),n=Object(a.a)(e,2),r=n[0],s=n[1];return c.a.useEffect((function(){if(console.log("computing tpo"),1!==t.length){var e=t.reduce((function(t,e){var n=t.indexOf(e.slice(-1)[0]);return t.slice(0,n).concat(e.slice(1),t.slice(n+1))}),["lineend"]).slice(0,-1);s(e)}else s(t[0].slice(1,-1))}),[t.toString()]),r}},52:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return c}));var a=["destination","runin","railmap"],r=["gz1","gz2otis","gz28","gz3","gz4","gz1421","gz5","gz6","gzgf"],c=["sh","sh2020"]},62:function(t,e,n){"use strict";n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return i}));var a=n(74),r=n(17);function c(){var t,e=JSON.parse(localStorage.rmgParam);"line_name"in e||(e.line_name=["\u8def\u7dda\u540d","Name of Line"]),"dest_legacy"in e||(e.dest_legacy=!1),delete e.fontZH,delete e.fontEN,delete e.weightZH,delete e.weightEN;for(var n=0,a=Object.entries(e.stn_list);n<a.length;n++){var c=Object(r.a)(a[n],2),s=c[0],i=c[1];"branch"in i||(e.stn_list[s].branch={left:[],right:[]},2===i.children.length?e.stn_list[s].branch.right=["through",i.children[1]]:e.stn_list[s].branch.right=[],2===i.parents.length?e.stn_list[s].branch.left=["through",i.parents[1]]:e.stn_list[s].branch.left=[])}e.psd_num="psd_num"in e?e.psd_num.toString():"1","line_num"in e||(e.line_num="1"),delete e.style,3===e.theme.length&&e.theme.push("#fff");for(var l=0,o=Object.entries(e.stn_list);l<o.length;l++){var b=Object(r.a)(o[l],2),u=b[0],j=b[1];"num"in j||(e.stn_list[u].num="00"),"interchange"in j&&j.interchange.map((function(t){return t.forEach((function(t){5===t.length&&t.splice(3,0,"#fff")}))}))}for(var O=0,d=Object.entries(e.stn_list);O<d.length;O++){var h=Object(r.a)(d[O],2),f=h[0],_=h[1];"osi22_end_p"===_.change_type&&(e.stn_list[f].change_type="osi22_pr"),"osi22_end_u"===_.change_type&&(e.stn_list[f].change_type="osi22_ur")}for(var g=0,m=Object.entries(e.stn_list);g<m.length;g++){var v=Object(r.a)(m[g],2),p=v[0];"interchange"in v[1]||(e.stn_list[p].interchange=[[]])}e.info_panel_type="info_panel_type"in e?function(t){switch(t){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return t}}(e.info_panel_type):"gz28","direction_gz_x"in e||(e.direction_gz_x=50),"direction_gz_y"in e||(e.direction_gz_y=70);for(var T=0,x=Object.entries(e.stn_list);T<x.length;T++){var y,I,S,E,N=Object(r.a)(x[T],2),A=N[0],w=N[1];if(!("transfer"in w))e.stn_list[A].transfer={tick_direc:"none"===w.change_type||"int2"===w.change_type?"r":null===(y=w.change_type)||void 0===y?void 0:y.split("_")[1].split("").slice().reverse()[0],paid_area:-1===(null===(I=w.change_type)||void 0===I?void 0:I.indexOf("osi"))||"p"===(null===(S=w.change_type)||void 0===S?void 0:S.split("_")[1][0]),osi_names:-1!==(null===(E=w.change_type)||void 0===E?void 0:E.indexOf("osi"))?[w.interchange[1][0]]:[],info:2===w.interchange.length?[w.interchange[0],w.interchange[1].slice(1)]:w.interchange};delete e.stn_list[A].change_type,delete e.stn_list[A].interchange}for(var R=0,k=Object.entries(e.stn_list);R<k.length;R++){var M=Object(r.a)(k[R],2),C=M[0],P=M[1];"services"in P||(e.stn_list[C].services=["local"]),"facility"in P||(e.stn_list[C].facility="usage"in P?P.usage:""),delete e.stn_list[C].usage}"customiseMTRDest"in e||(e.customiseMTRDest={isLegacy:e.dest_legacy||!1,terminal:!1}),delete e.dest_legacy,"svgWidth"in e||(e.svgWidth={destination:e.svg_dest_width,runin:e.svg_dest_width,railmap:e.svg_width}),delete e.svg_width,delete e.svg_dest_width,"notesGZMTR"in e||(e.notesGZMTR=[]),e.notesGZMTR=null===(t=e.notesGZMTR)||void 0===t?void 0:t.map((function(t){return 4===t.length?t.concat([!1]):t})),delete e.char_form,delete e.show_outer,delete e.strip_pc,delete e.txt_bg_gap,"namePosMTR"in e||(e.namePosMTR={isStagger:!0,isFlip:e.txt_flip}),delete e.txt_flip,Object.keys(e.stn_list).forEach((function(t){"secondaryName"in e.stn_list[t]?!1!==e.stn_list[t].secondaryName&&","===e.stn_list[t].secondaryName.join()&&(e.stn_list[t].secondaryName=!1):e.stn_list[t].secondaryName=!1,"type"in e.stn_list[t].transfer&&delete e.stn_list[t].transfer.type})),localStorage.setItem("rmgParam",JSON.stringify(e))}var s=function(t,e){var n,r=Object(a.a)(e);try{for(r.s();!(n=r.n()).done;){var c=n.value;if(t[c])return t[c]}}catch(s){r.e(s)}finally{r.f()}return t.en},i=function(t,e){return("gzmtr"===e?((null===t||void 0===t?void 0:t.num)||"-")+": ":"")+(null===t||void 0===t?void 0:t.name.join().replace("\\"," "))}}},[[111,97,98]]]);
//# sourceMappingURL=main.0cbf68f7.chunk.js.map