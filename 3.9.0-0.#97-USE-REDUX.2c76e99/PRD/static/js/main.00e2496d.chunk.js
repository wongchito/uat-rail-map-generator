(this["webpackJsonprail-map-generator"]=this["webpackJsonprail-map-generator"]||[]).push([[71],[,,,function(e,t){e.exports=React},function(e,t){e.exports=MaterialUI},function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"g",(function(){return l})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return b}));var r,a,c,s,i=n(2);!function(e){e.init="init",e.loading="loading",e.loaded="loaded",e.failed="failed"}(a||(a={})),function(e){e.MTR="mtr",e.GZMTR="gzmtr",e.SHMetro="shmetro"}(c||(c={})),function(e){e.Destination="destination",e.RunIn="runin",e.RailMap="railmap"}(s||(s={}));var o="all",l=(r={},Object(i.a)(r,c.MTR,[s.Destination,s.RailMap]),Object(i.a)(r,c.GZMTR,[s.RunIn,s.RailMap]),Object(i.a)(r,c.SHMetro,[s.Destination,s.RunIn,s.RailMap]),r),u=["gz1","gz2otis","gz28","gz3","gz4","gz1421","gz5","gz6","gzgf"],b=["sh","sh2020"]},,,function(e,t,n){"use strict";n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return b})),n.d(t,"i",(function(){return d})),n.d(t,"g",(function(){return j})),n.d(t,"j",(function(){return h})),n.d(t,"k",(function(){return f})),n.d(t,"h",(function(){return p})),n.d(t,"f",(function(){return _}));var r=n(6),a=n.n(r),c=n(9),s=n(5),i="SET_RMG_STYLE",o="SET_CANVAS_SCALE",l="SET_CANVAS_SCALE_STATUS",u="SET_CANVAS_TO_SHOW",b="SET_CANVAS_TO_SHOW_STATUS",d=function(e){return{type:i,rmgStyle:e}},j=function(e){return{type:o,canvasScale:e}},O=function(e){return{type:l,canvasScaleStatus:e}},h=function(){return function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(O(s.c.loading)),e.prev=1,r=Number((n().app.canvasScale+.1).toFixed(1)),t(j(r)),e.next=6,window.rmgStorage.writeFile("rmgScale",r.toString());case 6:t(O(s.c.loaded)),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),t(O(s.c.failed));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n){return e.apply(this,arguments)}}()},f=function(){return function(){var e=Object(c.a)(a.a.mark((function e(t,n){var r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t(O(s.c.loading)),e.prev=1,r=n().app.canvasScale,c=Number(r.toFixed(1))<=.1?Number(r.toFixed(1)):Number((r-.1).toFixed(1)),t(j(c)),e.next=7,window.rmgStorage.writeFile("rmgScale",c.toString());case 7:t(O(s.c.loaded)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),t(O(s.c.failed));case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,n){return e.apply(this,arguments)}}()},p=function(e){return{type:u,canvasToShow:e}},g=function(e){return{type:b,canvasToShowStatus:e}},_=function(e){return function(){var t=Object(c.a)(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n(g(s.c.loading)),t.prev=1,n(p(e)),t.next=5,window.rmgStorage.writeFile("rmgCanvas",e);case 5:n(g(s.c.loaded)),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),n(g(s.c.failed));case 11:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}()}},,function(e,t){e.exports=ReactRedux},function(e,t){e.exports=ReactI18next},,,function(e,t){e.exports=ReactRouterDOM},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i}));var r=n(2),a=n(0),c=n(3),s=Object(c.createContext)({}),i=function(e,t){var n,c,s,i,o,l;switch(t.type){case"GLOBAL":return t.data;case"ANY":return Object(a.a)(Object(a.a)({},e),{},Object(r.a)({},t.key,t.data));case"SET_HEIGHT":return Object(a.a)(Object(a.a)({},e),{},{svg_height:t.value});case"SET_WIDTH":return Object(a.a)(Object(a.a)({},e),{},{svgWidth:Object(a.a)(Object(a.a)({},e.svgWidth),{},Object(r.a)({},t.targetId,t.value))});case"SET_Y":return Object(a.a)(Object(a.a)({},e),{},{y_pc:t.value});case"SET_BRANCH_SPACING":return Object(a.a)(Object(a.a)({},e),{},{branch_spacing:t.value});case"SET_PADDING":return Object(a.a)(Object(a.a)({},e),{},{padding:t.value});case"SET_DIRECTION_GZ_X":return Object(a.a)(Object(a.a)({},e),{},{direction_gz_x:t.value});case"SET_DIRECTION_GZ_Y":return Object(a.a)(Object(a.a)({},e),{},{direction_gz_y:t.value});case"SET_LINE_NAME":return Object(a.a)(Object(a.a)({},e),{},{line_name:t.name});case"SET_THEME":return Object(a.a)(Object(a.a)({},e),{},{theme:t.theme});case"SET_DIRECTION":return Object(a.a)(Object(a.a)({},e),{},{direction:"l"===e.direction?"r":"l"});case"SET_PLATFORM":return Object(a.a)(Object(a.a)({},e),{},{platform_num:t.platform});case"SET_TEXT_STAGGER":return Object(a.a)(Object(a.a)({},e),{},{namePosMTR:Object(a.a)(Object(a.a)({},e.namePosMTR),{},{isStagger:t.checked})});case"SET_TEXT_FLIP":return Object(a.a)(Object(a.a)({},e),{},{namePosMTR:Object(a.a)(Object(a.a)({},e.namePosMTR),{},{isFlip:!e.namePosMTR.isFlip})});case"SET_DEST_LEGACY":return Object(a.a)(Object(a.a)({},e),{},{customiseMTRDest:Object(a.a)(Object(a.a)({},e.customiseMTRDest),{},{isLegacy:t.isLegacy})});case"SET_TERMINAL_OVERRIDE":return Object(a.a)(Object(a.a)({},e),{},{customiseMTRDest:Object(a.a)(Object(a.a)({},e.customiseMTRDest),{},{terminal:t.terminal})});case"SET_LINE_NUM":return Object(a.a)(Object(a.a)({},e),{},{line_num:t.num});case"SET_PSD_NUM":return Object(a.a)(Object(a.a)({},e),{},{psd_num:t.num});case"SET_PANEL_TYPE":return Object(a.a)(Object(a.a)({},e),{},{info_panel_type:t.variant});case"ADD_NOTE_GZMTR":return Object(a.a)(Object(a.a)({},e),{},{notesGZMTR:null===(n=e.notesGZMTR)||void 0===n?void 0:n.concat([["","",0,0,!1]])});case"REMOVE_NOTE_GZMTR":return Object(a.a)(Object(a.a)({},e),{},{notesGZMTR:null===(c=e.notesGZMTR)||void 0===c?void 0:c.filter((function(e,n){return n!==t.idx}))});case"UPDATE_NOTE_GZMTR":return Object(a.a)(Object(a.a)({},e),{},{notesGZMTR:null===(s=e.notesGZMTR)||void 0===s?void 0:s.map((function(e,n){return n===t.idx?t.note:e}))});case"SET_CURRENT_STATION":return Object(a.a)(Object(a.a)({},e),{},{current_stn_idx:t.stnId});case"REVERSE_STATIONS":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object.keys(e.stn_list).reduce((function(t,n){return Object(a.a)(Object(a.a)({},t),{},Object(r.a)({},n,function(t){switch(t){case"linestart":return Object(a.a)(Object(a.a)({},e.stn_list.lineend),{},{parents:[],children:e.stn_list.lineend.parents.slice().reverse(),branch:{left:[],right:e.stn_list.lineend.branch.left}});case"lineend":return Object(a.a)(Object(a.a)({},e.stn_list.linestart),{},{parents:e.stn_list.linestart.children.slice().reverse(),children:[],branch:{left:e.stn_list.linestart.branch.right,right:[]}});default:return Object(a.a)(Object(a.a)({},e.stn_list[t]),{},{parents:e.stn_list[t].children.map((function(e){return"linestart"===e?"lineend":"lineend"===e?"linestart":e})).reverse(),children:e.stn_list[t].parents.map((function(e){return"linestart"===e?"lineend":"lineend"===e?"linestart":e})).reverse(),branch:{left:e.stn_list[t].branch.right,right:e.stn_list[t].branch.left}})}}(n)))}),{})});case"UPDATE_STATION_NAME":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{name:t.name})))});case"UPDATE_STATION_SECONDARY_NAME":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{secondaryName:t.name})))});case"UPDATE_STATION_NUM":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{num:t.num})))});case"ADD_STATION_INTERCHANGE_INFO":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{transfer:Object(a.a)(Object(a.a)({},e.stn_list[t.stnId].transfer),{},{info:function(n){var r=n.setIdx,a=n.info,c=e.stn_list[t.stnId].transfer.info.slice();return c[r]=(c[r]||[]).concat([a]),c}(t)})})))});case"REMOVE_STATION_INTERCHANGE_INFO":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{transfer:Object(a.a)(Object(a.a)({},e.stn_list[t.stnId].transfer),{},{info:e.stn_list[t.stnId].transfer.info.map((function(e,n){return n===t.setIdx?e.slice(0,t.intIdx).concat(e.slice(t.intIdx+1)):e}))})})))});case"UPDATE_STATION_INTERCHANGE_INFO":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{transfer:Object(a.a)(Object(a.a)({},e.stn_list[t.stnId].transfer),{},{info:null===(i=e.stn_list[t.stnId].transfer)||void 0===i?void 0:i.info.map((function(e,n){return n===t.setIdx?e.map((function(e,n){return n===t.intIdx?[0,1,2,3,4,5].map((function(n){return void 0===t.info[n]?e[n]:t.info[n]})):e})):e}))})})))});case"UPDATE_STATION_OSI_NAME":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{transfer:Object(a.a)(Object(a.a)({},e.stn_list[t.stnId].transfer),{},{osi_names:[t.name]})})))});case"UPDATE_STATION_TICK_DIREC":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{transfer:Object(a.a)(Object(a.a)({},e.stn_list[t.stnId].transfer),{},{tick_direc:t.direction})})))});case"UPDATE_STATION_PAID_AREA":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{transfer:Object(a.a)(Object(a.a)({},e.stn_list[t.stnId].transfer),{},{paid_area:t.isPaid})})))});case"UPDATE_STATION_BRANCH_TYPE":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{branch:Object(a.a)(Object(a.a)({},e.stn_list[t.stnId].branch),{},Object(r.a)({},t.direction,[t.branchType,e.stn_list[t.stnId].branch[t.direction][1]]))})))});case"UPDATE_STATION_BRANCH_FIRST":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},(o={},Object(r.a)(o,t.branches[0].stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.branches[0].stnId]),{},{branch:Object(a.a)(Object(a.a)({},e.stn_list[t.branches[0].stnId].branch),{},Object(r.a)({},t.branches[0].direction,[e.stn_list[t.branches[0].stnId].branch[t.branches[0].direction][0],t.branches[0].first]))})),Object(r.a)(o,t.branches[1].stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.branches[1].stnId]),{},{branch:Object(a.a)(Object(a.a)({},e.stn_list[t.branches[1].stnId].branch),{},Object(r.a)({},t.branches[1].direction,[e.stn_list[t.branches[1].stnId].branch[t.branches[1].direction][0],t.branches[1].first]))})),o))});case"UPDATE_STATION_BRANCH_POS":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},(l={},Object(r.a)(l,t.left,Object(a.a)(Object(a.a)({},e.stn_list[t.left]),{},{parents:e.stn_list[t.left].parents.slice().reverse()})),Object(r.a)(l,t.right,Object(a.a)(Object(a.a)({},e.stn_list[t.right]),{},{children:e.stn_list[t.right].children.slice().reverse()})),l))});case"UPDATE_STATION_FACILITY":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{facility:t.facility})))});case"UPDATE_STATION_SERVICES":return Object(a.a)(Object(a.a)({},e),{},{stn_list:Object(a.a)(Object(a.a)({},e.stn_list),{},Object(r.a)({},t.stnId,Object(a.a)(Object(a.a)({},e.stn_list[t.stnId]),{},{services:Array.from(t.isChecked?new Set(e.stn_list[t.stnId].services).add(t.serviceId):e.stn_list[t.stnId].services.filter((function(e){return e!==t.serviceId})))})))});case"UPDATE_STATION_LIST":return Object(a.a)(Object(a.a)({},e),{},{stn_list:t.stnList});default:return e}}},,,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return l}));var r=n(7),a=n(3),c=n.n(a),s=function e(t,n){if(["linestart","lineend"].includes(t)||n[t].parents.length>1||n[t].children.length>1)return 0;var r=n[t].parents[0];return r?1===n[r].children.length?e(r,n):0===n[r].children.indexOf(t)?1:-1:0},i=function(e){console.log("computing branches");for(var t=["linestart"],n=[["linestart"]],r=0;t.length;){var a=t.shift(),c=n[r].slice().reverse()[0]||null;for(c&&"linestart"!==a?n[r].push(a):n[r]=[a];"lineend"!==a;){var s=e[c=a].children;if(function(){switch(s.length){case 1:a=s[0];break;case 2:var i=e[c].branch.right[1];"through"===e[c].branch.right[0]?(n.push([a]),t.push(i)):0===r&&(n.push([c]),t.push(i)),a=s.filter((function(e){return e!==i}))[0]}}(),n[r].push(a),c===e[a].branch.left[1])break}r++}return n},o=function(e){console.log("computing routes");for(var t=["linestart"],n=[["linestart"]],r=0;t.length;){var a=t.shift(),c=n[r].slice().reverse()[0]||null;for(c&&"linestart"!==a?n[r].push(a):n[r]=[a];"lineend"!==a;){var s=e[c=a].children;if(function(){switch(s.length){case 1:a=s[0];break;case 2:var i=e[c].branch.right[1];"through"===e[c].branch.right[0]?(n.push(n[r].slice()),t.push(i)):0===r&&(n.push([c]),t.push(i)),a=s.filter((function(e){return e!==i}))[0]}}(),n[r].push(a),c===e[a].branch.left[1]&&"nonthrough"===e[a].branch.left[0])break}r++}return n},l=function(e){var t=c.a.useState([]),n=Object(r.a)(t,2),a=n[0],s=n[1];return c.a.useEffect((function(){if(console.log("computing tpo"),1!==e.length){var t=e.reduce((function(e,t){var n=e.indexOf(t.slice(-1)[0]);return e.slice(0,n).concat(t.slice(1),e.slice(n+1))}),["lineend"]).slice(0,-1);s(t)}else s(e[0].slice(1,-1))}),[e.toString()]),a}},,function(e,t){e.exports=Redux},function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(23),a=n(7),c=n(5),s=function(e){var t;"line_name"in e||(e.line_name=["\u8def\u7dda\u540d","Name of Line"]),"dest_legacy"in e||(e.dest_legacy=!1),delete e.fontZH,delete e.fontEN,delete e.weightZH,delete e.weightEN;for(var n=0,r=Object.entries(e.stn_list);n<r.length;n++){var c=Object(a.a)(r[n],2),s=c[0],i=c[1];"branch"in i||(e.stn_list[s].branch={left:[],right:[]},2===i.children.length?e.stn_list[s].branch.right=["through",i.children[1]]:e.stn_list[s].branch.right=[],2===i.parents.length?e.stn_list[s].branch.left=["through",i.parents[1]]:e.stn_list[s].branch.left=[])}e.psd_num="psd_num"in e?e.psd_num.toString():"1","line_num"in e||(e.line_num="1"),delete e.style,3===e.theme.length&&e.theme.push("#fff");for(var o=0,l=Object.entries(e.stn_list);o<l.length;o++){var u=Object(a.a)(l[o],2),b=u[0],d=u[1];"num"in d||(e.stn_list[b].num="00"),"interchange"in d&&d.interchange.map((function(e){return e.forEach((function(e){5===e.length&&e.splice(3,0,"#fff")}))}))}for(var j=0,O=Object.entries(e.stn_list);j<O.length;j++){var h=Object(a.a)(O[j],2),f=h[0],p=h[1];"osi22_end_p"===p.change_type&&(e.stn_list[f].change_type="osi22_pr"),"osi22_end_u"===p.change_type&&(e.stn_list[f].change_type="osi22_ur")}for(var g=0,_=Object.entries(e.stn_list);g<_.length;g++){var m=Object(a.a)(_[g],2),v=m[0];"interchange"in m[1]||(e.stn_list[v].interchange=[[]])}e.info_panel_type="info_panel_type"in e?function(e){switch(e){case"gz_1":case"panasonic":return"gz28";case"gz_2":return"gz6";case"gz_3":return"gz3";default:return e}}(e.info_panel_type):"gz28","direction_gz_x"in e||(e.direction_gz_x=50),"direction_gz_y"in e||(e.direction_gz_y=70);for(var x=0,T=Object.entries(e.stn_list);x<T.length;x++){var y,w,S,I,E=Object(a.a)(T[x],2),R=E[0],N=E[1];if(!("transfer"in N))e.stn_list[R].transfer={tick_direc:"none"===N.change_type||"int2"===N.change_type?"r":null===(y=N.change_type)||void 0===y?void 0:y.split("_")[1].split("").slice().reverse()[0],paid_area:-1===(null===(w=N.change_type)||void 0===w?void 0:w.indexOf("osi"))||"p"===(null===(S=N.change_type)||void 0===S?void 0:S.split("_")[1][0]),osi_names:-1!==(null===(I=N.change_type)||void 0===I?void 0:I.indexOf("osi"))?[N.interchange[1][0]]:[],info:2===N.interchange.length?[N.interchange[0],N.interchange[1].slice(1)]:N.interchange};delete e.stn_list[R].change_type,delete e.stn_list[R].interchange}for(var k=0,M=Object.entries(e.stn_list);k<M.length;k++){var A=Object(a.a)(M[k],2),D=A[0],P=A[1];"services"in P||(e.stn_list[D].services=["local"]),"facility"in P||(e.stn_list[D].facility="usage"in P?P.usage:""),delete e.stn_list[D].usage}return"customiseMTRDest"in e||(e.customiseMTRDest={isLegacy:e.dest_legacy||!1,terminal:!1}),delete e.dest_legacy,"svgWidth"in e||(e.svgWidth={destination:e.svg_dest_width,runin:e.svg_dest_width,railmap:e.svg_width}),delete e.svg_width,delete e.svg_dest_width,"notesGZMTR"in e||(e.notesGZMTR=[]),e.notesGZMTR=null===(t=e.notesGZMTR)||void 0===t?void 0:t.map((function(e){return 4===e.length?e.concat([!1]):e})),delete e.char_form,delete e.show_outer,delete e.strip_pc,delete e.txt_bg_gap,"namePosMTR"in e||(e.namePosMTR={isStagger:!0,isFlip:e.txt_flip}),delete e.txt_flip,Object.keys(e.stn_list).forEach((function(t){"secondaryName"in e.stn_list[t]?!1!==e.stn_list[t].secondaryName&&","===e.stn_list[t].secondaryName.join()&&(e.stn_list[t].secondaryName=!1):e.stn_list[t].secondaryName=!1,"type"in e.stn_list[t].transfer&&delete e.stn_list[t].transfer.type})),e},i=function(e,t){var n,a=Object(r.a)(t);try{for(a.s();!(n=a.n()).done;){var c=n.value;if(e[c])return e[c]}}catch(s){a.e(s)}finally{a.f()}return e.en},o=function(e,t){return(t===c.f.GZMTR?((null===e||void 0===e?void 0:e.num)||"-")+": ":"")+(null===e||void 0===e?void 0:e.name.join().replace("\\"," "))}},function(e,t){e.exports=i18next},,,,function(e,t){e.exports=ReactDOM},function(e,t){e.exports=i18nextXHRBackend},function(e,t){e.exports=i18nextBrowserLanguageDetector},function(e,t){e.exports=ReduxThunk},,function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var r=n(6),a=n.n(r),c=n(9),s=n(12),i=n(3),o=n.n(i),l=n(26),u=(n(31),n(22)),b=n.n(u),d=n(11),j=n(27),O=n.n(j),h=n(28),f=n.n(h);b.a.use(O.a).use(f.a).use(d.initReactI18next).init({fallbackLng:{"zh-CN":["zh-Hans","en"],"zh-Hant":["zh-HK","en"],"zh-HK":["zh-Hant","en"],"zh-TW":["zh-HK","zh-Hant"],default:["en"]},backend:{loadPath:"/RailMapGenerator/locale/{{lng}}.json"},interpolation:{escapeValue:!1}}).then((function(e){document.title=e("title"),document.documentElement.setAttribute("lang",b.a.language)}));var p,g,_,m,v=n(7),x=n(14),T=n(4),y=n(5),w=n(10),S=n(8),I=n(1),E=Object(T.makeStyles)((function(e){return Object(T.createStyles)({rootLight:{backgroundColor:e.palette.primary.main},rootDark:{backgroundColor:e.palette.background.paper},title:{flexGrow:1,color:"#fff"},menuButton:{color:"#fff"}})})),R=function(){var e=Object(d.useTranslation)(),t=e.t,n=e.i18n,r=E(),a=Object(T.useMediaQuery)("(prefers-color-scheme: dark)");return i.useMemo((function(){return Object(I.jsx)(T.AppBar,{position:"sticky",className:a?r.rootDark:r.rootLight,children:Object(I.jsxs)(T.Toolbar,{variant:"dense",children:[Object(I.jsx)(T.Typography,{variant:"h6",className:r.title,color:"textPrimary",children:"/RailMapGenerator".includes("uat")?t("titleUAT"):t("title")}),Object(I.jsx)(N,{}),Object(I.jsx)(k,{})]})})}),[a,n.language])},N=function(){var e=Object(d.useTranslation)().t,t=E(),n=Object(w.useDispatch)(),r=Object(w.useSelector)((function(e){return e.app.rmgStyle})),a=i.useState(null),c=Object(v.a)(a,2),s=c[0],o=c[1],l=function(e){return function(){n(Object(S.f)(e)),o(null)}};return i.useMemo((function(){return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(T.Tooltip,{title:e("toggle.tooltip"),children:Object(I.jsx)(T.IconButton,{onClick:function(e){return o(e.currentTarget)},className:t.menuButton,children:Object(I.jsx)(T.Icon,{children:"photo_library"})})}),Object(I.jsxs)(T.Menu,{anchorEl:s,open:Boolean(s),onClose:function(){return o(null)},children:[y.g[r].map((function(t){return Object(I.jsx)(T.MenuItem,{onClick:l(t),children:e("toggle."+t)},t)})),Object(I.jsx)(T.Divider,{style:{margin:"6px 0"}}),Object(I.jsx)(T.MenuItem,{onClick:l(y.a),children:e("toggle.all")})]})]})}),[r,s,t.menuButton])},k=function(){var e=Object(d.useTranslation)().t,t=E(),n=Object(w.useDispatch)();return i.useMemo((function(){return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(T.Tooltip,{title:e("zoom.out"),children:Object(I.jsx)(T.IconButton,{onClick:function(){return n(Object(S.k)())},className:t.menuButton,children:Object(I.jsx)(T.Icon,{children:"zoom_out"})})}),Object(I.jsx)(T.Tooltip,{title:e("zoom.in"),children:Object(I.jsx)(T.IconButton,{onClick:function(){return n(Object(S.j)())},className:t.menuButton,children:Object(I.jsx)(T.Icon,{children:"zoom_in"})})})]})}),[t.menuButton])},M=n(0),A=n(2),D=n(15),P=n(17),z=n(19),C=n(25),F=n(24),B=function(e){Object(C.a)(n,e);var t=Object(F.a)(n);function n(e){var r;return Object(P.a)(this,n),(r=t.call(this,e)).state={hasError:!1},r}return Object(z.a)(n,[{key:"componentDidCatch",value:function(e,t){}},{key:"render",value:function(){return this.state.hasError?Object(I.jsx)("h1",{children:"Something went wrong."}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),n}(o.a.Component),G=Object(T.makeStyles)((function(){return Object(T.createStyles)({root:{display:"flex",flexDirection:"row",overflowX:"scroll","&::before, &::after":{content:'""',margin:"auto"},"& > svg":{flex:"0 0 auto",border:"1px solid black"}}})})),L=function(){var e=G(),t=o.a.useContext(D.a).param,n=Object(w.useSelector)((function(e){return e.app.canvasScale})),r=o.a.useCallback((function(e){var r;return{id:e,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",height:t.svg_height*n,viewBox:"0 0 ".concat(t.svgWidth[e]," ").concat(t.svg_height),colorInterpolationFilters:"sRGB",style:(r={},Object(A.a)(r,"--rmg-svg-width",t.svgWidth[e]+"px"),Object(A.a)(r,"--rmg-svg-height",t.svg_height+"px"),Object(A.a)(r,"--rmg-theme-colour",t.theme[2]),Object(A.a)(r,"--rmg-theme-fg",t.theme[3]),r)}}),[t.svg_height,JSON.stringify(t.svgWidth),t.theme[2],t.theme[3],n]);return Object(I.jsx)("div",{className:e.root,children:Object(I.jsxs)(x.Switch,{children:[Object.entries(y.g).map((function(e){var t=Object(v.a)(e,2),n=t[0];t[1];return Object(I.jsx)(x.Route,{path:"/".concat(n),children:Object(I.jsx)(H,{style:n,canvasAvailable:K[n],svgProps:r})},n)})),Object(I.jsx)(x.Redirect,{to:"/"+y.f.MTR})]})})},H=Object(i.memo)((function(e){var t=Object(w.useDispatch)(),n=Object(w.useSelector)((function(e){return e.app.canvasToShow}));return t(Object(S.i)(e.style)),Object(i.useEffect)((function(){["share"].concat(Object(s.a)(Object.values(y.b))).forEach((function(t){t in e.canvasAvailable||"share"===t?document.getElementById("css_"+t).href="/RailMapGenerator"+"/styles/".concat(t,"_").concat(e.style,".css"):document.getElementById("css_"+t).href=""})),![].concat(Object(s.a)(y.g[e.style]),[y.a]).includes(n)&&t(Object(S.f)(y.a))}),[]),Object(I.jsx)(I.Fragment,{children:Object.keys(e.canvasAvailable).map((function(t){return[y.a,t].includes(n)&&Object(I.jsx)(o.a.Suspense,{fallback:Object(I.jsx)(T.CircularProgress,{}),children:Object(I.jsx)(B,{children:Object(I.jsxs)("svg",Object(M.a)(Object(M.a)({},e.svgProps(t)),{},{children:[Object(I.jsx)("rect",{id:"canvas-bg",fill:"white",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}}),e.canvasAvailable[t],Object(I.jsx)("rect",{id:"canvas-border",fill:"none",strokeWidth:3,stroke:"none",style:{height:"var(--rmg-svg-height)",width:"var(--rmg-svg-width)"}})]}))})},t)}))})})),U=Object(i.lazy)((function(){return n.e(90).then(n.bind(null,132))})),Z=Object(i.lazy)((function(){return n.e(87).then(n.bind(null,127))})),W=Object(i.lazy)((function(){return n.e(69).then(n.bind(null,113))})),V=Object(i.lazy)((function(){return n.e(88).then(n.bind(null,128))})),Y=Object(i.lazy)((function(){return n.e(70).then(n.bind(null,114))})),J=Object(i.lazy)((function(){return n.e(91).then(n.bind(null,115))})),X=Object(i.lazy)((function(){return n.e(89).then(n.bind(null,129))})),K=(m={},Object(A.a)(m,y.f.GZMTR,(p={},Object(A.a)(p,y.b.RunIn,Object(I.jsx)(U,{})),Object(A.a)(p,y.b.RailMap,Object(I.jsx)(Z,{})),p)),Object(A.a)(m,y.f.MTR,(g={},Object(A.a)(g,y.b.Destination,Object(I.jsx)(W,{})),Object(A.a)(g,y.b.RailMap,Object(I.jsx)(V,{})),g)),Object(A.a)(m,y.f.SHMetro,(_={},Object(A.a)(_,y.b.Destination,Object(I.jsx)(Y,{})),Object(A.a)(_,y.b.RunIn,Object(I.jsx)(J,{})),Object(A.a)(_,y.b.RailMap,Object(I.jsx)(X,{})),_)),m),Q=L,$=i.lazy((function(){return n.e(80).then(n.bind(null,126))})),q=i.lazy((function(){return n.e(77).then(n.bind(null,130))})),ee=i.lazy((function(){return n.e(72).then(n.bind(null,131))})),te=i.lazy((function(){return n.e(82).then(n.bind(null,125))})),ne=i.lazy((function(){return n.e(76).then(n.bind(null,116))})),re=Object(T.makeStyles)((function(e){var t;return Object(T.createStyles)({root:Object(A.a)({display:"flex",flexDirection:"row",height:"100%"},e.breakpoints.down("xs"),{flexDirection:"column"}),typography:{background:e.palette.background.default},tab:(t={padding:"6px 24px",height:48,"& .MuiTab-wrapper":{flexDirection:"row"}},Object(A.a)(t,e.breakpoints.up("sm"),{"& .MuiTab-wrapper":{justifyContent:"flex-start"}}),Object(A.a)(t,e.breakpoints.down("xs"),{minWidth:"calc(100% / 5)"}),Object(A.a)(t,"&.MuiTab-labelIcon",{minHeight:"unset","& .MuiTab-wrapper":{"& > *:first-child":{marginBottom:0},"& > *:not(first-child)":{paddingLeft:8}}}),t),tabs:{overflow:"auto","&::-webkit-scrollbar":{width:0},scrollbarWidth:"none",WebkitOverflowScrolling:"touch"},tabpanel:{overflow:"auto",flex:1,padding:e.spacing(3),paddingBottom:0,height:"calc(100% - ".concat(e.spacing(3),"px)"),display:"flex",justifyContent:"center",alignItems:"flex-start"}})}));function ae(){var e=Object(d.useTranslation)(),t=e.t,n=e.i18n,r=re(),a=Object(T.useTheme)(),c=Object(T.useMediaQuery)(a.breakpoints.down("xs")),s=i.useState(0),o=Object(v.a)(s,2),l=o[0],u=o[1],b=i.useMemo((function(){return Object(I.jsx)(T.Typography,{className:"".concat(r.typography," ").concat(r.tabs),component:"div",children:Object(I.jsx)(T.Tabs,{value:l,orientation:c?"horizontal":"vertical",indicatorColor:"primary",textColor:"primary",onChange:function(e,t){return u(t)},variant:"scrollable",scrollButtons:"off",children:[["file","insert_drive_file"],["layout","panorama"],["design","brush"],["stations","directions_transit"],["info","info"]].map((function(e,n){return Object(I.jsx)(T.Tab,{label:Object(I.jsx)("span",{children:t("tab."+e[0])}),icon:Object(I.jsx)(T.Icon,{children:e[1]}),className:r.tab},n)}))})})}),[l,n.language,r.tab,c]);return Object(I.jsxs)("div",{className:r.root,children:[b,Object(I.jsx)(T.Typography,{className:"".concat(r.typography," ").concat(r.tabpanel),component:"div",role:"tabpanel",children:Object(I.jsx)(i.Suspense,{fallback:Object(I.jsx)(T.CircularProgress,{}),children:function(e){switch(e){case 0:return Object(I.jsx)($,{});case 1:return Object(I.jsx)(q,{});case 2:return Object(I.jsx)(ee,{});case 3:return Object(I.jsx)(te,{});case 4:return Object(I.jsx)(ne,{});default:return Object(I.jsx)($,{})}}(l)})})]})}function ce(){return Object(I.jsx)(i.Suspense,{fallback:Object(I.jsx)(T.CircularProgress,{}),children:Object(I.jsx)(ae,{})})}var se=n(18),ie=Object(T.createMuiTheme)({palette:{type:"dark",primary:{main:"#bb86fc"},secondary:{main:"#018786"},error:{main:"#cf6679"}},overrides:{MuiDialog:{paper:{minWidth:280}}}}),oe=Object(T.createMuiTheme)({palette:{primary:{light:"#bb86fc",main:"#6200ee"},secondary:{main:"#018786"},error:{main:"#b00020"}},overrides:{MuiDialog:{paper:{minWidth:280}}}});function le(){var e=Object(T.useMediaQuery)("(prefers-color-scheme: dark)")?ie:oe;return Object(I.jsx)(x.BrowserRouter,{basename:"/RailMapGenerator",children:Object(I.jsxs)(T.ThemeProvider,{theme:e,children:[Object(I.jsx)(o.a.Suspense,{fallback:Object(I.jsx)(T.LinearProgress,{}),children:Object(I.jsx)(R,{})}),Object(I.jsx)(ue,{})]})})}var ue=function(){var e=Object(i.useReducer)(D.b,JSON.parse(localStorage.rmgParam)),t=Object(v.a)(e,2),n=t[0],r=t[1],a=JSON.stringify(n);Object(i.useEffect)((function(){window.rmgStorage.writeFile("rmgParam",a).then()}),[a]);var c=Object.keys(n.stn_list).reduce((function(e,t){return e+t+function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(t,n){return t+JSON.stringify(e[n])}),"")}}("parents","children","branch")(n.stn_list[t])}),""),s=Object(i.useMemo)((function(){return Object(se.a)(n.stn_list)}),[c]),o=Object(i.useMemo)((function(){return Object(se.b)(n.stn_list)}),[c]),l=Object(se.d)(s);return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsxs)(D.a.Provider,{value:{param:n,dispatch:r,branches:s,routes:o,deps:c,tpo:l},children:[Object(I.jsx)("div",{style:{overflowY:"auto"},children:Object(I.jsx)(Q,{})}),Object(I.jsx)("div",{style:{flex:1,overflow:"hidden"},children:Object(I.jsx)(ce,{})})]}),Object(I.jsx)("canvas",{style:{display:"none"}})]})},be=n(21);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var de=function(){function e(){Object(P.a)(this,e),this.currentBusyFilename=void 0,this.currentBusyFilename=!1}return Object(z.a)(e,[{key:"init",value:function(){var e=Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.warn("Using localStorage, please update your browser"),window.localStorage){e.next=4;break}throw alert("Local storage is not available! Please upgrade to a newer browser!"),new Error("LocalStorage unavailable");case 4:e.prev=4,window.localStorage.setItem("storage_test","1"),window.localStorage.removeItem("storage_test"),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(4),alert("Local storage is not accessible! Please modify your browser's settings or try with another browser!"),new Error("LocalStorage no write permission");case 13:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeFile",value:function(){var e=Object(c.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.currentBusyFilename===t&&console.warn("Attempt to write",t,"while write process is not finished!"),this.currentBusyFilename=t,window.localStorage.setItem(t,n),this.currentBusyFilename=!1;case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"readFile",value:function(){var e=Object(c.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentBusyFilename===t&&console.warn("Attempt to read",t,"while write process is not finished!"),n=window.localStorage.getItem(t)){e.next=4;break}throw new Error("FILE_NOT_FOUND");case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteFile",value:function(){var e=Object(c.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.currentBusyFilename===t&&console.warn("Attempt to delete",t,"while write process is not finished!"),this.currentBusyFilename=t,window.localStorage.removeItem(t),this.currentBusyFilename=!1;case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function je(){return(je=Object(c.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.indexedDB){e.next=3;break}return console.log("IndexedDB not supported"),e.abrupt("return",new de);case 3:return e.next=5,new Promise((function(e){try{var t=window.indexedDB.open("indexeddb_feature_detection",1);t.onerror=function(t){console.log("IndexedDB can NOT be accessed:",t),console.log("Fallback to LocalStorage"),e(new de)},t.onsuccess=function(){console.log("IndexedDB can be accessed"),e(new de)}}catch(n){console.warn("Error while opening IndexedDB:",n),e(new de)}}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oe=n(20),he=n(29),fe=n.n(he),pe={rmgStyle:y.f.MTR,canvasScale:1,canvasScaleStatus:y.c.init,canvasToShow:y.a,canvasToShowStatus:y.c.init};var ge,_e=Object(Oe.combineReducers)({app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S.e:e.rmgStyle=t.rmgStyle;break;case S.a:e.canvasScale=t.canvasScale;break;case S.b:e.canvasScaleStatus=t.canvasScaleStatus;break;case S.c:e.canvasToShow=t.canvasToShow;break;case S.d:e.canvasToShowStatus=t.canvasToShowStatus}return Object(M.a)({},e)}}),me=Object(Oe.createStore)(_e,Object(Oe.applyMiddleware)(fe.a));"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)})),(ge=document.head).append.apply(ge,Object(s.a)(["share"].concat(Object(s.a)(Object.values(y.b))).map((function(e){var t=document.createElement("link");return t.rel="stylesheet",t.id="css_"+e,t}))));(function(){return je.apply(this,arguments)})().then(function(){var e=Object(c.a)(a.a.mark((function e(t){var r,c,s,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:return e.prev=2,e.next=5,t.readFile("rmgParam");case 5:return r=e.sent,c=Object(be.c)(JSON.parse(r)),e.next=9,t.writeFile("rmgParam",JSON.stringify(c));case 9:e.next=20;break;case 11:return e.prev=11,e.t0=e.catch(2),console.warn(e.t0),e.next=16,n.e(0).then(n.bind(null,78));case 16:return s=e.sent,i=Object(be.c)(s.default),e.next=20,t.writeFile("rmgParam",JSON.stringify(i));case 20:return e.prev=20,window.rmgStorage=t,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[2,11,20,23]])})));return function(t){return e.apply(this,arguments)}}()).then(Object(c.a)(a.a.mark((function e(){var t,n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.rmgStorage.readFile("rmgScale");case 2:return t=e.sent,(n=Number(t))>=.1&&me.dispatch(Object(S.g)(n)),e.next=7,window.rmgStorage.readFile("rmgCanvas");case 7:r=e.sent,me.dispatch(Object(S.h)(r)),window.rmgStore=me;case 10:case"end":return e.stop()}}),e)})))).then((function(){l.render(Object(I.jsx)(w.Provider,{store:me,children:Object(I.jsx)(le,{})}),document.getElementById("root"))}))}],[[33,92,93]]]);
//# sourceMappingURL=main.00e2496d.chunk.js.map