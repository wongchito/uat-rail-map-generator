{"version":3,"sources":["svgs/indoor/station-shmetro.tsx","svgs/indoor/indoor-shmetro.tsx","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","methods.ts","svgs/railmap/methods/share.ts","svgs/railmap/methods/mtr.ts"],"names":["StationSHMetro","props","param","useAppSelector","store","stnInfo","stn_list","stnId","stationIconStyle","transfer","info","flat","length","name","infos","stnState","direction","nameDirection","xlinkHref","stroke","StationNameGElement","transform","x1","x2","y1","y2","intInfos","arrowDirection","StationName","stnName","fill","osiInfos","osysiInfos","React","forwardRef","ref","others","split","nameENLn","textAnchor","useMemo","map","txt","i","array","className","dy","fontSize","IntBoxGroup","intNameId","intInfo","reduce","color","lineNames","filter","match","replace","join","concat","lineNamesEn","trim","id","Fragment","offset","stopColor","OSIText","toString","OSysIText","DefsSHMetro","memo","strokeWidth","r","d","leftWideFactor","stnList","res","parents","children","rightWideFactor","IndoorSHMetro","helper","routes","branches","deps","depsStr","adjMat","adjacencyList","criticalPath","criticalPathMethod","realCP","nodes","slice","xShares","console","log","Object","keys","acc","cur","getXShareMTR","JSON","stringify","lineXs","svgWidth","indoor","padding","xs","len","yShares","StationsMTR","getYShares","ys","branch_spacing","stnStates","getStnState","current_stn_idx","linePaths","drawLine","svg_height","Lines","paths","main","path","pass","prevProps","nextProps","StationGroup","includes","branch","indexOf","InfoElements","line_name","dx","x","y","width","height","rx","_objectWithoutProperties","source","excluded","key","target","sourceKeys","getOwnPropertySymbols","sourceSymbolKeys","prototype","propertyIsEnumerable","call","getYShareMTR","stnPred","leftW","rightW","a","c","from","to","allLengths","criticalPaths","forEach","child","cp","push","unshift","maxLength","Math","max","branchOfStn","partSource","partSink","leftOpenJaw","lens","currentId","Set","ShortDirection","right","stnId1","stnId2","route","idx1","idx2","_isSuccessor","_isPredecessor","Stations","data","namePoss","pathWeight","Infinity","pathTurnParams","branchSpacing","dy_a","tr","sqrt","dy_l","dx_a","dx_l","pathTurnSE","pathTurnNE","this","getYShare","stnIds","realXs","realYs","e","prevId","prevY","prevX","stnDX","stnExtraH","stnSpareH","warn","stations","lineMainStns","linePassStns","_linePath","ls","val","tick_direc"],"mappings":"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","file":"static/js/indoorSHMetro.44f1bfb4.chunk.js","sourcesContent":["import React from 'react';\nimport { InterchangeInfo, Name } from \"../../constants/constants\";\nimport { useAppSelector } from '../../redux';\n\ninterface Props {\n    stnId: string;\n    stnState: -1 | 0 | 1;\n    nameDirection: 'upward' | 'downward';\n}\n\nconst StationSHMetro = (props: Props) => {\n    const param = useAppSelector(store => store.param);\n    const stnInfo = param.stn_list[props.stnId];\n\n    let stationIconStyle = '';\n    if (stnInfo.transfer.info.flat().length > 0) stationIconStyle = 'int2_indoor_sh';\n    else stationIconStyle = 'stn_indoor_sh';\n\n    return (\n        <>\n            <StationNameGElement\n                name={stnInfo.name}\n                infos={stnInfo.transfer.info}\n                stnState={props.stnState}\n                direction={param.direction}\n                nameDirection={props.nameDirection}\n            />\n            <use\n                xlinkHref={`#${stationIconStyle}`}\n                stroke='var(--rmg-theme-colour)'\n            />\n        </>\n    );\n};\n\nexport default StationSHMetro;\n\ninterface StationNameGElementProps {\n    name: Name;\n    infos: InterchangeInfo[][];\n    stnState: -1 | 0 | 1;\n    direction: 'l' | 'r';\n    nameDirection: 'upward' | 'downward';\n}\n\nconst StationNameGElement = (props: StationNameGElementProps) => {\n    return (\n        <g transform={`translate(0,${props.nameDirection === 'upward' ? 60 : -30})`}>\n            <line\n                x1={-30}\n                x2={30}\n                y1={props.nameDirection === 'upward' ? -23 : -10}\n                y2={props.nameDirection === 'upward' ? -23 : -10}\n                stroke='black'\n            />\n            <line\n                y1={props.nameDirection === 'upward' ? -23 : -10}\n                y2={props.nameDirection === 'upward' ? -23 - 25 : 20}\n                stroke='black'\n            />\n\n            {[...props.infos[0], ...props.infos[1] || []].length > 0 && (<IntBoxGroup\n                intInfos={[...props.infos[0], ...props.infos[1] || []]}\n                arrowDirection={props.nameDirection}\n            />)}\n\n            <StationName\n                stnName={props.name}\n                nameDirection={props.nameDirection}\n                fill='black'\n            />\n\n            {props.infos[1]?.length > 0 && (\n                <g transform={`translate(0,${props.nameDirection === 'upward' ? -185 : 150})`}>\n                    <OSIText osiInfos={props.infos[1]} />\n                </g>\n            )}\n\n            {props.infos[2]?.length > 0 && (\n                <g transform={`translate(0,${props.nameDirection === 'upward' ?\n                    (props.infos[1]?.length ? -210 : (props.infos[0].length ? -180 : -100)) :\n                    (props.infos[1]?.length ? 190 : (props.infos[0].length ? 160 : 75))})`}>\n                    <OSysIText osysiInfos={props.infos[2]} />\n                </g>\n            )}\n        </g>\n    );\n};\n\nconst StationName = React.forwardRef(\n    (props: { stnName: Name, nameDirection: 'upward' | 'downward' } & React.SVGProps<SVGGElement>, ref: React.Ref<SVGGElement>) => {\n        const { stnName, nameDirection, ...others } = props\n        const name = stnName[0].split('\\\\')\n        const nameENLn = stnName[1].split('\\\\').length\n\n        return (\n            <g ref={ref} {...others} textAnchor='middle'\n                transform={`translate(0,${nameDirection === 'upward' ? -2 : -30 - 12 * (nameENLn - 1)})`}>\n                {React.useMemo(\n                    () => (\n                        <>\n                            {name.map((txt, i, array) => (<text key={i} className=\"rmg-name__zh\"\n                                dy={nameDirection === 'upward' ? 16 * i : (array.length - 1 - i) * -16}>\n                                {txt}\n                            </text>))}\n                            <g fontSize={9.6}>\n                                {stnName[1].split('\\\\').map((txt, i) => (\n                                    <text key={i} className=\"rmg-name__en\"\n                                        dy={12 * (i + 1) + (nameDirection === 'upward' ? name.length > 1 ? name.length * 7.5 : 0 : 0)}>\n                                        {txt}\n                                    </text>\n                                ))}\n                            </g>\n                        </>\n                    ),\n                    // eslint-disable-next-line react-hooks/exhaustive-deps\n                    [...stnName]\n                )}\n            </g>\n        );\n    }\n);\n\nconst IntBoxGroup = (props: { intInfos: InterchangeInfo[]; arrowDirection: 'upward' | 'downward' } & React.SVGProps<SVGGElement>) => {\n    const { intInfos, arrowDirection } = props\n\n    // name each different linearGradient that will fill the arrow \n    const intNameId = intInfos\n        .map(intInfo => intInfo[2])\n        .reduce((name, color) => name + color, \"\")\n\n    // get the interchange line names\n    // TODO: support out-of-system transfer InterchangeInfo[2][] (e.g. maglev)\n    const lineNames = [intInfos\n        .filter(intInfo => intInfo[4].match(/^\\d+.*$/))\n        .map(intInfo => intInfo[4].replace(/^(\\d+)(.*)$/, \"$1\"))\n        .join('，')\n        .concat('号线'), intInfos\n            .filter(intInfo => !intInfo[4].match(/^\\d+.*$/))\n            .map(intInfo => intInfo[4])\n            .join('，')].filter(name => name && name !== '号线').join('，')\n    const lineNamesEn = ['Line '.concat(intInfos\n        .filter(intInfo => intInfo[5].match(/^L|line$/))\n        .map(intInfo => intInfo[5].replace('Line', '').replace('line', '').trim())\n        .join(',')), intInfos\n            .filter(intInfo => !intInfo[5].match(/^L|line$/))\n            .map(intInfo => intInfo[5])\n            .join('，')].filter(name => name && name !== 'Line ').join(',')\n\n    return (<g>\n        <use\n            xlinkHref=\"#int_indoor_arrow_sh\"\n            transform={`translate(0,${arrowDirection === 'upward' ? -74 : 44})rotate(${arrowDirection === 'upward' ? 0 : 180})`}\n            fill={intInfos.length === 1 ? intInfos[0][2] : `url(#grad${intNameId})`} />\n\n        {intInfos.length > 1 && (<>\n            <linearGradient id={`grad${intNameId}`} y1=\"0\" y2=\"0\"\n                x1={arrowDirection === 'upward' ? '25%' : '75%'}\n                x2={arrowDirection === 'upward' ? '75%' : '25%'}>\n                {intInfos.map((intInfo, i) => (<React.Fragment key={i}>\n                    {/* more about React.Fragment on https://stackoverflow.com/a/59390967 */}\n                    <stop  // start from\n                        offset={`${(100 / intInfos.length) * (i + 0)}%`}\n                        stopColor={intInfo[2]} />\n                    <stop  // to\n                        offset={`${(100 / intInfos.length) * (i + 1)}%`}\n                        stopColor={intInfo[2]} />\n                </React.Fragment>))}\n            </linearGradient>\n\n            {/* a range inplementation [0, 1, 2 ... intInfos.length - 1] */}\n            {/* {[...Array(intInfos.length - 1).keys()].map(i => (<line\n                x1={-7.5 + (15 / intInfos.length) * (i + 1)}\n                x2={-7.5 + (15 / intInfos.length) * (i + 1)}\n                y1=\"-74\"\n                y2={-104 - 7.5 - 7.5 / (intInfos.length - 1) * (i+1)}\n                stroke=\"black\"\n            />))} */}\n\n        </>)}\n\n        <g transform={`translate(0,${arrowDirection === 'upward' ? -145 : 125})`} textAnchor=\"middle\">\n            <text className=\"rmg-name__zh\" dy={-7}>\n                {`换乘${lineNames}`}\n            </text>\n            <text className=\"rmg-name__en\" dy={5} fontSize={9.6}>\n                {`Interchange ${lineNamesEn}`}\n            </text>\n        </g>\n    </g>)\n};\n\nconst OSIText = (props: { osiInfos: InterchangeInfo[] }) => {\n    return React.useMemo(\n        () => (\n            <g textAnchor=\"middle\" fontSize=\"50%\">\n                <text className=\"rmg-name__zh\" dy={-5}>\n                    {`换乘${props.osiInfos.map(info => info[4]).join('，')}`}\n                </text>\n                <text className=\"rmg-name__zh\" dy={5}>\n                    仅限公共交通卡\n                </text>\n                <text className=\"rmg-name__en\" dy={12.5} fontSize=\"75%\">\n                    Only for Public Transportation Card\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.osiInfos.toString()]\n    )\n}\n\nconst OSysIText = (props: { osysiInfos: InterchangeInfo[] }) => {\n    return React.useMemo(\n        () => (\n            <g textAnchor=\"middle\">\n                <text className=\"rmg-name__zh\" dy={-5}>\n                    {`转乘${props.osysiInfos.map(info => info[4]).join('，')}`}\n                </text>\n                <text className=\"rmg-name__en\" dy={7.5} fontSize={9.6}>\n                    {`To ${props.osysiInfos.map(info => info[5]).join(', ')}`}\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.osysiInfos.toString()]\n    )\n}\n","import React, { memo, useMemo } from 'react';\nimport { adjacencyList, getXShareMTR, criticalPathMethod, getStnState } from '../railmap/methods/share';\nimport StationSHMetro from './station-shmetro';\nimport { StationsMTR } from '../railmap/methods/mtr';\nimport { StationDict } from \"../../constants/constants\";\nimport { useAppSelector } from '../../redux';\n\nexport default memo(function IndoorWrapperSHMetro() {\n    return (\n        <>\n            <DefsSHMetro />\n            <IndoorSHMetro />\n        </>\n    );\n});\n\nexport const DefsSHMetro = React.memo(() => (\n    <defs>\n        <circle id=\"stn_indoor_sh\" fill=\"white\" strokeWidth={5} stroke=\"var(--rmg-theme-colour)\"\n            r={8} transform=\"scale(1.5)\" />\n        <path id=\"int2_indoor_sh\" fill=\"white\" strokeWidth={4} d=\"M -5,0 a 5,5 0 1 1 10,0 V10 a 5,5 0 1 1 -10,0Z\"\n            stroke=\"black\" transform=\"translate(0, -10)scale(2)\" />\n        <path id=\"int_indoor_arrow_sh\" stroke=\"black\" strokeWidth={1} d=\"M -7.5,0 v -40 h -7.5 l 15,-15 l 15,15 h -7.5 v 40 Z \" />\n    </defs>\n));\n\nconst leftWideFactor = (stnList: StationDict, stnId: string) => {\n    let res = 0\n    if (stnList[stnId].parents.length === 2) res += 1\n    if (stnList[stnList[stnId].parents[0]].children.length === 2) res += 1\n    return res\n}\n\nconst rightWideFactor = (stnList: StationDict, stnId: string) => {\n    let res = 0\n    if (stnList[stnId].children.length === 2) res += 1\n    if (stnList[stnList[stnId].children[0]].parents.length === 2) res += 1\n    return res\n}\n\nconst IndoorSHMetro = () => {\n    const { routes, branches, depsStr: deps } = useAppSelector(store => store.helper);\n    const param = useAppSelector(store => store.param);\n\n    const adjMat = adjacencyList(\n        param.stn_list,\n        leftWideFactor,\n        rightWideFactor\n    );\n\n    const criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    const realCP = criticalPathMethod(criticalPath.nodes[1], criticalPath.nodes.slice(-2)[0], adjMat);\n\n    const xShares = React.useMemo(\n        () => {\n            console.log('computing x shares');\n            return Object.keys(param.stn_list).reduce(\n                (acc, cur) => ({ ...acc, [cur]: getXShareMTR(cur, adjMat, branches) }),\n                {} as { [stnId: string]: number }\n            );\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [branches.toString(), JSON.stringify(adjMat)]\n    );\n    const lineXs: [number, number] = [\n        (param.svgWidth.indoor * param.padding) / 100,\n        param.svgWidth.indoor * (1 - param.padding / 100),\n    ];\n    const xs = Object.keys(xShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: lineXs[0] + (xShares[cur] / realCP.len) * (lineXs[1] - lineXs[0]) }),\n        {} as typeof xShares\n    );\n\n    const yShares = useMemo(\n        () => StationsMTR.getYShares(param.stn_list, branches),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [deps]\n    );\n    const ys = Object.keys(yShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: yShares[cur] * param.branch_spacing * 2 }),\n        {} as typeof yShares\n    );\n\n    const stnStates = React.useMemo(\n        () => getStnState(param.current_stn_idx, routes, param.direction),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [param.current_stn_idx, param.direction, routes.toString()]\n    );\n\n    const linePaths = StationsMTR.drawLine(\n        branches,\n        stnStates,\n        param.stn_list,\n        lineXs,\n        xs,\n        ys,\n        param.branch_spacing * 2,\n        criticalPath,\n        0\n    );\n\n    return (\n        <>\n            <g id=\"main\" transform={`translate(0,${param.svg_height / 2})`}>\n                <Lines paths={linePaths} />\n                <StationGroup xs={xs} ys={ys} xShares={xShares} stnStates={stnStates} />\n            </g>\n            <InfoElements />\n        </>\n    );\n}\n\nconst Lines = React.memo(\n    (props: { paths: { main: string[]; pass: string[] } }) => {\n        return (\n            <g fill=\"none\" strokeWidth={12}>\n                <g stroke=\"var(--rmg-theme-colour)\">\n                    {props.paths.main.map((path, i) => (\n                        <path key={i} d={path} />\n                    ))}\n                    {props.paths.pass.map((path, i) => (\n                        <path key={i} d={path} />\n                    ))}\n                </g>\n            </g>\n        );\n    },\n    (prevProps, nextProps) => JSON.stringify(prevProps.paths) === JSON.stringify(nextProps.paths)\n);\n\ninterface StationGroupProps {\n    xs: { [stnId: string]: number };\n    ys: { [stnId: string]: number };\n    xShares: { [stnId: string]: number };  // Used as stn order\n    stnStates: { [stnId: string]: -1 | 0 | 1 };\n}\n\nconst StationGroup = (props: StationGroupProps) => {\n    const { branches } = useAppSelector(store => store.helper);\n    const param = useAppSelector(store => store.param);\n\n    return (\n        <g>\n            {Object.keys(param.stn_list)\n                .filter(stnId => !['linestart', 'lineend'].includes(stnId))\n                .map(stnId => (<g key={stnId} transform={`translate(${props.xs[stnId]},${props.ys[stnId]})`}>\n                    <StationSHMetro\n                        stnId={stnId}\n                        stnState={props.stnStates[stnId]}\n                        nameDirection={branches\n                            .filter(branch => branch.includes(stnId))\n                            .map(branch => branch.indexOf(stnId) % 2 === 0 ?\n                                'downward' : 'upward')[0] as 'upward' | 'downward'} />\n                </g>)\n                )\n            }\n        </g>\n    );\n};\n\nconst InfoElements = () => {\n    const param = useAppSelector(store => store.param);\n\n    return React.useMemo(() => (\n        <>\n            <g transform={`translate(${param.svgWidth.indoor / 2},50)`}>\n                <text textAnchor=\"middle\" fontSize=\"30\" className=\"rmg-name__zh\">\n                    轨道交通{param.line_name[0]}运营线路示意图\n                </text>\n            </g>\n            <g transform={`translate(${param.svgWidth.indoor / 2},${param.svg_height - 300})`}>\n                <text textAnchor=\"middle\" fontSize=\"18\" className=\"rmg-name__zh\" dx=\"-30\" dy=\"230\">\n                    友情提示：请留意您需要换乘线路的首末班时间，以免耽误您的出行，末班车进站前三分钟停售该末班车车票。\n                </text>\n                <text textAnchor=\"middle\" fontSize=\"12\" className=\"rmg-name__en\" dx=\"10\" dy=\"250\">\n                    Please pay attention to the interchange schedule if you want to transfer to other lines. Stop selling tickets 3 minutes before the last train services.\n                </text>\n                <g transform=\"translate(-600,215)\">\n                    <rect x=\"-5\" y=\"-25\" width=\"100\" height=\"70\" fill=\"none\" stroke=\"black\" rx=\"5\"></rect>\n                    <line x1=\"30\" x2=\"30\" y1=\"-20\" y2=\"40\" stroke=\"black\"></line>\n                    <text className=\"rmg-name__zh\" dx=\"3\" fontSize=\"18\">图</text>\n                    <text className=\"rmg-name__zh\" dx=\"3\" dy=\"18\" fontSize=\"18\">例</text>\n                    <text className=\"rmg-name__en\" dy=\"35\" fontSize=\"8\">legend</text>\n                    <use\n                        transform=\"translate(45,10)\"\n                        xlinkHref=\"#int2_indoor_sh\"\n                        stroke=\"var(--rmg-theme-colour)\"\n                    />\n                    <text className=\"rmg-name__zh\" dx=\"60\" dy=\"10\" fontSize=\"10\">换乘站</text>\n                    <text className=\"rmg-name__en\" dx=\"60\" dy=\"20\" fontSize=\"6\">Interchange</text>\n                    <text className=\"rmg-name__en\" dx=\"60\" dy=\"30\" fontSize=\"6\">Station</text>\n                </g>\n            </g>\n        </>\n    ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [param.svgWidth.indoor, param.svg_height, param.line_name]);\n};\n\n/* Some unused functions to split branches from the main line.\n * Note the branches here has a slightly different meaning.\n * It refers to all the line sections that have a parallel line\n * rather than the upper or the bottom branch section.\n *\n * Currently these functions only can be used on a line that\n * branches in the middle and ends at the linestart, which also\n * means that linestart has two children in the adjMat.\n*/\n/*\nconst getPathLength = (adjMat: ReturnType<typeof adjacencyList>, from: string, to: string): number => {\n    let cnt = 0, cur = from\n    while (Object.keys(adjMat[cur]).length > 0) {\n        cnt += 1\n        // we choose the first for all the cases so that the length for different branches will end in the same node\n        cur = Object.keys(adjMat[cur])[0]\n    }\n    return cnt\n}\nconst getIntersectionStn = (adjMat: ReturnType<typeof adjacencyList>) => {\n    const start = Object.keys(adjMat['linestart'])\n\n    let a = start[0], b = start[1]\n    const lenA = getPathLength(adjMat, a, 'lineend')\n    const lenB = getPathLength(adjMat, b, 'lineend')\n    if (lenA < lenB) {\n        for (let i = 0; i < lenB - lenA; i++) b = Object.keys(adjMat[b])[0]\n    } else {\n        for (let i = 0; i < lenA - lenB; i++) a = Object.keys(adjMat[a])[0]\n    }\n    while (a !== b) {\n        a = Object.keys(adjMat[a])[0]\n        b = Object.keys(adjMat[b])[0]\n    }\n    return a\n}\nconst getBranchesAndMainLine = (adjMat: ReturnType<typeof adjacencyList>) => {\n    const start = Object.keys(adjMat['linestart'])\n    const intersection = getIntersectionStn(adjMat)\n    return {\n        'branches': [\n            criticalPathMethod(start[0], intersection, adjMat).nodes,\n            criticalPathMethod(start[1], intersection, adjMat).nodes\n        ],\n        'main': criticalPathMethod(intersection, 'lineend', adjMat).nodes\n    }\n}\nconst getYShares = (adjMat: ReturnType<typeof adjacencyList>,\n    branchesAndMainLine: ReturnType<typeof getBranchesAndMainLine>,\n    stnId: string) => {\n    const branches = branchesAndMainLine.branches\n    const main = branchesAndMainLine.main\n\n    if (main.includes(stnId)) {\n        return 3\n    } else if (branches[0].includes(stnId)) {\n        return 0\n    } else {\n        return 6\n    }\n}\n*/\n","import objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","import { StationDict } from './constants/constants';\n\n/**\n * Vertical position (in shares) of station icon if using MTR style (for consistency of method `RMGLine.newStnPossibleLoc()`).\n */\nexport const getYShareMTR = (stnId: string, stnList: StationDict): -1 | 0 | 1 => {\n    if (\n        ['linestart', 'lineend'].includes(stnId) ||\n        stnList[stnId].parents.length > 1 ||\n        stnList[stnId].children.length > 1\n    ) {\n        return 0;\n    }\n    var stnPred = stnList[stnId].parents[0];\n    if (stnPred) {\n        // parent exist\n        if (stnList[stnPred].children.length === 1) {\n            // no sibling, then y same as parent\n            return getYShareMTR(stnPred, stnList);\n        } else {\n            // sibling exists, then y depends on its idx of being children\n            return stnList[stnPred].children.indexOf(stnId) === 0 ? 1 : -1;\n        }\n    } else {\n        // no parent, must be linestart\n        return 0;\n    }\n};\n","import * as Global from '../../../methods';\nimport { RMGParam, ShortDirection, StationDict, StationInfo } from '../../../constants/constants';\n\n/**\n * Compute the adjacency list of the graph.\n * @param stnList Key-value pairs of station info\n * @param leftW Callback of left wide factor\n * @param rightW Callback of right wide factor\n */\nexport const adjacencyList = (\n    stnList: { [stnId: string]: StationInfo },\n    leftW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number,\n    rightW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number\n) => {\n    return Object.keys(stnList).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: stnList[cur].children.reduce(\n                (a, c) => ({ ...a, [c]: 1 + leftW(stnList, c) + rightW(stnList, cur) }),\n                {}\n            ),\n        }),\n        {} as { [from: string]: { [to: string]: number } }\n    );\n};\n\n/**\n * Compute critical path and its length from `from` node to `to` node with critical path method.\n * @param from ID of station on the left\n * @param to ID of station on the right\n * @param adjMat Adjacency matrix in the form of `Object` returned from `adjacencyList` method.\n */\nexport const criticalPathMethod = (from: string, to: string, adjMat: ReturnType<typeof adjacencyList>) => {\n    if (from === to) {\n        return { len: 0, nodes: [from] };\n    }\n    let allLengths: number[] = [];\n    let criticalPaths: string[][] = [];\n    Object.keys(adjMat[from]).forEach(child => {\n        let cp = criticalPathMethod(child, to, adjMat);\n        if (cp.len < 0) return;\n        allLengths.push(adjMat[from][child] + cp.len);\n        cp.nodes.unshift(from);\n        criticalPaths.push(cp.nodes);\n    });\n    let maxLength = Math.max(...allLengths);\n    return {\n        len: maxLength,\n        nodes: criticalPaths[allLengths.indexOf(maxLength)],\n    };\n};\n\nexport const getXShareMTR = (stnId: string, adjMat: ReturnType<typeof adjacencyList>, branches: string[][]) => {\n    let criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    if (criticalPath.nodes.includes(stnId)) {\n        return criticalPathMethod(criticalPath.nodes[1], stnId, adjMat).len;\n    } else {\n        // must has 1 parent and 1 child only\n        let branchOfStn = branches.filter(branch => branch.includes(stnId))[0];\n\n        let partSource = stnId;\n        while (!criticalPath.nodes.includes(partSource)) {\n            partSource = branchOfStn[branchOfStn.indexOf(partSource) - 1];\n        }\n        let partSink = stnId;\n        while (!criticalPath.nodes.includes(partSink)) {\n            partSink = branchOfStn[branchOfStn.indexOf(partSink) + 1];\n        }\n\n        let leftOpenJaw = partSource === 'linestart';\n        let rightOpenJaw = partSink === 'lineend';\n\n        // expand to fit\n        let lens = [];\n        if (!leftOpenJaw && !rightOpenJaw) {\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else if (leftOpenJaw) {\n            lens[0] = 0;\n            lens[1] = criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len;\n            lens[2] = criticalPathMethod(branchOfStn[1], stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else {\n            // right open jaw\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, criticalPath.nodes.slice(-2)[0], adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, branchOfStn.slice(-2)[0], adjMat).len;\n        }\n        return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n    }\n};\n\nconst getYShare = (stnId: string, stnList: { [stnId: string]: StationInfo }) => {\n    return Global.getYShareMTR(stnId, stnList);\n};\n\n/**\n * Vertical position (in pixels) of station icon related to vertical position of line.\n */\nexport const getYReal = (stnId: string, param: RMGParam) => {\n    return -getYShare(stnId, param.stn_list) * param.branch_spacing;\n};\n\nconst _isPredecessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx2 !== -1 && idx2 < idx1) return true;\n    }\n    return false;\n};\n\nconst _isSuccessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx1 !== -1 && idx1 < idx2) return true;\n    }\n    return false;\n};\n\nexport const getStnState = (\n    currentId: string,\n    routes: string[][],\n    direction: 'l' | 'r'\n): { [stnId: string]: -1 | 0 | 1 } => {\n    console.log(\"computing stations' states\");\n    return [...new Set(([] as string[]).concat(...routes))].reduce(\n        (acc, cur: string) => ({\n            ...acc,\n            [cur]:\n                cur === currentId\n                    ? 0\n                    : (\n                          direction === ShortDirection.right\n                              ? _isSuccessor(currentId, cur, routes)\n                              : _isPredecessor(currentId, cur, routes)\n                      )\n                    ? 1\n                    : -1,\n        }),\n        {}\n    );\n};\n\nexport class Stations {\n    yShares = {} as { [stnId: string]: number };\n    xShares = {} as { [stnId: string]: number };\n    namePoss = {} as { [stnId: string]: boolean };\n    stnList = {} as StationDict;\n    criticalPath = {} as { len: number; nodes: string[] };\n\n    constructor(data: { stnList?: any; criticalPath?: any }) {\n        this.stnList = data.stnList;\n        this.criticalPath = data.criticalPath;\n    }\n\n    /**\n     * Increment of the weight of in-bound edge of a station, which increases the horizontal interval from its parents.\n     */\n    protected leftWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Increment of the weight of out-bound edge of a station, which increases the horizontal interval from its children.\n     */\n    protected rightWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Path weight from station 1 to station 2 (station 2 must be a child of station 1, otherwise return `-Infinity`).\n     */\n    public pathWeight = (stnId1: string, stnId2: string) => {\n        if (!this.stnList[stnId1].children.includes(stnId2)) {\n            return -Infinity;\n        }\n        return 1 + this.rightWideFactor(stnId1) + this.leftWideFactor(stnId2);\n    };\n\n    protected getYShare(stnId: string, branches?: string[][]): number {\n        if (stnId in this.yShares) return this.yShares[stnId];\n\n        if (\n            ['linestart', 'lineend'].includes(stnId) ||\n            this.stnList[stnId].parents.length > 1 ||\n            this.stnList[stnId].children.length > 1\n        ) {\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n        var stnPred = this.stnList[stnId].parents[0];\n        if (stnPred) {\n            // parent exist\n            if (this.stnList[stnPred].children.length === 1) {\n                // no sibling, then y same as parent\n                let res = this.getYShare(stnPred);\n                this.yShares[stnId] = res;\n                return res;\n            } else {\n                // sibling exists, then y depends on its idx of being children\n                let res: 1 | -1 = this.stnList[stnPred].children.indexOf(stnId) === 0 ? 1 : -1;\n                this.yShares[stnId] = res;\n                return res;\n            }\n        } else {\n            // no parent, must be linestart\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n    }\n\n    static getYShares(stnList: StationDict, branches?: string[][]) {\n        console.log('computing y shares');\n        let stations = new this({ stnList });\n\n        Object.keys(stnList).forEach(stnId => {\n            if (['linestart', 'lineend'].includes(stnId)) return;\n            if (stnId in stations.yShares) return;\n            stations.getYShare(stnId, branches);\n        });\n\n        return stations.yShares;\n    }\n\n    /**\n     * Parameters of the arcs involved in the `<path>` element.\n     */\n    private pathTurnParams = (branchSpacing: number) => {\n        let tr = 35; // turning radius\n        let dx_a = tr / 2; // dx of a\n        let dy_a = tr - dx_a * Math.sqrt(3); // dy of a\n        let dy_l = branchSpacing - 2 * dy_a; // dy of l\n        let dx_l = dy_l * Math.sqrt(3); // dx of l\n        return { tr, dx_a, dy_a, dx_l, dy_l };\n    };\n\n    /**\n     * Path segment from a station towards its southeast (lower-right).\n     */\n    private pathTurnSE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,1 ${dx_a},${dy_a} l ${dx_l},${dy_l} a ${tr},${tr} 0 0,0 ${dx_a},${dy_a}`;\n    };\n\n    /**\n     * Path segment from a station towards its northeast (upper-right).\n     */\n    private pathTurnNE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,0 ${dx_a},${-dy_a} l ${dx_l},${-dy_l} a ${tr},${tr} 0 0,1 ${dx_a},${-dy_a}`;\n    };\n\n    /**\n     * Generate `d` attribute of `<path>` element through all stations input.\n     */\n    protected _linePath(\n        stnIds: string[],\n        lineXs: [number, number],\n        branches: string[][],\n        realXs: { [stnId: string]: number },\n        realYs: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] },\n        e: number\n    ) {\n        var [prevId, prevY, prevX] = [] as unknown as [string, number, number];\n        var path = [] as string[];\n\n        let { dx_a, dx_l } = this.pathTurnParams(branchSpacing);\n        let stnDX = dx_a + dx_l / 2;\n        let stnExtraH = ((lineXs[1] - lineXs[0]) / cp.len) * 2;\n        let stnSpareH = ((lineXs[1] - lineXs[0]) / cp.len - 2 * stnDX) / 2;\n        if (stnSpareH + stnExtraH < 0) {\n            console.warn(`SVG width too small! ${stnSpareH + stnExtraH}`);\n        }\n\n        stnIds.forEach(stnId => {\n            let x = realXs[stnId];\n            let y = realYs[stnId];\n            if (!prevY && prevY !== 0) {\n                [prevId, prevX, prevY] = [stnId, x, y];\n                if (stnIds.length === 1) {\n                    path.push(`M ${x},${y}`);\n                } else if (!branches[0].includes(stnId)) {\n                    // started from branch\n                    path.push(`M ${x},${y}`);\n                } else if (branches[0].includes(stnIds[1])) {\n                    // started from branching station, this is main line\n                    path.push(`M ${x},${y}`);\n                } else {\n                    // started form branching station, this is branch line\n                    if (realXs[stnIds[1]] > 0) {\n                        path.push(`M ${x},${y + e}`);\n                    }\n                    if (realYs[stnIds[1]] < 0) {\n                        path.push(`M ${x},${y - e}`);\n                    }\n                }\n                return;\n            }\n            if (y > prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnSE(branchSpacing));\n            } else if (y < prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnNE(branchSpacing));\n            }\n            path.push(`H ${x}`);\n            [prevId, prevX, prevY] = [stnId, x, y];\n        });\n\n        // simplify path\n        return path.join(' ').replace(/( H ([\\d.]+))+/g, ' H $2');\n    }\n\n    static drawLine(\n        branches: string[][],\n        stnStates: { [stnId: string]: -1 | 0 | 1 },\n        stnList: { [stnId: string]: StationInfo },\n        lineXs: [number, number],\n        xs: { [stnId: string]: number },\n        ys: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] },\n        e: number = 9.68\n    ) {\n        let linePaths = { main: [] as string[], pass: [] as string[] };\n        branches.forEach((branch, i) => {\n            branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n            var lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n            var linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n            if (lineMainStns.length === 1) {\n                linePassStns = branch;\n            }\n\n            if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n                // if two set disjoint\n                if (linePassStns[0] === branch[0]) {\n                    // -1 -1 1 1\n                    linePassStns.push(lineMainStns[0]);\n                } else if (\n                    lineMainStns[0] === branch[0] &&\n                    lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n                    linePassStns.length\n                ) {\n                    linePassStns = branch;\n                    lineMainStns = [];\n                } else {\n                    // 1 1 -1 -1\n                    linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n                }\n            }\n\n            linePaths.main.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    lineMainStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp,\n                    e\n                )\n            );\n            linePaths.pass.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    linePassStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp,\n                    e\n                )\n            );\n        });\n\n        return linePaths;\n    }\n}\n\nexport const drawLine = (branches: string[][], stnStates: { [stnId: string]: -1 | 0 | 1 }) => {\n    let linePaths = { main: [] as string[][], pass: [] as string[][] };\n    branches.forEach(branch => {\n        branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n        var lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n        var linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n        if (lineMainStns.length === 1) {\n            linePassStns = branch;\n        }\n\n        if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n            // if two set disjoint\n            if (linePassStns[0] === branch[0]) {\n                // -1 -1 1 1\n                linePassStns.push(lineMainStns[0]);\n            } else if (\n                lineMainStns[0] === branch[0] &&\n                lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n                linePassStns.length\n            ) {\n                linePassStns = branch;\n                lineMainStns = [];\n            } else {\n                // 1 1 -1 -1\n                linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n            }\n        }\n\n        linePaths.main.push(lineMainStns);\n        linePaths.pass.push(linePassStns);\n    });\n\n    return linePaths;\n};\n","import { Stations } from './share';\n\nexport class StationsMTR extends Stations {\n    protected leftWideFactor = (stnId: string) => {\n        var res = 0;\n        let { transfer } = this.stnList[stnId];\n        let ls = transfer.info.map(val => val.length);\n        if (transfer.tick_direc === 'l') {\n            // int3 or above\n            if (!ls[1] && ls[0] > 1) res += 0.8;\n            // osi except osi22\n            if (ls[1] && (ls[0] !== 1 || ls[1] !== 2)) res += 0.8;\n        }\n        if (ls[0] === 1 && ls[1] === 2) {\n            // osi22 not end\n            if (this.stnList[stnId].parents[0] !== 'linestart' && this.stnList[stnId].children[0] !== 'lineend')\n                res += 0.8;\n        }\n        if (this.stnList[stnId].parents.length === 2) res += 0.4;\n        if (this.stnList[this.stnList[stnId].parents[0]].children.length === 2) res += 0.4;\n        return res;\n    };\n\n    protected rightWideFactor = (stnId: string) => {\n        var res = 0;\n        let { transfer } = this.stnList[stnId];\n        let ls = transfer.info.map(val => val.length);\n        if (transfer.tick_direc === 'r') {\n            // int3 or above\n            if (!ls[1] && ls[0] > 1) res += 0.8;\n            // osi except osi22\n            if (ls[1] && (ls[0] !== 1 || ls[1] !== 2)) res += 0.8;\n        }\n        if (ls[0] === 1 && ls[1] === 2) {\n            // osi22 not end\n            if (this.stnList[stnId].parents[0] !== 'linestart' && this.stnList[stnId].children[0] !== 'lineend')\n                res += 0.8;\n        }\n        if (this.stnList[stnId].children.length === 2) res += 0.4;\n        if (this.stnList[this.stnList[stnId].children[0]].parents.length === 2) res += 0.4;\n        return res;\n    };\n}\n"],"sourceRoot":""}