"use strict";(self.webpackChunkrail_map_generator=self.webpackChunkrail_map_generator||[]).push([[5701],{5495:function(e,n,t){t.r(n),t.d(n,{default:function(){return ie}});var r=t(5861),o=t(885),i=t(7757),s=t.n(i),a=t(2791),c=t(6489),l=t(2020),u=t(1288),d=t(283),p=t(2067),h=t(8096),f=t(1969),m=t(9418),x=t(159),g=t(7447),j=t(4446),v=t(3594),Z=t(5159),y=t(4026),b=t(7253),C=t(6068),w=t(269),k=t(6513),S=t(6030),_=t(713),T=t(6169),A=t(8539),R=t(8679),G=t(184);function N(){var e=(0,l.$)().t,n=(0,S.I0)(),t=(0,T.CG)((function(e){return e.app})).canvasToShow,i=a.useState(!1),c=(0,o.Z)(i,2),u=c[0],d=c[1],p=a.useState({}),g=(0,o.Z)(p,2),j=g[0],v=g[1];return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(h.Z,{button:!0,component:"label",htmlFor:"upload-param",children:[(0,G.jsx)(f.Z,{children:(0,G.jsx)(m.Z,{children:"folder_open"})}),(0,G.jsx)(x.Z,{primary:e("file.open.button")})]}),(0,G.jsx)("input",{type:"file",accept:"application/json",style:{display:"none"},id:"upload-param",onChange:function(e){console.log(e.target.files[0]),new Promise((function(n){var t=new FileReader;t.onloadend=n,t.readAsText(e.target.files[0])})).then((function(e){return JSON.parse(e.target.result)})).then((function(e){v(e),d(!0)}))}}),(0,G.jsx)(M,{open:u,onClose:function(e){return(0,r.Z)(s().mark((function r(){var o,i;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("close"!==e){r.next=4;break}return document.getElementById("upload-param").value="",d(!1),r.abrupt("return");case 4:if("accept"!==e){r.next=17;break}return r.prev=5,o=(0,b.db)(j),r.next=9,window.rmgStorage.writeFile("rmgParam",JSON.stringify(o));case 9:i=_.tK[j.style].some((function(e){return e===t}))?t:_.iu,n((0,A.SC)(i)),(0,R.P)(o),r.next=17;break;case 14:r.prev=14,r.t0=r.catch(5),console.error(r.t0);case 17:case"end":return r.stop()}}),r,null,[[5,14]])})))},content:j})]})}function M(e){var n,t=(0,l.$)().t;return(0,G.jsxs)(v.Z,{onClose:e.onClose("close"),open:e.open,children:[(0,G.jsx)(Z.Z,{children:"Your Configuration"}),(0,G.jsx)(y.Z,{dividers:!0,children:(0,G.jsx)(C.Z,{style:{whiteSpace:"pre-line"},children:0===Object.keys(e.content).length?"empty":(n=e.content,"Number of stations: ".concat(Object.keys(n.stn_list).length-2,"\n                ").concat(Object.entries(n.stn_list).map((function(e){return["linestart","lineend"].includes(e[0])?"":e[1].name.join(" - ")})).join("\r\n").trim().replace(/\\/," ")))})}),(0,G.jsxs)(w.Z,{children:[(0,G.jsx)(k.Z,{onClick:e.onClose("close"),color:"primary",children:t("dialog.cancel")}),(0,G.jsx)(k.Z,{onClick:e.onClose("accept"),color:"primary",autoFocus:!0,children:"Import"})]})]})}var F=t(7762),L=t(2982),E=t(4942),I=t(5587),O=t.n(I),P=t(8596),q=t(2288),$=t(4212),z=t(8528),W=t(9403),B=t(5247),H=t(8302),D=t(533),U=t(9858),Y=t(4193),J=(0,P.Z)((function(e){return(0,q.Z)({contentWrapper:(0,E.Z)({display:"flex",overflow:"hidden",paddingTop:e.spacing(1),paddingBottom:e.spacing(1),paddingLeft:e.spacing(3),paddingRight:e.spacing(3)},e.breakpoints.down("xs"),{flexDirection:"column"}),contentCanvas:{flex:1},contentControl:{flexGrow:0,flexShrink:0,display:"flex",flexDirection:"column",minWidth:250},contentAction:{display:"flex",alignSelf:"end"},contentRoot:{padding:"unset","&:first-child":{paddingTop:"unset"}},contentControlContent:{display:"flex",flexDirection:"column",justifyContent:"space-between"},formControlRoot:{margin:0}})}));function K(e){var n=(0,l.$)().t,i=J(),c=(0,T.TL)(),u=(0,T.CG)((function(e){return e.param.stn_list})),d=(0,T.CG)((function(e){return e.param.line_name})),f=(0,T.CG)((function(e){return e.param.current_stn_idx})),m=(0,T.CG)((function(e){return e.param.style})),j=(0,a.useState)(document.createElement("svg")),b=(0,o.Z)(j,2),C=b[0],S=b[1],A=(0,a.useState)(!1),R=(0,o.Z)(A,2),N=R[0],M=R[1],E=(0,a.useState)(!1),I=(0,o.Z)(E,2),P=I[0],q=I[1],K=(0,a.useState)(!1),Q=(0,o.Z)(K,2),X=Q[0],ee=Q[1],ne=(0,a.useState)(1),te=(0,o.Z)(ne,2),re=te[0],oe=te[1],ie=(0,a.useState)("png"),se=(0,o.Z)(ie,2),ae=se[0],ce=se[1],le=(0,a.useState)(!1),ue=(0,o.Z)(le,2),de=ue[0],pe=ue[1],he=(0,a.useState)(!1),fe=(0,o.Z)(he,2),me=fe[0],xe=fe[1],ge=a.useRef(null);(0,a.useEffect)((function(){if(""===e.canvas)return S(document.createElement("svg")),void M(!1);je().then((function(e){S(e),M(!0)}))}),[e.canvas]);var je=function(){var n=(0,r.Z)(s().mark((function n(){var r,i,a,c,l,u,d,p,h,f;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=["--rmg-svg-width","--rmg-svg-height"].map((function(n){return document.querySelector("svg#".concat(e.canvas)).style.getPropertyValue(n).match(/\d+/g)[0]})).map(Number),c=(0,o.Z)(a,2),l=c[1],(u=document.querySelector("svg#".concat(e.canvas)).cloneNode(!0)).setAttribute("height",(l*re).toString()),u.style.setProperty("all","initial"),["share",e.canvas].map((function(e){var n;return(0,L.Z)((null===(n=(0,L.Z)(document.querySelectorAll("link")).filter((function(n){return n.id==="css_"+e}))[0])||void 0===n?void 0:n.sheet).cssRules).map((function(e){return e.cssText})).join(" ")})).forEach((function(e){var n=document.createElement("style");n.textContent=e,u.prepend(n)})),null===(r=u.querySelector("rect#canvas-border"))||void 0===r||r.setAttribute("stroke",P?"black":"none"),null===(i=u.querySelector("rect#canvas-bg"))||void 0===i||i.setAttribute("fill",X?"none":"white"),m!==_.RM.MTR){n.next=25;break}return n.prev=8,n.next=11,t.e(4913).then(t.bind(t,773));case 11:return d=n.sent,p=d.getBase64FontFace,n.next=15,p(u);case 15:h=n.sent,(f=document.createElement("style")).textContent=h.join("\n"),u.prepend(f),n.next=25;break;case 21:n.prev=21,n.t0=n.catch(8),alert("Failed to fonts. Fonts in the exported PNG will be missing."),console.error(n.t0);case 25:return n.abrupt("return",u);case 26:case"end":return n.stop()}}),n,null,[[8,21]])})));return function(){return n.apply(this,arguments)}}(),ve=function(){var e=(0,r.Z)(s().mark((function e(n){var t,r,o,i,a,l,p,h,m,x;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new(O()),r=(0,F.Z)(n),e.prev=2,r.s();case 4:if((o=r.n()).done){e.next=27;break}return i=o.value,e.next=8,c((0,D.lS)(i));case 8:return e.next=10,je();case 10:if(a=e.sent,document.body.appendChild(a),l="rmg.".concat(i,".").concat(u[i].name[0],".").concat(u[i].name[1]).replaceAll(" ","_"),"png"!==ae){e.next=23;break}return e.next=16,(0,U.Bu)(a,re);case 16:if(p=e.sent,!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")){e.next=20;break}return e.next=20,new Promise((function(e){setTimeout((function(){console.log("Sleep 1 second for Safari"),e()}),1e3)}));case 20:n.length>1?t.file("".concat(l,".png"),p):(0,Y.vI)("".concat(l,".png"),p),e.next=24;break;case 23:"svg"===ae&&(a.removeAttribute("height"),h="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(a.outerHTML))),n.length>1?t.file("".concat(l,".svg"),h.split("base64,")[1],{base64:!0}):(0,Y.CP)("".concat(l,".svg"),"image/svg+xml",a.outerHTML));case 24:document.body.removeChild(a);case 25:e.next=4;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(2),r.e(e.t0);case 32:return e.prev=32,r.f(),e.finish(32);case 35:if(!(n.length>1)){e.next=41;break}return e.next=38,t.generateAsync({type:"blob"});case 38:m=e.sent,x="rmg.".concat(d[0],".").concat(d[1],".zip").replaceAll(" ","_"),(0,Y.vI)(x,m);case 41:return e.next=43,c((0,D.lS)(f));case 43:case"end":return e.stop()}}),e,null,[[2,29,32,35]])})));return function(n){return e.apply(this,arguments)}}(),Ze=function(n){return function(){if("downloadCurrentStation"===n)ve([f]);else if("downloadAllStation"===n){var t=Object.keys(u).filter((function(e){return!["linestart","lineend"].includes(e)}));ve(t)}e.onClose("close")}};return(0,G.jsxs)(v.Z,{onClose:Ze("close"),open:e.open,maxWidth:!1,children:[(0,G.jsx)(Z.Z,{children:n("file.preview.title")}),(0,G.jsxs)("div",{className:i.contentWrapper,children:[(0,G.jsx)(y.Z,{dangerouslySetInnerHTML:{__html:C.outerHTML},ref:ge,className:i.contentCanvas,classes:{root:i.contentRoot}}),(0,G.jsx)("div",{className:i.contentControl,children:(0,G.jsxs)(y.Z,{classes:{root:i.contentRoot},className:i.contentControlContent,children:[(0,G.jsxs)(p.Z,{component:"div",disablePadding:!0,children:[(0,G.jsxs)(h.Z,{children:[(0,G.jsx)(x.Z,{primary:n("file.preview.transparent")}),(0,G.jsx)($.Z,{children:(0,G.jsx)(z.Z,{color:"primary",checked:X,onChange:function(e,n){var t;null===(t=C.querySelector("rect#canvas-bg"))||void 0===t||t.setAttribute("fill",n?"none":"white"),ee(n)},disabled:!N})})]}),(0,G.jsx)(g.Z,{variant:"middle"}),(0,G.jsxs)(h.Z,{children:[(0,G.jsx)(x.Z,{primary:n("file.preview.border")}),(0,G.jsx)($.Z,{children:(0,G.jsx)(z.Z,{color:"primary",checked:P,onChange:function(e,n){var t;null===(t=C.querySelector("rect#canvas-border"))||void 0===t||t.setAttribute("stroke",n?"black":"none"),q(n)},disabled:!N})})]}),(0,G.jsx)(g.Z,{variant:"middle"}),(0,G.jsxs)(h.Z,{children:[(0,G.jsx)(x.Z,{primary:n("file.preview.scale")}),(0,G.jsx)($.Z,{children:(0,G.jsx)(W.Z,{native:!0,value:re,onChange:function(e){var n=e.target.value;C.setAttribute("height",(Number(C.getAttribute("height"))/re*n).toString()),oe(n)},disabled:!N,children:[.25,.33,.5,.67,.75,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5].map((function(e){return(0,G.jsx)("option",{value:e,children:(100*e).toFixed(0)+"%"},e)}))})})]}),(0,G.jsx)(g.Z,{variant:"middle"}),(0,G.jsxs)(h.Z,{children:[(0,G.jsx)(x.Z,{primary:n("file.preview.format")}),(0,G.jsx)($.Z,{children:(0,G.jsxs)(W.Z,{native:!0,value:ae,onChange:function(e){return ce(e.target.value)},style:{width:65},disabled:!N,children:[(0,G.jsx)("option",{value:"png",children:"PNG"}),(0,G.jsx)("option",{value:"svg",children:"SVG (Web Use)"})]})})]})]}),(0,G.jsxs)(h.Z,{style:{padding:0},children:[(0,G.jsx)(B.Z,{color:"primary",size:"small",checked:de,onChange:function(e,n){return pe(n)}}),(0,G.jsxs)(H.Z,{variant:"body2",children:[n("file.preview.terms.accept"),(0,G.jsx)(H.Z,{component:"a",color:"primary",variant:"body2",style:{cursor:"pointer"},onClick:function(){return xe(!0)},children:n("file.preview.terms.tandc")})]}),(0,G.jsx)(V,{open:me,onClose:function(){return xe(!1)}})]})]})})]}),(0,G.jsx)("div",{className:i.contentAction,children:(0,G.jsxs)(w.Z,{children:[(0,G.jsx)(k.Z,{variant:"contained",onClick:Ze("downloadCurrentStation"),color:"primary",disabled:!N||!de,children:n("file.preview.downloadCurrentStation")}),(0,G.jsx)(k.Z,{variant:"contained",onClick:Ze("downloadAllStation"),color:"primary",disabled:!N||!de||m===_.RM.GZMTR,children:n("file.preview.downloadAllStations")}),(0,G.jsx)(k.Z,{variant:"outlined",onClick:Ze("close"),color:"primary",autoFocus:!0,children:n("dialog.cancel")})]})})]})}var V=function(e){var n=(0,l.$)().t;return(0,a.useMemo)((function(){return(0,G.jsxs)(v.Z,{open:e.open,onClose:e.onClose,children:[(0,G.jsx)(Z.Z,{children:n("file.preview.terms.tandc")}),(0,G.jsxs)(y.Z,{dividers:!0,children:[(0,G.jsx)(H.Z,{component:"p",children:"The downloaded image may be modified, published, or used for other purposes, under the following conditions."}),(0,G.jsxs)(H.Z,{component:"ol",children:[(0,G.jsxs)(H.Z,{component:"li",children:["The layout of the elements on the sign or rail map, is designed by"," ",(0,G.jsx)(H.Z,{component:"a",color:"primary",href:"http://www.gzmtr.com",target:"_blank",children:"Guangzhou Metro Corporation"}),","," ",(0,G.jsx)(H.Z,{component:"a",color:"primary",href:"http://www.mtr.com.hk",target:"_blank",children:"MTR Corporation"})," ","or"," ",(0,G.jsx)(H.Z,{component:"a",color:"primary",href:"http://www.shmetro.com",target:"_blank",children:"Shanghai Shentong Metro Group"}),", depending on your selection. You shall grant appropriate permit or license from the relevant company above before using the downloaded image for commercial purposes, if it is required to do so."]}),(0,G.jsxs)(H.Z,{component:"li",children:["The elements including shapes and lines on the image are drawn by"," ",(0,G.jsx)(H.Z,{component:"a",color:"primary",href:"https://github.com/wongchito",target:"_blank",children:"Chito Wong"})," ","and"," ",(0,G.jsx)(H.Z,{component:"a",color:"primary",href:"https://github.com/thekingofcity",target:"_blank",children:"thekingofcity"}),", based on the design standards or rules of the companies listed above. You may use them for any purposes, but it is recommended to state the name and the link of software alongside."]}),(0,G.jsxs)(H.Z,{component:"li",children:["The fonts of the Chinese characters in MTR style are provided by"," ",(0,G.jsx)(H.Z,{component:"a",color:"primary",href:"https://github.com/ButTaiwan/genyo-font",target:"_blank",children:"ButTaiwan"})," ","while all others fonts are rendered from local files. You shall grant appropriate permit or license from the manufacturers before using the downloaded image for commercial purposes."]})]}),(0,G.jsx)(H.Z,{component:"p",children:"We reserve the rights, without notice, to modify, add, or remove these terms."}),(0,G.jsx)(H.Z,{component:"p",children:"\u672c\u689d\u6b3e\u53ca\u7d30\u5247\u66ab\u53ea\u63d0\u4f9b\u82f1\u6587\u7248\uff0c\u656c\u8acb\u539f\u8ad2\u3002"}),(0,G.jsx)(H.Z,{component:"p",variant:"body2",children:"Last modified: 30 Nov 2021, 18:30 UTC"})]}),(0,G.jsx)(w.Z,{children:(0,G.jsx)(k.Z,{variant:"outlined",color:"primary",onClick:e.onClose,children:n("dialog.close")})})]})}),[e.open])};var Q=function(e){var n=(0,l.$)().t,t=(0,T.CG)((function(e){return e.param.style})),r=(0,T.CG)((function(e){return e.app.canvasToShow})),i=a.useState(!1),s=(0,o.Z)(i,2),c=s[0],u=s[1],d=a.useState(""),f=(0,o.Z)(d,2),m=f[0],g=f[1],j=function(n){return function(){"close"!==n&&(u(!0),g(n)),e.onClose("close")}};return(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(v.Z,{onClose:j("close"),open:e.open,children:[(0,G.jsx)(Z.Z,{children:n("file.export.title")}),(0,G.jsx)(y.Z,{dividers:!0,children:(0,G.jsx)(p.Z,{children:(r===_.iu?_.tK[t]:[r]).map((function(e){return(0,G.jsx)(h.Z,{button:!0,onClick:j(e),children:(0,G.jsx)(x.Z,{primary:n("file.export."+e)})},e)}))})})]}),(0,G.jsx)(K,{open:c,onClose:function(e){"close"===e&&(u(!1),g(""))},canvas:m})]})},X=t(3504),ee=a.lazy((function(){return t.e(7818).then(t.bind(t,5893))}));var ne={en:"English","zh-Hans":"\u4e2d\u6587\uff08\u7b80\u4f53\uff09","zh-HK":"\u4e2d\u6587\uff08\u9999\u6e2f\uff09"},te=function(){var e=(0,l.$)(),n=e.t,t=e.i18n,i=(0,T.CG)((function(e){return e.param.style})),c=(0,T.CG)((function(e){return e.param})),u=(0,a.useState)(!1),v=(0,o.Z)(u,2),Z=v[0],y=v[1],C=(0,a.useState)(!1),w=(0,o.Z)(C,2),k=w[0],S=w[1],_=(0,a.useState)(!1),A=(0,o.Z)(_,2),R=A[0],M=A[1],F=(0,a.useState)(!1),L=(0,o.Z)(F,2),E=L[0],I=L[1],O=function(){var e=(0,r.Z)(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(n=document.createElement("a")).href="data:application/json;charset=uft-8,"+encodeURIComponent(JSON.stringify(c)),n.download="rmg.param."+(new Date).toISOString()+".json",n.click();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,G.jsxs)("div",{children:[(0,G.jsxs)(d.Z,{children:[(0,G.jsxs)(p.Z,{component:"nav",children:[(0,G.jsxs)(h.Z,{button:!0,onClick:function(){return y(!0)},children:[(0,G.jsx)(f.Z,{children:(0,G.jsx)(m.Z,{children:"note_add"})}),(0,G.jsx)(x.Z,{primary:n("file.new.button")})]}),(0,G.jsx)(N,{}),(0,G.jsxs)(h.Z,{button:!0,onClick:O,children:[(0,G.jsx)(f.Z,{children:(0,G.jsx)(m.Z,{children:"save"})}),(0,G.jsx)(x.Z,{primary:n("file.save")})]}),(0,G.jsxs)(h.Z,{button:!0,onClick:function(){return S(!0)},children:[(0,G.jsx)(f.Z,{children:(0,G.jsx)(m.Z,{children:"cloud_download"})}),(0,G.jsx)(x.Z,{primary:n("file.export.button")})]})]}),(0,G.jsx)(g.Z,{}),(0,G.jsxs)(p.Z,{component:"nav",children:[(0,G.jsxs)(h.Z,{button:!0,onClick:function(){return M(!0)},children:[(0,G.jsx)(f.Z,{children:(0,G.jsx)(m.Z,{children:"style"})}),(0,G.jsx)(x.Z,{primary:n("file.style.button"),secondary:n("file.style."+i)})]}),(0,G.jsxs)(h.Z,{button:!0,onClick:function(){return I(!0)},children:[(0,G.jsx)(f.Z,{children:(0,G.jsx)(m.Z,{children:"translate"})}),(0,G.jsx)(x.Z,{primary:n("file.lang.button"),secondary:(0,b.YL)(ne,t.languages)})]})]})]}),(0,G.jsx)(a.Suspense,{fallback:(0,G.jsx)(j.Z,{}),children:(0,G.jsx)(ee,{open:Z,onClose:function(){return y(!1)}})}),(0,G.jsx)(Q,{open:k,onClose:function(e){S(!1)}}),(0,G.jsx)(re,{open:R,onClose:function(e){"close"===e||e===i||window.gtag("event","set",{event_category:"style",event_label:e}),M(!1)}}),(0,G.jsx)(oe,{open:E,onClose:function(){return I(!1)}})]})};function re(e){var n=(0,l.$)().t,t=(0,T.TL)(),r=function(n){return function(){t((0,D.yL)(n)),e.onClose(n)}};return(0,G.jsxs)(v.Z,{onClose:function(){return e.onClose("close")},open:e.open,children:[(0,G.jsx)(Z.Z,{children:n("file.style.title")}),(0,G.jsx)(y.Z,{dividers:!0,children:(0,G.jsx)(p.Z,{children:Object.values(_.RM).map((function(e){return(0,G.jsx)(X.rU,{to:"/"+e,style:{textDecoration:"none",color:"unset"},children:(0,G.jsx)(h.Z,{button:!0,onClick:r(e),children:(0,G.jsx)(x.Z,{primary:n("file.style."+e)})})},e)}))})})]})}function oe(e){var n=(0,l.$)(),t=n.t,r=n.i18n;return(0,G.jsxs)(v.Z,{onClose:e.onClose,open:e.open,children:[(0,G.jsx)(Z.Z,{children:t("file.lang.title")}),(0,G.jsx)(y.Z,{dividers:!0,children:(0,G.jsx)(p.Z,{children:Object.keys(ne).map((function(n){return(0,G.jsx)(h.Z,{button:!0,onClick:function(){return(t=n)===r.language||(r.changeLanguage(t).then((function(e){return document.title=e("title")})),window.gtag("event","set",{event_category:"language",event_label:t}),document.documentElement.setAttribute("lang",t)),void e.onClose();var t},children:(0,G.jsx)(x.Z,{primary:ne[n]})},n)}))})})]})}var ie=function(){var e=(0,c.Z)()(te);return(0,G.jsx)(u.Z,{container:!0,spacing:3,justifyContent:"center",alignItems:"center",children:(0,G.jsx)(u.Z,{item:!0,xs:12,sm:8,md:6,lg:4,children:(0,G.jsx)(e,{})})})}}}]);
//# sourceMappingURL=panelSave.4611594c.chunk.js.map