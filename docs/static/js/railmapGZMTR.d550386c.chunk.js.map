{"version":3,"sources":["svgs/railmap/main/line-box-gzmtr.tsx","svgs/railmap/main/station/station-gzmtr.tsx","svgs/railmap/main/main-gzmtr.tsx","svgs/railmap/railmap-gzmtr.tsx","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutPropertiesLoose.js","svgs/railmap/methods/share.ts","svgs/strip/strip-gzmtr.tsx","svgs/station-num-gzmtr.tsx"],"names":["memo","props","textAnchor","fill","stnState","MonoColour","white","info","xlinkHref","LineBoxNameSpan","name","slice","LineBoxName","prevProps","nextProps","toString","nameZHEl","dy","match","forEach","t","i","isNaN","Number","push","dominantBaseline","fontSize","nameZHGroupEl","useRef","useState","width","zhBBox","setZhBBox","useEffect","current","getBBox","nameZHGroupScale","nameENEl","enBBox","setEnBBox","nameENScale","ref","y","navigator","userAgent","includes","className","transform","replace","length","sharedText","idx","nameEl","x","bBox","setBBox","nameScale","trim","StationGZMTR","param","useContext","ParamContext","stnInfo","stn_list","stnId","isNameShift","parents","children","tickRotation","stnY","indexOf","branch","left","right","nameENLns","split","nameDX","Math","cos","intInfos","theme","line_name","concat","transfer","stroke","lineNum","line_num","stnNum","num","secondaryName","isExpress","services","Services","express","StationNameGElement","nameDY","stnNameEl","secNameEl","secNameBBox","setSecNameBBox","prevBBox","StationName","StationSecondaryName","secName","ExpressTag","forwardRef","useMemo","map","txt","React","IntGroup","strokeWidth","IntTicks","others","IntBoxs","other","wideFactor","stnList","MainGZMTR","branches","routes","deps","adjMat","adjacencyList","xShares","console","log","Object","keys","reduce","acc","cur","criticalPath","criticalPathMethod","nodes","len","branchOfStn","filter","partSource","partSink","leftOpenJaw","rightOpenJaw","lens","getXShare","JSON","stringify","realCP","lineXs","direction","svgWidth","railmap","padding","xs","yShares","ys","branch_spacing","stnStates","getStnState","current_stn_idx","linePaths","drawLine","paths","stns","_linePath","id","style","y_pc","Line","Array","strokeDasharray","pass","path","d","main","stnIds","realXs","realYs","prevY","join","StationGroup","DefsGZMTR","RailMapGZMTR","variant","info_panel_type","isShowLight","isShowPSD","psd_num","TerminusFlag","notesGZMTR","note","NoteBox","x2","strokeLinecap","height","rx","DirectionIndicator","validDests","Set","textGroupProps","destIds","direction_gz_x","direction_gz_y","DirectionIndicatorTextGroup","DirectionIndicatorTextGroup2","charCounts","minCharCounts","min","charSpacing","abs","letterSpacing","max","noteTextEl","textLength","lengthAdjust","_objectWithoutProperties","source","excluded","key","target","sourceKeys","getOwnPropertySymbols","sourceSymbolKeys","prototype","propertyIsEnumerable","call","leftW","rightW","a","c","from","to","allLengths","criticalPaths","child","cp","unshift","maxLength","getXShareMTR","currentId","stnId1","stnId2","route","idx1","idx2","_isSuccessor","_isPredecessor","Stations","data","namePoss","leftWideFactor","rightWideFactor","pathWeight","Infinity","pathTurnParams","branchSpacing","dy_a","tr","sqrt","dy_l","dx_a","dx_l","pathTurnSE","pathTurnNE","this","stnPred","res","getYShare","e","prevId","prevX","stnDX","stnExtraH","stnSpareH","warn","stations","lineMainStns","linePassStns","StripGZMTR","stripHeight","indicatorLight","cy","r","ry","PSD","isInStrip","psdDy","black","StationNumberText","LINE_NUM_MAX_WIDTH","lineNumEl","lineNumScale","stnNumScale"],"mappings":"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","file":"static/js/railmapGZMTR.d550386c.chunk.js","sourcesContent":["import React, { memo, useEffect, useRef, useState } from 'react';\nimport { InterchangeInfo, MonoColour, Name } from '../../../constants/constants';\n\nexport default memo(\n    function LineBox(props: { info: InterchangeInfo; stnState: -1 | 0 | 1 }) {\n        return (\n            <g textAnchor=\"middle\" fill={props.stnState === -1 ? MonoColour.white : props.info[3]}>\n                <use xlinkHref=\"#intbox\" fill={props.stnState === -1 ? '#aaa' : props.info[2]} />\n                {props.info[4][0] === props.info[5][0] ? (\n                    <LineBoxNameSpan name={props.info.slice(-2) as Name} />\n                ) : (\n                    <LineBoxName name={props.info.slice(-2) as Name} />\n                )}\n            </g>\n        );\n    },\n    (prevProps, nextProps) =>\n        prevProps.info.toString() === nextProps.info.toString() && prevProps.stnState === nextProps.stnState\n);\n\nconst LineBoxName = memo(\n    (props: { name: Name }) => {\n        let nameZHEl = [] as JSX.Element[];\n        let dy = 0;\n        props.name[0].match(/\\d+|\\D+/g)?.forEach((t, i) => {\n            if (isNaN(Number(t))) {\n                // text\n                nameZHEl.push(\n                    <tspan key={i} dominantBaseline=\"hanging\" dy={1 - dy}>\n                        {t}\n                    </tspan>\n                );\n                dy += 1 - dy;\n            } else {\n                // number\n                nameZHEl.push(\n                    <tspan key={i} dominantBaseline=\"hanging\" fontSize={16} dy={-dy}>\n                        {t}\n                    </tspan>\n                );\n                dy = 0;\n            }\n        });\n\n        const nameZHGroupEl = useRef<SVGTextElement | null>(null);\n        const [zhBBox, setZhBBox] = useState({ width: 0 } as DOMRect);\n        useEffect(\n            () => setZhBBox(nameZHGroupEl.current!.getBBox()),\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n            [props.name[0]]\n        );\n        const nameZHGroupScale = zhBBox.width > 43.5 ? 43.5 / zhBBox.width : 1;\n\n        const nameENEl = useRef<SVGTextElement | null>(null);\n        const [enBBox, setEnBBox] = useState({ width: 0 } as DOMRect);\n        useEffect(\n            () => setEnBBox(nameENEl.current!.getBBox()),\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n            [props.name[1]]\n        );\n        const nameENScale = enBBox.width > 43.5 ? 43.5 / enBBox.width : 1;\n\n        return (\n            <>\n                <text\n                    ref={nameZHGroupEl}\n                    y={navigator.userAgent.includes('Firefox') ? -0.5 : 2}\n                    className=\"rmg-name__zh\"\n                    fontSize={12}\n                    transform={`scale(${nameZHGroupScale},1)`}\n                >\n                    {nameZHEl}\n                </text>\n                <text\n                    ref={nameENEl}\n                    y={19.5}\n                    fontSize={props.name[1].replace('\\\\', ' ').length > 10 ? 7 : 8}\n                    className=\"rmg-name__en\"\n                    transform={`scale(${nameENScale},1)`}\n                >\n                    {props.name[1]}\n                </text>\n            </>\n        );\n    },\n    (prevProps, nextProps) => prevProps.name.toString() === nextProps.name.toString()\n);\n\nconst LineBoxNameSpan = memo(\n    (props: { name: Name }) => {\n        let sharedText = '';\n        for (let idx in [...props.name[0]]) {\n            if (props.name[0][idx] === props.name[1][idx]) {\n                sharedText += props.name[0][idx];\n            } else {\n                break;\n            }\n        }\n\n        const nameEl = useRef<SVGTextElement | null>(null);\n        const [bBox, setBBox] = useState({ x: 0, width: 0 } as DOMRect);\n        useEffect(\n            () => setBBox(nameEl.current!.getBBox()),\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n            [props.name.toString()]\n        );\n\n        const nameScale = bBox.width > 43.5 ? 43.5 / bBox.width : 1;\n\n        // unsymmetrical scaling, wrap with <g>\n        return (\n            <g transform={`scale(${nameScale},1)`}>\n                <g transform={`translate(${-bBox.x - bBox.width / 2},0)`}>\n                    <text ref={nameEl} className=\"rmg-name__zh\" fontSize={14} y={12} textAnchor=\"end\">\n                        {sharedText}\n                        <tspan className=\"rmg-name__zh\" fontSize={8} x={0} dy={-2} textAnchor=\"start\">\n                            {props.name[0].slice(sharedText.length)}\n                        </tspan>\n                        <tspan className=\"rmg-name__en\" fontSize={4} x={0} dy={6} textAnchor=\"start\">\n                            {props.name[1].slice(sharedText.length).trim()}\n                        </tspan>\n                    </text>\n                </g>\n            </g>\n        );\n    },\n    (prevProps, nextProps) => prevProps.name.toString() === nextProps.name.toString()\n);\n","import React, { forwardRef, useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport { ParamContext } from '../../../../context';\nimport StationNumberText from '../../../station-num-gzmtr';\nimport LineBox from '../line-box-gzmtr';\nimport { InterchangeInfo, Name, Services } from \"../../../../constants/constants\";\n\ninterface Props {\n    stnId: string;\n    stnState: -1 | 0 | 1;\n    stnY: number;\n}\n\nconst StationGZMTR = (props: Props) => {\n    const { param } = useContext(ParamContext);\n    const stnInfo = param.stn_list[props.stnId];\n\n    const isNameShift = stnInfo.parents.length === 2 || stnInfo.children.length === 2;\n    const tickRotation =\n        props.stnY > 0\n            ? 180\n            : stnInfo.parents.indexOf(stnInfo.branch.left[1] || '') === 1 ||\n              stnInfo.children.indexOf(stnInfo.branch.right[1] || '') === 1\n            ? 180\n            : 0;\n    const nameENLns = stnInfo.name[1].split('\\\\').length;\n    const nameDX = isNameShift\n        ? tickRotation === 180\n            ? 16 + (nameENLns - 1) * 12 * Math.cos(-45)\n            : -9\n        : tickRotation === 180\n        ? -6\n        : (25 + (nameENLns - 1) * 15) * Math.cos(-45);\n\n    return (\n        <>\n            <IntGroup\n                intInfos={\n                    isNameShift\n                        ? (([\n                              [\n                                  param.theme[0],\n                                  param.theme[1],\n                                  'var(--rmg-theme-colour)',\n                                  'var(--rmg-theme-fg)',\n                                  param.line_name[0],\n                                  param.line_name[1],\n                              ],\n                          ] as any[]) as InterchangeInfo[]).concat(stnInfo.transfer.info[0])\n                        : stnInfo.transfer.info[0]\n                }\n                stnState={props.stnState}\n                tickRotation={tickRotation}\n            />\n            <g>\n                <use xlinkHref=\"#stn\" stroke={props.stnState === -1 ? '#aaa' : 'var(--rmg-theme-colour)'} />\n                <StationNumberText\n                    className={`Name ${props.stnState === -1 ? 'Pass' : 'Future'}`}\n                    lineNum={param.line_num}\n                    stnNum={stnInfo.num}\n                />\n            </g>\n            <g transform={`translate(${-nameDX},0)`}>\n                <StationNameGElement\n                    name={stnInfo.name}\n                    secondaryName={stnInfo.secondaryName}\n                    stnState={props.stnState}\n                    tickRotation={tickRotation}\n                    isExpress={stnInfo.services.includes(Services.express)}\n                />\n            </g>\n        </>\n    );\n};\n\nexport default StationGZMTR;\n\ninterface StationNameGElementProps {\n    name: Name;\n    secondaryName: false | Name;\n    stnState: -1 | 0 | 1;\n    tickRotation: 0 | 180;\n    isExpress: boolean;\n}\n\nconst StationNameGElement = (props: StationNameGElementProps) => {\n    const nameDY = props.tickRotation === 180 ? 17.5 : -20 - props.name[1].split('\\\\').length * 14 * Math.cos(-45);\n\n    const stnNameEl = useRef<SVGGElement | null>(null);\n    const [bBox, setBBox] = useState({ width: 0 } as DOMRect);\n    useEffect(\n        () => setBBox(stnNameEl.current!.getBBox()),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.name.toString()]\n    );\n\n    const secNameEl = useRef<SVGGElement | null>(null);\n    const [secNameBBox, setSecNameBBox] = useState({ x: 0, width: -20 } as SVGRect);\n    useEffect(\n        () => {\n            if (secNameEl.current) {\n                setSecNameBBox(secNameEl.current.getBBox());\n            } else {\n                setSecNameBBox(prevBBox => {\n                    const { x } = prevBBox;\n                    return { x, width: -20 } as SVGRect;\n                });\n            }\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.secondaryName.toString()]\n    );\n\n    return (\n        <g\n            textAnchor={props.tickRotation === 180 ? 'end' : 'start'}\n            className={`Name ${props.stnState === -1 ? 'Pass' : props.stnState === 0 ? 'CurrentGZ' : 'Future'}`}\n            transform={`translate(0,${nameDY})rotate(-45)`}\n        >\n            <StationName ref={stnNameEl} name={props.name} />\n            {props.secondaryName && (\n                <g\n                    transform={`translate(${(bBox.width + secNameBBox.width / 2 + 10) *\n                        (props.tickRotation === 180 ? -1 : 1)},${2 + 5 * (props.name[1].split('\\\\').length - 1)})`}\n                    className={`Name ${props.stnState === -1 ? 'Pass' : 'Future'}`}\n                >\n                    <g transform=\"translate(0,3)\" fontSize={18}>\n                        <text textAnchor=\"end\" x={secNameBBox.x - 3} className=\"rmg-name__zh\">\n                            {'('}\n                        </text>\n                        <text textAnchor=\"start\" x={secNameBBox.width + secNameBBox.x + 3} className=\"rmg-name__zh\">\n                            {')'}\n                        </text>\n                    </g>\n                    <StationSecondaryName ref={secNameEl} secName={props.secondaryName} />\n                </g>\n            )}\n            {props.isExpress && (\n                <ExpressTag\n                    fill={props.stnState === -1 ? '#aaa' : 'var(--rmg-theme-colour)'}\n                    transform={`translate(${(bBox.width + secNameBBox.width + 20 + 35) *\n                        (props.tickRotation === 180 ? -1 : 1)},${2 + 5 * (props.name[1].split('\\\\').length - 1)})`}\n                />\n            )}\n        </g>\n    );\n};\n\nconst StationName = forwardRef((props: { name: Name }, ref: React.Ref<SVGGElement>) =>\n    useMemo(\n        () => (\n            <g ref={ref}>\n                <text className=\"rmg-name__zh\" fontSize={18}>\n                    {props.name[0]}\n                </text>\n                <g fontSize={10.5}>\n                    {props.name[1].split('\\\\').map((txt, i) => (\n                        <text key={i} className=\"rmg-name__en\" dy={16 + i * 11}>\n                            {txt}\n                        </text>\n                    ))}\n                </g>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.name[0], props.name[1]]\n    )\n);\n\nconst StationSecondaryName = forwardRef((props: { secName: Name }, ref: React.Ref<SVGGElement>) =>\n    useMemo(\n        () => (\n            <g ref={ref} textAnchor=\"middle\">\n                <text className=\"rmg-name__zh\" fontSize={13}>\n                    {props.secName[0]}\n                </text>\n                <text dy={10} className=\"rmg-name__en\" fontSize={6.5}>\n                    {props.secName[1]}\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.secName.toString()]\n    )\n);\n\nconst ExpressTag = React.memo((props: React.SVGProps<SVGGElement>) => (\n    <g textAnchor=\"middle\" {...props}>\n        <text className=\"rmg-name__zh\" fontSize={13}>\n            快车停靠站\n        </text>\n        <text dy={10} className=\"rmg-name__en\" fontSize={6.5}>\n            Express Station\n        </text>\n    </g>\n));\n\ninterface IntGroupProps {\n    intInfos: InterchangeInfo[];\n    stnState: -1 | 0 | 1;\n    tickRotation: 0 | 180;\n}\n\nconst IntGroup = (props: IntGroupProps) => (\n    <>\n        <IntTicks strokeWidth={4} {...props} />\n        <IntBoxs transform={`translate(0,${props.tickRotation === 180 ? -47 : 23})`} {...props} />\n    </>\n);\n\nconst IntTicks = (props: IntGroupProps & React.SVGProps<SVGGElement>) => {\n    const { intInfos, stnState, tickRotation, ...others } = props;\n\n    return (\n        <g {...others}>\n            {intInfos.map((info, i) => (\n                <use\n                    key={i}\n                    xlinkHref=\"#inttick\"\n                    stroke={stnState === -1 ? '#aaa' : info[2]}\n                    transform={`translate(${-2 * (intInfos.length - 1) + 4 * i},0)rotate(${\n                        tickRotation === 180 ? 180 : 0\n                    })`}\n                />\n            ))}\n        </g>\n    );\n};\n\nconst IntBoxs = (props: IntGroupProps & React.SVGProps<SVGGElement>) => {\n    const { intInfos, tickRotation, stnState, ...other } = props;\n\n    return (\n        <g {...other}>\n            {intInfos.map((info, i) => (\n                <g key={i} transform={`translate(0,${i * 28 * (tickRotation === 180 ? -1 : 1)})`}>\n                    <LineBox info={info} stnState={stnState} />\n                </g>\n            ))}\n        </g>\n    );\n};\n","import React, { useMemo } from 'react';\nimport { ParamContext } from '../../../context';\nimport StationGZMTR from './station/station-gzmtr';\nimport LineBox from './line-box-gzmtr';\nimport { adjacencyList, criticalPathMethod, drawLine, getStnState } from '../methods/share';\nimport { InterchangeInfo, StationDict } from \"../../../constants/constants\";\n\nconst wideFactor = (stnList: StationDict, stnId: string) =>\n    stnList[stnId].parents.length === 2 || stnList[stnId].children.length === 2 ? 0.25 : 0;\n\nconst getXShare = (stnId: string, adjMat: ReturnType<typeof adjacencyList>, branches: string[][]): number => {\n    let criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    if (criticalPath.nodes.includes(stnId)) {\n        return criticalPathMethod(criticalPath.nodes[1], stnId, adjMat).len;\n    } else {\n        // must has 1 parent and 1 child only\n        let branchOfStn = branches.filter(branch => branch.includes(stnId))[0];\n        let partSource = stnId;\n        while (!criticalPath.nodes.includes(partSource)) {\n            partSource = branchOfStn[branchOfStn.indexOf(partSource) - 1];\n        }\n        let partSink = stnId;\n        while (!criticalPath.nodes.includes(partSink)) {\n            partSink = branchOfStn[branchOfStn.indexOf(partSink) + 1];\n        }\n\n        let leftOpenJaw = partSource === 'linestart';\n        let rightOpenJaw = partSink === 'lineend';\n\n        if (branchOfStn.toString() === branches[0].toString()) {\n            // station on main line, expand to fit\n            let lens = [];\n            if (!leftOpenJaw && !rightOpenJaw) {\n                lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n                lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n                lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n            } else if (leftOpenJaw) {\n                lens[0] = 0;\n                lens[1] = criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len;\n                lens[2] = criticalPathMethod(branchOfStn[1], stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n            } else {\n                // right open jaw\n                lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n                lens[1] = criticalPathMethod(partSource, criticalPath.nodes.slice(-2)[0], adjMat).len;\n                lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, branchOfStn.slice(-2)[0], adjMat).len;\n            }\n            return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n        } else {\n            if (!leftOpenJaw && !rightOpenJaw) {\n                let lens = [];\n                lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n                lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n                lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n                lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n                return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n            } else if (leftOpenJaw) {\n                return (\n                    criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len -\n                    criticalPathMethod(stnId, partSink, adjMat).len\n                );\n            } else {\n                // right open jaw\n                return (\n                    criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len +\n                    criticalPathMethod(partSource, stnId, adjMat).len\n                );\n            }\n        }\n    }\n};\n\nconst MainGZMTR = () => {\n    const { param, branches, routes, deps } = React.useContext(ParamContext);\n\n    const adjMat = adjacencyList(param.stn_list, wideFactor, wideFactor);\n\n    const xShares = useMemo(\n        () => {\n            console.log('computing x shares');\n            return Object.keys(param.stn_list).reduce(\n                (acc, cur) => ({ ...acc, [cur]: getXShare(cur, adjMat, branches) }),\n                {} as { [stnId: string]: number }\n            );\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [branches.toString(), JSON.stringify(adjMat)]\n    );\n\n    const criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    const realCP = criticalPathMethod(criticalPath.nodes[1], criticalPath.nodes.slice(-2)[0], adjMat);\n\n    const lineXs: [number, number] =\n        param.direction === 'r'\n            ? [\n                  (param.svgWidth.railmap * param.padding) / 100 + 65,\n                  param.svgWidth.railmap * (1 - param.padding / 100) - 20,\n              ]\n            : [(param.svgWidth.railmap * param.padding) / 100, param.svgWidth.railmap * (1 - param.padding / 100) - 65];\n    const xs = Object.keys(xShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: lineXs[0] + (xShares[cur] / realCP.len) * (lineXs[1] - lineXs[0]) }),\n        {} as typeof xShares\n    );\n\n    const yShares = useMemo(\n        () => {\n            console.log('computing y shares');\n            return Object.keys(param.stn_list).reduce((acc, cur) => {\n                if (branches[0].includes(cur)) {\n                    return { ...acc, [cur]: 0 };\n                } else {\n                    let branchOfStn = branches.slice(1).filter(branch => branch.includes(cur))[0];\n                    return { ...acc, [cur]: param.stn_list[branchOfStn[0]].children.indexOf(branchOfStn[1]) ? -2 : 2 };\n                }\n            }, {} as { [stnId: string]: number });\n        },\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [deps]\n    );\n    const ys = Object.keys(yShares).reduce(\n        (acc, cur) => ({ ...acc, [cur]: -yShares[cur] * param.branch_spacing }),\n        {} as typeof yShares\n    );\n\n    const stnStates = useMemo(\n        () => getStnState(param.current_stn_idx, routes, param.direction),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [param.current_stn_idx, param.direction, routes.toString()]\n    );\n\n    const linePaths = drawLine(branches, stnStates);\n    const paths = (Object.keys(linePaths) as (keyof ReturnType<typeof drawLine>)[]).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: linePaths[cur].map(stns => _linePath(stns, xs, ys)),\n        }),\n        {} as { [key in keyof ReturnType<typeof drawLine>]: string[] }\n    );\n\n    return (\n        <g\n            id=\"main\"\n            style={{\n                ['--y-percentage' as any]: param.y_pc,\n                transform: 'translateY(calc(var(--y-percentage) * var(--rmg-svg-height) / 100))',\n            }}\n        >\n            <Line paths={paths} />\n            <StationGroup xs={xs} ys={ys} stnStates={stnStates} />\n            <g\n                id=\"line_name\"\n                style={{\n                    ['--translate-x' as any]: param.direction === 'r' ? `${lineXs[0] - 65}px` : `${lineXs[1] + 65}px`,\n                }}\n            >\n                <LineBox\n                    info={\n                        Array(2).concat(\n                            ['var(--rmg-theme-colour)', 'var(--rmg-theme-fg)'],\n                            param.line_name\n                        ) as InterchangeInfo\n                    }\n                    stnState={1}\n                />\n            </g>\n        </g>\n    );\n};\n\nexport default MainGZMTR;\n\nconst Line = React.memo(\n    (props: { paths: { main: string[]; pass: string[] } }) => (\n        <g fill=\"none\" strokeWidth={4}>\n            <g stroke=\"#aaa\" strokeDasharray={4}>\n                {props.paths.pass.map((path, i) => (\n                    <path key={i} d={path} />\n                ))}\n            </g>\n            <g stroke=\"var(--rmg-theme-colour)\">\n                {props.paths.main.map((path, i) => (\n                    <path key={i} d={path} />\n                ))}\n            </g>\n        </g>\n    ),\n    (prevProps, nextProps) => JSON.stringify(prevProps.paths) === JSON.stringify(nextProps.paths)\n);\n\nconst _linePath = (stnIds: string[], realXs: { [stnId: string]: number }, realYs: { [stnId: string]: number }) => {\n    let prevY: number;\n    var path = [] as string[];\n\n    stnIds.forEach(stnId => {\n        let x = realXs[stnId];\n        let y = realYs[stnId];\n        if (!prevY && prevY !== 0) {\n            prevY = y;\n            path.push(`M ${x},${y}`);\n            return;\n        }\n        if (y === 0) {\n            if (y < prevY) path.push(`H ${x - 40}`, 'a 40,40 0 0,0 40,-40', `V ${y}`);\n            if (y > prevY) path.push(`H ${x - 40}`, 'a 40,40 0 0,1 40,40', `V ${y}`);\n        } else {\n            if (y < prevY) path.push(`V ${y + 40}`, 'a 40,40 0 0,1 40,-40', `H ${x}`);\n            if (y > prevY) path.push(`V ${y - 40}`, 'a 40,40 0 0,0 40,40', `H ${x}`);\n        }\n        path.push(`H ${x}`);\n        prevY = y;\n    });\n\n    // simplify path\n    return path.join(' ').replace(/( H ([\\d.]+))+/g, ' H $2');\n};\n\ninterface StationGroupProps {\n    xs: { [stnId: string]: number };\n    ys: { [stnId: string]: number };\n    stnStates: { [stnId: string]: -1 | 0 | 1 };\n}\n\nconst StationGroup = (props: StationGroupProps) => {\n    const { param } = React.useContext(ParamContext);\n\n    return (\n        <g id=\"stn_icons\">\n            {Object.keys(param.stn_list)\n                .filter(stnId => !['linestart', 'lineend'].includes(stnId))\n                .map(stnId => (\n                    <g\n                        key={stnId}\n                        style={{\n                            transform: `translate(${props.xs[stnId]}px,${props.ys[stnId]}px)`,\n                        }}\n                    >\n                        <StationGZMTR stnId={stnId} stnState={props.stnStates[stnId]} stnY={props.ys[stnId]} />\n                    </g>\n                ))}\n        </g>\n    );\n};\n","import * as React from 'react';\nimport { ParamContext } from '../../context';\nimport StripGZMTR from '../strip/strip-gzmtr';\nimport MainGZMTR from './main/main-gzmtr';\nimport { Note } from \"../../constants/constants\";\n\nconst RailMapGZMTR = () => {\n    const { param } = React.useContext(ParamContext);\n    return (\n        <>\n            <DefsGZMTR />\n\n            <StripGZMTR\n                variant={param.info_panel_type}\n                isShowLight={param.info_panel_type === 'gz2otis'}\n                isShowPSD={param.info_panel_type === 'gz2otis' && param.psd_num}\n            />\n\n            {(param.direction === 'l' && param.stn_list[param.current_stn_idx].parents.includes('linestart')) ||\n            (param.direction === 'r' && param.stn_list[param.current_stn_idx].children.includes('lineend')) ? (\n                <TerminusFlag />\n            ) : (\n                <>\n                    <MainGZMTR />\n                    <DirectionIndicator />\n                    {param.notesGZMTR.map((note, i) => (\n                        <NoteBox key={i} note={note} />\n                    ))}\n                </>\n            )}\n\n            {param.info_panel_type === 'gz2otis' && (\n                <line x2={param.svgWidth.railmap} transform=\"translate(0,90)\" strokeWidth={3} stroke=\"black\" />\n            )}\n        </>\n    );\n};\n\nexport default RailMapGZMTR;\n\nconst DefsGZMTR = React.memo(() => (\n    <defs>\n        <path\n            id=\"stn\"\n            className=\"rmg-stn\"\n            d=\"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 \"\n        />\n        <path\n            id=\"stn_pass\"\n            stroke=\"#aaa\"\n            fill=\"#fff\"\n            strokeWidth={2}\n            d=\"M 0,9.25 V -9.25 H -9.25 a 9.25,9.25 0 0,0 0,18.5 h 18.5 a 9.25,9.25 0 0,0 0,-18.5 H 0 \"\n        />\n        <path id=\"arrow_direction\" d=\"M 60,60 L 0,0 L 60,-60 H 100 L 55,-15 H 160 V 15 H 55 L 100,60z\" fill=\"black\" />\n\n        <path id=\"inttick\" d=\"M 0,0 v 18\" strokeLinecap=\"square\" />\n        <rect id=\"intbox\" x={-22.5} height={24} width={45} rx={4.5} />\n    </defs>\n));\n\nconst DirectionIndicator = () => {\n    const { param, routes } = React.useContext(ParamContext);\n\n    const validDests = React.useMemo(\n        () => [\n            ...new Set(\n                routes\n                    .reduce(\n                        (acc, cur) =>\n                            cur.includes(param.current_stn_idx)\n                                ? acc.concat(\n                                      cur\n                                          .filter((stnId) => !['linestart', 'lineend'].includes(stnId))\n                                          .slice(param.direction === 'l' ? 0 : -1)[0]\n                                  )\n                                : acc,\n                        []\n                    )\n                    .filter((id) => id !== param.current_stn_idx)\n            ),\n        ],\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [param.current_stn_idx, param.direction, routes.toString()]\n    );\n\n    const textGroupProps: TextGroupProps = {\n        textAnchor: param.direction === 'l' ? 'start' : 'end',\n        transform: `translate(${param.direction === 'l' ? 65 : -65},-5)`,\n        destIds: validDests,\n    };\n\n    return (\n        <g\n            id=\"direction_gz\"\n            style={{ ['--x-percentage' as any]: param.direction_gz_x, ['--y-percentage' as any]: param.direction_gz_y }}\n        >\n            <use\n                xlinkHref=\"#arrow_direction\"\n                style={{ ['--rotate' as any]: param.direction === 'l' ? '0deg' : '180deg' }}\n            />\n\n            {validDests.length !== 2 ? (\n                <DirectionIndicatorTextGroup {...textGroupProps} />\n            ) : (\n                <DirectionIndicatorTextGroup2 {...textGroupProps} />\n            )}\n        </g>\n    );\n};\n\ntype TextGroupProps = {\n    destIds: string[];\n} & React.SVGProps<SVGGElement>;\n\nconst DirectionIndicatorTextGroup = (props: TextGroupProps) => {\n    const { destIds, ...others } = props;\n    const { param } = React.useContext(ParamContext);\n    return (\n        <g {...others}>\n            <text className=\"rmg-name__zh\" fontSize={28}>\n                {destIds.map((stnId) => param.stn_list[stnId].name[0]).join('/') + '方向'}\n            </text>\n            <text className=\"rmg-name__en\" fontSize={14} dy={22}>\n                {'Towards ' + destIds.map((stnId) => param.stn_list[stnId].name[1].replace('\\\\', ' ')).join('/')}\n            </text>\n        </g>\n    );\n};\n\nconst DirectionIndicatorTextGroup2 = (props: TextGroupProps) => {\n    const { destIds, ...others } = props;\n    const { param } = React.useContext(ParamContext);\n\n    const charCounts = destIds.map((stnId) => param.stn_list[stnId].name[0].length);\n    const minCharCounts = Math.min(...charCounts);\n    const charSpacing =\n        minCharCounts > 1 && charCounts[0] !== charCounts[1]\n            ? Math.abs(charCounts[0] - charCounts[1]) / (minCharCounts - 1)\n            : 0;\n\n    return (\n        <g {...others}>\n            {destIds.map((id, i) => (\n                <React.Fragment key={id}>\n                    <text\n                        className=\"rmg-name__zh\"\n                        fontSize={25}\n                        x={param.direction === 'l' ? 0 : -75}\n                        y={-21 + 42 * i}\n                        letterSpacing={charCounts[i] > charCounts[1 - i] ? '0em' : `${charSpacing}em`}\n                    >\n                        {param.stn_list[id].name[0]}\n                    </text>\n                    <text\n                        className=\"rmg-name__en\"\n                        fontSize={11.5}\n                        x={param.direction === 'l' ? 0 : -75}\n                        y={-1 + 42 * i}\n                    >\n                        {'Towards ' + param.stn_list[id].name[1].replace('\\\\', ' ')}\n                    </text>\n                </React.Fragment>\n            ))}\n            <text\n                className=\"rmg-name__zh\"\n                fontSize={28}\n                x={param.direction === 'l' ? 25 * (Math.max(...charCounts) + 1) : 0}\n                y={5}\n            >\n                方向\n            </text>\n        </g>\n    );\n};\n\nconst TerminusFlag = React.memo(() => (\n    <g id=\"terminus_gz\" textAnchor=\"middle\">\n        <text className=\"rmg-name__zh\" fontSize={90}>\n            终 点 站\n        </text>\n        <text dy={70} className=\"rmg-name__en\" fontSize={36}>\n            Terminal\n        </text>\n        <g strokeWidth={8} stroke=\"#000\">\n            <path d=\"M -160,68 h -160\" />\n            <path d=\"M 160,68 h 160\" />\n        </g>\n    </g>\n));\n\nconst NoteBox = React.memo(\n    (props: { note: Note }) => {\n        const noteTextEl = React.useRef<SVGGElement | null>(null);\n        const [bBox, setBBox] = React.useState({ width: 0, height: 0, y: 0 } as DOMRect);\n        React.useEffect(\n            () => setBBox(noteTextEl.current!.getBBox()),\n            // eslint-disable-next-line react-hooks/exhaustive-deps\n            [props.note[0], props.note[1]]\n        );\n\n        return (\n            <g\n                className=\"note-box\"\n                style={{ ['--x-percentage' as any]: props.note[2], ['--y-percentage' as any]: props.note[3] }}\n            >\n                {props.note[4] && (\n                    <rect\n                        height={bBox.height + 4}\n                        width={bBox.width + 4}\n                        x={-2}\n                        y={bBox.y - 2}\n                        fill=\"none\"\n                        stroke=\"black\"\n                        strokeWidth={0.5}\n                    />\n                )}\n                <g ref={noteTextEl}>\n                    <g fontSize={16} letterSpacing={1.2}>\n                        {props.note[0].split('\\n').map((txt, i) => (\n                            <text key={i} className=\"rmg-name__zh\" y={i * 18}>\n                                {txt}\n                            </text>\n                        ))}\n                    </g>\n\n                    <g\n                        fontSize={10}\n                        letterSpacing={0.33}\n                        transform={`translate(0,${18 * props.note[0].split('\\n').length})`}\n                    >\n                        {props.note[1].split('\\n').map((txt, i) => (\n                            <text\n                                key={i}\n                                className=\"rmg-name__en\"\n                                y={i * 11}\n                                textLength={\n                                    i < (props.note[1].match(/\\n/g)?.length || 0)\n                                        ? bBox.width\n                                        : navigator.userAgent.includes('Firefox')\n                                        ? -1\n                                        : 0\n                                }\n                                lengthAdjust=\"spacing\"\n                            >\n                                {txt}\n                            </text>\n                        ))}\n                    </g>\n                </g>\n            </g>\n        );\n    },\n    (prevProps, nextProps) => prevProps.note.toString() === nextProps.note.toString()\n);\n","import objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nexport default function _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}","export default function _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}","import * as Global from '../../../methods';\nimport { RMGParam, StationDict, StationInfo } from \"../../../constants/constants\";\n\n/**\n * Compute the adjacency list of the graph.\n * @param stnList Key-value pairs of station info\n * @param leftW Callback of left wide factor\n * @param rightW Callback of right wide factor\n */\nexport const adjacencyList = (\n    stnList: { [stnId: string]: StationInfo },\n    leftW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number,\n    rightW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number\n) => {\n    return Object.keys(stnList).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: stnList[cur].children.reduce(\n                (a, c) => ({ ...a, [c]: 1 + leftW(stnList, c) + rightW(stnList, cur) }),\n                {}\n            ),\n        }),\n        {} as { [from: string]: { [to: string]: number } }\n    );\n};\n\n/**\n * Compute critical path and its length from `from` node to `to` node with critical path method.\n * @param from ID of station on the left\n * @param to ID of station on the right\n * @param adjMat Adjacency matrix in the form of `Object` returned from `adjacencyList` method.\n */\nexport const criticalPathMethod = (from: string, to: string, adjMat: ReturnType<typeof adjacencyList>) => {\n    if (from === to) {\n        return { len: 0, nodes: [from] };\n    }\n    let allLengths: number[] = [];\n    let criticalPaths: string[][] = [];\n    Object.keys(adjMat[from]).forEach(child => {\n        let cp = criticalPathMethod(child, to, adjMat);\n        if (cp.len < 0) return;\n        allLengths.push(adjMat[from][child] + cp.len);\n        cp.nodes.unshift(from);\n        criticalPaths.push(cp.nodes);\n    });\n    let maxLength = Math.max(...allLengths);\n    return {\n        len: maxLength,\n        nodes: criticalPaths[allLengths.indexOf(maxLength)],\n    };\n};\n\nexport const getXShareMTR = (stnId: string, adjMat: ReturnType<typeof adjacencyList>, branches: string[][]) => {\n    let criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    if (criticalPath.nodes.includes(stnId)) {\n        return criticalPathMethod(criticalPath.nodes[1], stnId, adjMat).len;\n    } else {\n        // must has 1 parent and 1 child only\n        let branchOfStn = branches.filter(branch => branch.includes(stnId))[0];\n\n        let partSource = stnId;\n        while (!criticalPath.nodes.includes(partSource)) {\n            partSource = branchOfStn[branchOfStn.indexOf(partSource) - 1];\n        }\n        let partSink = stnId;\n        while (!criticalPath.nodes.includes(partSink)) {\n            partSink = branchOfStn[branchOfStn.indexOf(partSink) + 1];\n        }\n\n        let leftOpenJaw = partSource === 'linestart';\n        let rightOpenJaw = partSink === 'lineend';\n\n        // expand to fit\n        let lens = [];\n        if (!leftOpenJaw && !rightOpenJaw) {\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else if (leftOpenJaw) {\n            lens[0] = 0;\n            lens[1] = criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len;\n            lens[2] = criticalPathMethod(branchOfStn[1], stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else {\n            // right open jaw\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, criticalPath.nodes.slice(-2)[0], adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, branchOfStn.slice(-2)[0], adjMat).len;\n        }\n        return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n    }\n};\n\nconst getYShare = (stnId: string, stnList: { [stnId: string]: StationInfo }) => {\n    return Global.getYShareMTR(stnId, stnList);\n};\n\n/**\n * Vertical position (in pixels) of station icon related to vertical position of line.\n */\nexport const getYReal = (stnId: string, param: RMGParam) => {\n    return -getYShare(stnId, param.stn_list) * param.branch_spacing;\n};\n\nconst _isPredecessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx2 !== -1 && idx2 < idx1) return true;\n    }\n    return false;\n};\n\nconst _isSuccessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx1 !== -1 && idx1 < idx2) return true;\n    }\n    return false;\n};\n\nexport const getStnState = (\n    currentId: string,\n    routes: string[][],\n    direction: 'l' | 'r'\n): { [stnId: string]: -1 | 0 | 1 } => {\n    console.log(\"computing stations' states\");\n    return [...new Set(([] as string[]).concat(...routes))].reduce(\n        (acc, cur: string) => ({\n            ...acc,\n            [cur]:\n                cur === currentId\n                    ? 0\n                    : (direction === 'r'\n                        ? _isSuccessor(currentId, cur, routes)\n                        : _isPredecessor(currentId, cur, routes))\n                    ? 1\n                    : -1,\n        }),\n        {}\n    );\n};\n\nexport class Stations {\n    yShares = {} as { [stnId: string]: number };\n    xShares = {} as { [stnId: string]: number };\n    namePoss = {} as { [stnId: string]: boolean };\n    stnList = {} as StationDict;\n    criticalPath = {} as { len: number; nodes: string[] };\n\n    constructor(data: { stnList?: any; criticalPath?: any }) {\n        this.stnList = data.stnList;\n        this.criticalPath = data.criticalPath;\n    }\n\n    /**\n     * Increment of the weight of in-bound edge of a station, which increases the horizontal interval from its parents.\n     */\n    protected leftWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Increment of the weight of out-bound edge of a station, which increases the horizontal interval from its children.\n     */\n    protected rightWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Path weight from station 1 to station 2 (station 2 must be a child of station 1, otherwise return `-Infinity`).\n     */\n    public pathWeight = (stnId1: string, stnId2: string) => {\n        if (!this.stnList[stnId1].children.includes(stnId2)) {\n            return -Infinity;\n        }\n        return 1 + this.rightWideFactor(stnId1) + this.leftWideFactor(stnId2);\n    };\n\n    protected getYShare(stnId: string, branches?: string[][]): number {\n        if (stnId in this.yShares) return this.yShares[stnId];\n\n        if (\n            ['linestart', 'lineend'].includes(stnId) ||\n            this.stnList[stnId].parents.length > 1 ||\n            this.stnList[stnId].children.length > 1\n        ) {\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n        var stnPred = this.stnList[stnId].parents[0];\n        if (stnPred) {\n            // parent exist\n            if (this.stnList[stnPred].children.length === 1) {\n                // no sibling, then y same as parent\n                let res = this.getYShare(stnPred);\n                this.yShares[stnId] = res;\n                return res;\n            } else {\n                // sibling exists, then y depends on its idx of being children\n                let res: 1 | -1 = this.stnList[stnPred].children.indexOf(stnId) === 0 ? 1 : -1;\n                this.yShares[stnId] = res;\n                return res;\n            }\n        } else {\n            // no parent, must be linestart\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n    }\n\n    static getYShares(stnList: StationDict, branches?: string[][]) {\n        console.log('computing y shares');\n        let stations = new this({ stnList });\n\n        Object.keys(stnList).forEach(stnId => {\n            if (['linestart', 'lineend'].includes(stnId)) return;\n            if (stnId in stations.yShares) return;\n            stations.getYShare(stnId, branches);\n        });\n\n        return stations.yShares;\n    }\n\n    /**\n     * Parameters of the arcs involved in the `<path>` element.\n     */\n    private pathTurnParams = (branchSpacing: number) => {\n        let tr = 35; // turning radius\n        let dx_a = tr / 2; // dx of a\n        let dy_a = tr - dx_a * Math.sqrt(3); // dy of a\n        let dy_l = branchSpacing - 2 * dy_a; // dy of l\n        let dx_l = dy_l * Math.sqrt(3); // dx of l\n        return { tr, dx_a, dy_a, dx_l, dy_l };\n    };\n\n    /**\n     * Path segment from a station towards its southeast (lower-right).\n     */\n    private pathTurnSE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,1 ${dx_a},${dy_a} l ${dx_l},${dy_l} a ${tr},${tr} 0 0,0 ${dx_a},${dy_a}`;\n    };\n\n    /**\n     * Path segment from a station towards its northeast (upper-right).\n     */\n    private pathTurnNE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,0 ${dx_a},${-dy_a} l ${dx_l},${-dy_l} a ${tr},${tr} 0 0,1 ${dx_a},${-dy_a}`;\n    };\n\n    /**\n     * Generate `d` attribute of `<path>` element through all stations input.\n     */\n    protected _linePath(\n        stnIds: string[],\n        lineXs: [number, number],\n        branches: string[][],\n        realXs: { [stnId: string]: number },\n        realYs: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] },\n        e: number,\n    ) {\n        var [prevId, prevY, prevX] = ([] as unknown) as [string, number, number];\n        var path = [] as string[];\n\n        let { dx_a, dx_l } = this.pathTurnParams(branchSpacing);\n        let stnDX = dx_a + dx_l / 2;\n        let stnExtraH = ((lineXs[1] - lineXs[0]) / cp.len) * 0.8;\n        let stnSpareH = ((lineXs[1] - lineXs[0]) / cp.len - 2 * stnDX) / 2;\n        if (stnSpareH + stnExtraH < 0) {\n            console.warn(`SVG width too small! ${stnSpareH + stnExtraH}`);\n        }\n\n        stnIds.forEach(stnId => {\n            let x = realXs[stnId];\n            let y = realYs[stnId];\n            if (!prevY && prevY !== 0) {\n                [prevId, prevX, prevY] = [stnId, x, y];\n                if (stnIds.length === 1) {\n                    path.push(`M ${x},${y}`);\n                } else if (!branches[0].includes(stnId)) {\n                    // started from branch\n                    path.push(`M ${x},${y}`);\n                } else if (branches[0].includes(stnIds[1])) {\n                    // started from branching station, this is main line\n                    path.push(`M ${x},${y}`);\n                } else {\n                    // started form branching station, this is branch line\n                    if (realXs[stnIds[1]] > 0) {\n                        path.push(`M ${x},${y + e}`);\n                    }\n                    if (realYs[stnIds[1]] < 0) {\n                        path.push(`M ${x},${y - e}`);\n                    }\n                }\n                return;\n            }\n            if (y > prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnSE(branchSpacing));\n            } else if (y < prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnNE(branchSpacing));\n            }\n            path.push(`H ${x}`);\n            [prevId, prevX, prevY] = [stnId, x, y];\n        });\n\n        // simplify path\n        return path.join(' ').replace(/( H ([\\d.]+))+/g, ' H $2');\n    }\n\n    static drawLine(\n        branches: string[][],\n        stnStates: { [stnId: string]: -1 | 0 | 1 },\n        stnList: { [stnId: string]: StationInfo },\n        lineXs: [number, number],\n        xs: { [stnId: string]: number },\n        ys: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] },\n        e: number = 9.68\n    ) {\n        let linePaths = { main: [] as string[], pass: [] as string[] };\n        branches.forEach((branch, i) => {\n            branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n            var lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n            var linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n            if (lineMainStns.length === 1) {\n                linePassStns = branch;\n            }\n\n            if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n                // if two set disjoint\n                if (linePassStns[0] === branch[0]) {\n                    // -1 -1 1 1\n                    linePassStns.push(lineMainStns[0]);\n                } else if (\n                    lineMainStns[0] === branch[0] &&\n                    lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n                    linePassStns.length\n                ) {\n                    linePassStns = branch;\n                    lineMainStns = [];\n                } else {\n                    // 1 1 -1 -1\n                    linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n                }\n            }\n\n            linePaths.main.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    lineMainStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp,\n                    e\n                )\n            );\n            linePaths.pass.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    linePassStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp,\n                    e\n                )\n            );\n        });\n\n        return linePaths;\n    }\n}\n\nexport const drawLine = (branches: string[][], stnStates: { [stnId: string]: -1 | 0 | 1 }) => {\n    let linePaths = { main: [] as string[][], pass: [] as string[][] };\n    branches.forEach(branch => {\n        branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n        var lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n        var linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n        if (lineMainStns.length === 1) {\n            linePassStns = branch;\n        }\n\n        if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n            // if two set disjoint\n            if (linePassStns[0] === branch[0]) {\n                // -1 -1 1 1\n                linePassStns.push(lineMainStns[0]);\n            } else if (\n                lineMainStns[0] === branch[0] &&\n                lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n                linePassStns.length\n            ) {\n                linePassStns = branch;\n                lineMainStns = [];\n            } else {\n                // 1 1 -1 -1\n                linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n            }\n        }\n\n        linePaths.main.push(lineMainStns);\n        linePaths.pass.push(linePassStns);\n    });\n\n    return linePaths;\n};\n","import React from 'react';\nimport { MonoColour, PanelTypeGZMTR, PanelTypeShmetro } from '../../constants/constants';\n\ninterface Props {\n    variant: PanelTypeGZMTR | PanelTypeShmetro;\n    isShowLight: boolean;\n    isShowPSD: false | string;\n}\n\nconst StripGZMTR = (props: Props) => {\n    const stripHeight = ((variant) => {\n        switch (variant) {\n            case 'gz28':\n            case 'gz2otis':\n            case 'gz6':\n            case 'gzgf':\n                return 60;\n            case 'gz1':\n            case 'gz3':\n                return 40;\n            case 'gz4':\n            case 'gz5':\n            case 'gz1421':\n                return 20;\n            default:\n                return 0;\n        }\n    })(props.variant);\n\n    const indicatorLight = React.useMemo(() => {\n        switch (props.variant) {\n            case 'gz1':\n                return <circle cy={-58} r={16} fill=\"red\" />;\n            case 'gz28':\n            case 'gz2otis':\n                return <ellipse cy={-30} rx={24} ry={12} fill=\"orange\" />;\n            case 'gz3':\n                return <rect x={-15} y={-55} height={30} width={30} fill=\"red\" />;\n            case 'gz6':\n                return <ellipse cy={-30} rx={24} ry={12} fill=\"white\" />;\n            case 'gz1421':\n                return <ellipse cy={-38} rx={24} ry={12} fill=\"orange\" />;\n            case 'gz5':\n                return <rect x={-30} y={-70} height={30} width={60} fill=\"orange\" />;\n            case 'gz4':\n                return <rect x={-50} y={-50} height={25} width={100} fill=\"whitesmoke\" />;\n            case 'gzgf':\n                return <rect x={-30} y={-58} height={30} width={60} fill=\"orange\" />;\n            default:\n                return <></>;\n        }\n    }, [props.variant]);\n\n    const stripDy = -20;\n\n    return (\n        <g transform={`translate(0,${props.variant === 'gz4' ? stripDy : 0})`}>\n            <rect\n                id=\"strip_gz\"\n                style={{\n                    ['--height' as any]: `${stripHeight}px`,\n                }}\n            />\n            <g\n                style={{\n                    transform: 'translate(calc(var(--rmg-svg-width) / 2),var(--rmg-svg-height))',\n                }}\n            >\n                {props.isShowLight && indicatorLight}\n            </g>\n            {props.isShowPSD !== false && <PSD {...props} />}\n        </g>\n    );\n};\n\nexport default StripGZMTR;\n\nconst PSD = React.memo(\n    (props: Props) => {\n        /**\n         * Flag of whether PSD number is stick within the strip area. If `true`, should fill with white, otherwise, fill with theme colour.\n         */\n        const isInStrip = ['gz28', 'gz2otis', 'gz6', 'gzgf'].includes(props.variant);\n        const psdDy = ((variant: PanelTypeGZMTR | PanelTypeShmetro) => {\n            switch (variant) {\n                case 'gz1':\n                case 'gz3':\n                    return '82px';\n                case 'gz4':\n                    return '65px';\n                case 'gz5':\n                    return '80px';\n                case 'gz1421':\n                    return '62px';\n                default:\n                    return '58px';\n            }\n        })(props.variant);\n\n        return (\n            <g\n                textAnchor=\"middle\"\n                fill={isInStrip ? MonoColour.black : 'var(--rmg-theme-fg)'}\n                style={{\n                    ['--psd-dy' as any]: psdDy,\n                    transform: 'translate(var(--translate-x), var(--translate-y))',\n                    ['--translate-x' as any]: 'calc(var(--rmg-svg-width) / 2 + 80px)',\n                    ['--translate-y' as any]: 'calc(var(--rmg-svg-height) - var(--psd-dy, 58px))',\n                }}\n            >\n                <rect height={40} width={40} rx={4} x={-20} fill={isInStrip ? '#fff' : 'var(--rmg-theme-colour)'} />\n                <text className=\"rmg-name__en\" fontSize={20} dy={12}>\n                    {props.isShowPSD}\n                </text>\n                <text className=\"rmg-name__zh\" fontSize={12} dy={26}>\n                    屏蔽门\n                </text>\n                <text className=\"rmg-name__en\" fontSize={6.5} dy={36}>\n                    Screen Door\n                </text>\n            </g>\n        );\n    },\n    (prevProps, nextProps) => prevProps.variant === nextProps.variant && prevProps.isShowPSD === nextProps.isShowPSD\n);\n","import React from 'react';\n\nconst StationNumberText = (props: { lineNum: string; stnNum: string } & React.SVGProps<SVGGElement>) => {\n    const { lineNum, stnNum, ...others } = props;\n\n    const LINE_NUM_MAX_WIDTH = 15.03125;\n\n    const lineNumEl = React.useRef<SVGTextElement | null>(null);\n    const [bBox, setBBox] = React.useState({ width: LINE_NUM_MAX_WIDTH } as DOMRect);\n    React.useEffect(() => setBBox(lineNumEl.current!.getBBox()), [lineNum]);\n\n    const lineNumScale = bBox.width > LINE_NUM_MAX_WIDTH ? LINE_NUM_MAX_WIDTH / bBox.width : 1;\n    const stnNumScale = lineNum.length === 2 ? lineNumScale : 1;\n\n    return (\n        <g textAnchor=\"middle\" fontSize={13.5} {...others}>\n            {React.useMemo(\n                () => (\n                    <>\n                        <g transform={`translate(-9.25,0)scale(${lineNumScale})`}>\n                            <text ref={lineNumEl} className=\"rmg-name__zh\">\n                                {lineNum}\n                            </text>\n                        </g>\n                        <g transform={`translate(9.25,0)scale(${stnNumScale})`}>\n                            <text className=\"rmg-name__zh\">{stnNum}</text>\n                        </g>\n                    </>\n                ),\n                // eslint-disable-next-line react-hooks/exhaustive-deps\n                [bBox.width, lineNum, stnNum]\n            )}\n        </g>\n    );\n};\n\nexport default StationNumberText;\n"],"sourceRoot":""}