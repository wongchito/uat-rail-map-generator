{"version":3,"file":"static/js/1928.ff34b481.chunk.js","mappings":"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","sources":["svgs/indoor/station-shmetro.tsx","svgs/railmap/main/loop/loop-shmetro.tsx","svgs/railmap/main/station/station-shmetro.tsx","svgs/railmap/methods/share.ts","svgs/railmap/methods/shmetro-loop.ts"],"sourcesContent":["import React from 'react';\nimport { InterchangeInfo, Name, Services } from '../../constants/constants';\nimport { useAppSelector } from '../../redux';\n\nexport type NameDirection = 'upward' | 'downward' | 'left' | 'right';\n\ninterface Props {\n    stnId: string;\n    nameDirection: NameDirection;\n    services: Services[];\n}\n\nexport const StationSHMetro = (props: Props) => {\n    const param = useAppSelector(store => store.param);\n    const stnInfo = param.stn_list[props.stnId];\n\n    let stationIconStyle = '';\n    if (stnInfo.services.length === 3) stationIconStyle = 'direct_indoor_sh';\n    else if (stnInfo.services.length === 2) stationIconStyle = 'express_indoor_sh';\n    else if ([...stnInfo.transfer.info[0], ...(stnInfo.transfer.info[1] || [])].length > 0)\n        stationIconStyle = 'int2_indoor_sh';\n    else stationIconStyle = 'stn_indoor_sh';\n\n    return (\n        <>\n            <StationNameGElement\n                name={stnInfo.name}\n                infos={stnInfo.transfer.info}\n                nameDirection={props.nameDirection}\n                services={props.services}\n            />\n            <use xlinkHref={`#${stationIconStyle}`} stroke=\"var(--rmg-theme-colour)\" />\n            {/* This should be in IntBoxGroupProps, put here because the station icon will cover this */}\n            {stnInfo.services.length > 1 && (\n                <text className=\"rmg-name__zh\" writingMode=\"tb\" fontSize=\"60%\" dy=\"-12\">\n                    {`大站车${stnInfo.services.length > 2 ? ' 直达车' : ''}停靠`}\n                </text>\n            )}\n        </>\n    );\n};\n\nexport default StationSHMetro;\n\ninterface StationNameGElementProps {\n    name: Name;\n    infos: InterchangeInfo[][];\n    nameDirection: NameDirection;\n    services: Services[];\n}\n\nconst StationNameGElement = (props: StationNameGElementProps) => {\n    const { name, infos, nameDirection, services } = props;\n    const dy = { upward: 60, downward: -30, left: 0, right: 0 }[nameDirection];\n    return (\n        <g transform={`translate(0,${dy})`}>\n            {nameDirection === 'upward' || nameDirection === 'downward' ? (\n                <>\n                    <line\n                        x1={-30}\n                        x2={30}\n                        y1={nameDirection === 'upward' ? -23 : -10}\n                        y2={nameDirection === 'upward' ? -23 : -10}\n                        stroke=\"black\"\n                    />\n                    <line\n                        y1={nameDirection === 'upward' ? -23 : -10}\n                        y2={nameDirection === 'upward' ? -23 - 25 : 20}\n                        stroke=\"black\"\n                    />\n                </>\n            ) : (\n                <line\n                    x1={nameDirection === 'left' ? -100 : 15}\n                    x2={nameDirection === 'left' ? -15 : 100}\n                    y1={0}\n                    y2={0}\n                    stroke=\"black\"\n                />\n            )}\n\n            {[...infos[0], ...(infos[1] || [])].length > 0 && (\n                <IntBoxGroup\n                    intInfos={[...infos[0], ...(infos[1] || [])]}\n                    arrowDirection={nameDirection}\n                    services={services}\n                />\n            )}\n\n            <StationName stnName={name} nameDirection={nameDirection} fill=\"black\" />\n\n            {infos[1]?.length > 0 && (\n                <g transform={`translate(0,${nameDirection === 'upward' ? -185 : 150})`}>\n                    <OSIText osiInfos={infos[1]} />\n                </g>\n            )}\n\n            {infos[2]?.length > 0 && (\n                <g\n                    transform={`translate(0,${\n                        nameDirection === 'upward'\n                            ? infos[1]?.length\n                                ? -210\n                                : infos[0].length\n                                ? -180\n                                : -100\n                            : (infos[1]?.length ? 190 : infos[0].length ? 160 : 75) + (services.length === 3 ? 40 : 0)\n                    })`}\n                >\n                    <OSysIText osysiInfos={infos[2]} />\n                </g>\n            )}\n        </g>\n    );\n};\n\nconst StationName = React.forwardRef(\n    (\n        props: { stnName: Name; nameDirection: NameDirection } & React.SVGProps<SVGGElement>,\n        ref: React.Ref<SVGGElement>\n    ) => {\n        const { stnName, nameDirection, ...others } = props;\n        const name = stnName[0].split('\\\\');\n        const nameENLn = stnName[1].split('\\\\').length;\n        // TODO: set text-anchor on left and right\n        const dx = { upward: 0, downward: 0, left: -75, right: 75 }[nameDirection];\n        const dy = { upward: -2, downward: -30 - 12 * (nameENLn - 1), left: -15, right: -15 }[nameDirection];\n\n        return (\n            <g ref={ref} {...others} textAnchor=\"middle\" transform={`translate(${dx},${dy})`}>\n                {React.useMemo(\n                    () => (\n                        <>\n                            {name.map((txt, i, array) => (\n                                <text\n                                    key={i}\n                                    className=\"rmg-name__zh\"\n                                    dy={nameDirection === 'upward' ? 16 * i : (array.length - 1 - i) * -16}\n                                >\n                                    {txt}\n                                </text>\n                            ))}\n                            <g fontSize={9.6}>\n                                {stnName[1].split('\\\\').map((txt, i) => (\n                                    <text\n                                        key={i}\n                                        className=\"rmg-name__en\"\n                                        dy={\n                                            12 * (i + 1) +\n                                            (nameDirection === 'upward' ? (name.length > 1 ? name.length * 7.5 : 0) : 0)\n                                        }\n                                    >\n                                        {txt}\n                                    </text>\n                                ))}\n                            </g>\n                        </>\n                    ),\n                    // eslint-disable-next-line react-hooks/exhaustive-deps\n                    [...stnName]\n                )}\n            </g>\n        );\n    }\n);\n\ninterface IntBoxGroupProps {\n    intInfos: InterchangeInfo[];\n    arrowDirection: NameDirection;\n    services: Services[];\n}\n\nconst IntBoxGroup = (props: IntBoxGroupProps & React.SVGProps<SVGGElement>) => {\n    const { intInfos, arrowDirection, services } = props;\n\n    // name each different linearGradient that will fill the arrow\n    const intNameId = intInfos.map(intInfo => intInfo[2]).reduce((name, color) => name + color, '');\n\n    // get the interchange line names\n    const lineNames = [\n        intInfos\n            .filter(intInfo => intInfo[4].match(/^\\d+.*$/))\n            .map(intInfo => intInfo[4].replace(/^(\\d+)(.*)$/, '$1'))\n            .join('，')\n            .concat('号线'),\n        intInfos\n            .filter(intInfo => !intInfo[4].match(/^\\d+.*$/))\n            .map(intInfo => intInfo[4])\n            .join('，'),\n    ]\n        .filter(name => name && name !== '号线')\n        .join('，');\n    const lineNamesEn = [\n        'Line '.concat(\n            intInfos\n                .filter(intInfo => intInfo[5].match(/^L|line$/))\n                .map(intInfo => intInfo[5].replace('Line', '').replace('line', '').trim())\n                .join(',')\n        ),\n        intInfos\n            .filter(intInfo => !intInfo[5].match(/^L|line$/))\n            .map(intInfo => intInfo[5])\n            .join('，'),\n    ]\n        .filter(name => name && name !== 'Line ')\n        .join(',');\n\n    // for services contains three level (normal, express, direct)\n    // additional length is required on transfer arrow otherwise\n    // the station icon will be longer than the arrow itself\n    const arrowLength = services.length === 3 ? 80 : 45;\n    const transferDy = arrowDirection === 'upward' ? -145 : 125 + (services.length === 3 ? 40 : 0);\n\n    return (\n        <g>\n            <path\n                id=\"int_indoor_arrow_sh\"\n                stroke=\"var(--rmg-black)\"\n                strokeWidth={1}\n                transform={`translate(0,${arrowDirection === 'upward' ? -74 : 44})rotate(${\n                    arrowDirection === 'upward' ? 0 : 180\n                })`}\n                fill={intInfos.length === 1 ? intInfos[0][2] : `url(#grad${intNameId})`}\n                d={`M -7.5,0 v -${arrowLength} h -7.5 l 15,-15 l 15,15 h -7.5 v ${arrowLength} Z`}\n            />\n\n            {intInfos.length > 1 && (\n                <>\n                    <linearGradient\n                        id={`grad${intNameId}`}\n                        y1=\"0\"\n                        y2=\"0\"\n                        x1={arrowDirection === 'upward' ? '25%' : '75%'}\n                        x2={arrowDirection === 'upward' ? '75%' : '25%'}\n                    >\n                        {intInfos.map((intInfo, i) => (\n                            <React.Fragment key={i}>\n                                {/* more about React.Fragment on https://stackoverflow.com/a/59390967 */}\n                                <stop // start from\n                                    offset={`${(100 / intInfos.length) * (i + 0)}%`}\n                                    stopColor={intInfo[2]}\n                                />\n                                <stop // to\n                                    offset={`${(100 / intInfos.length) * (i + 1)}%`}\n                                    stopColor={intInfo[2]}\n                                />\n                            </React.Fragment>\n                        ))}\n                    </linearGradient>\n\n                    {/* a range inplementation [0, 1, 2 ... intInfos.length - 1] */}\n                    {/* {[...Array(intInfos.length - 1).keys()].map(i => (<line\n                        x1={-7.5 + (15 / intInfos.length) * (i + 1)}\n                        x2={-7.5 + (15 / intInfos.length) * (i + 1)}\n                        y1=\"-74\"\n                        y2={-104 - 7.5 - 7.5 / (intInfos.length - 1) * (i+1)}\n                        stroke=\"black\"\n                    />))} */}\n                </>\n            )}\n\n            <g transform={`translate(0,${transferDy})`} textAnchor=\"middle\">\n                <text className=\"rmg-name__zh\" dy={-7}>\n                    {`换乘${lineNames}`}\n                </text>\n                <text className=\"rmg-name__en\" dy={5} fontSize={9.6}>\n                    {`Interchange ${lineNamesEn}`}\n                </text>\n            </g>\n        </g>\n    );\n};\n\nconst OSIText = (props: { osiInfos: InterchangeInfo[] }) => {\n    return React.useMemo(\n        () => (\n            <g textAnchor=\"middle\" fontSize=\"50%\">\n                <text className=\"rmg-name__zh\" dy={-5}>\n                    {`换乘${props.osiInfos.map(info => info[4]).join('，')}`}\n                </text>\n                <text className=\"rmg-name__zh\" dy={5}>\n                    仅限公共交通卡\n                </text>\n                <text className=\"rmg-name__en\" dy={12.5} fontSize=\"75%\">\n                    Only for Public Transportation Card\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.osiInfos.toString()]\n    );\n};\n\nconst OSysIText = (props: { osysiInfos: InterchangeInfo[] }) => {\n    return React.useMemo(\n        () => (\n            <g textAnchor=\"middle\">\n                <text className=\"rmg-name__zh\" dy={-5}>\n                    {`转乘${props.osysiInfos.map(info => info[4]).join('，')}`}\n                </text>\n                <text className=\"rmg-name__en\" dy={7.5} fontSize={9.6}>\n                    {`To ${props.osysiInfos.map(info => info[5]).join(', ')}`}\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.osysiInfos.toString()]\n    );\n};\n","import React from 'react';\nimport StationSHMetro from '../station/station-shmetro';\nimport { NameDirection, StationSHMetro as StationSHMetroIndoor } from '../../../indoor/station-shmetro';\nimport { Services } from '../../../../constants/constants';\nimport { useAppSelector } from '../../../../redux';\nimport { split_loop_stns, LoopStns, get_xshares_yshares_of_loop } from '../../methods/shmetro-loop';\n\nconst LoopSHMetro = (props: { bank_angle: boolean }) => {\n    const { bank_angle } = props;\n    const { branches } = useAppSelector(store => store.helper);\n    const {\n        current_stn_idx: current_stn_id,\n        svgWidth: svg_width,\n        svg_height,\n        padding,\n        direction,\n        loop_info,\n    } = useAppSelector(store => store.param);\n    const { left_and_right_factor, bottom_factor } = loop_info;\n\n    const loopline = branches[0].filter(stn_id => !['linestart', 'lineend'].includes(stn_id));\n\n    const loop_stns = split_loop_stns(loopline, current_stn_id, bottom_factor, left_and_right_factor);\n\n    const { x_shares, y_shares } = get_xshares_yshares_of_loop(loopline, loop_stns);\n    loopline.forEach(stn_id => {\n        // normalization\n        x_shares[stn_id] = (x_shares[stn_id] + 1) / 2;\n        y_shares[stn_id] = (y_shares[stn_id] + 1) / 2;\n    });\n\n    const width = bank_angle ? svg_width.railmap : svg_width.indoor;\n    const line_xs = [\n        (width * padding) / 100 + (bank_angle ? 50 : 0),\n        width * (1 - padding / 100) - (bank_angle ? 50 : 0),\n    ];\n    const xs = Object.keys(x_shares).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: line_xs[0] + x_shares[cur] * (line_xs[1] - line_xs[0]),\n        }),\n        {} as typeof x_shares\n    );\n    const line_ys = [175, svg_height - 75 - (bank_angle ? 0 : 125)] as [number, number];\n    const ys = Object.keys(x_shares).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: line_ys[0] + y_shares[cur] * (line_ys[1] - line_ys[0]),\n        }),\n        {} as typeof y_shares\n    );\n\n    // bank the right, bottom, left side if bank_angle\n    const bank = (bank_angle ? { l: 1, r: -1 }[direction] : 0) as -1 | 0 | 1;\n    [...loop_stns.right, ...loop_stns.left].forEach(stn_id => {\n        xs[stn_id] -= (ys[stn_id] - line_ys[0]) * bank;\n    });\n    loop_stns.bottom.forEach(stn_id => {\n        xs[stn_id] -= (line_ys[1] - line_ys[0]) * bank;\n    });\n\n    const path = _linePath(loop_stns, xs, ys, bank, line_ys);\n\n    return (\n        <>\n            <g id=\"loop\" transform={`translate(${bank * 150},0)`}>\n                <path stroke=\"var(--rmg-theme-colour)\" strokeWidth={12} fill=\"none\" d={path} strokeLinejoin=\"round\" />\n                <LoopStationGroup bank_angle={bank_angle} loop_stns={loop_stns} xs={xs} ys={ys} />\n            </g>\n        </>\n    );\n};\n\nexport default LoopSHMetro;\n\nexport const _linePath = (\n    loop_stns: LoopStns,\n    xs: { [stn_id: string]: number },\n    ys: { [stn_id: string]: number },\n    bank: -1 | 0 | 1,\n    line_ys: [number, number] // get Y_BOTTOM when no stations at bottom\n) => {\n    const [Y_TOP, Y_BOTTOM] = line_ys;\n\n    // calculate the corner point when two sides needs to be joined\n    const corner = (prev_x: number, prev_y: number, x: number, y: number, side: keyof LoopStns): [number, number] => {\n        return {\n            right: [x + (y - Y_TOP) * bank, prev_y] as [number, number],\n            bottom: [prev_x - (Y_BOTTOM - prev_y) * bank, y] as [number, number],\n            left: [x - (Y_BOTTOM - y) * bank, prev_y] as [number, number],\n            top: [prev_x + (prev_y - Y_TOP) * bank, y] as [number, number],\n        }[side];\n    };\n\n    const stn_pos = [] as [number, number][];\n    loop_stns.top.forEach(stn_id => {\n        stn_pos.push([xs[stn_id], ys[stn_id]]);\n    });\n    (['right', 'bottom', 'left'] as Exclude<keyof LoopStns, 'top'>[]).forEach(side => {\n        if (loop_stns[side].length > 0) {\n            stn_pos.push(\n                corner(stn_pos.at(-1)![0], stn_pos.at(-1)![1], xs[loop_stns[side][0]], ys[loop_stns[side][0]], side)\n            );\n            loop_stns[side].forEach(stn_id => {\n                stn_pos.push([xs[stn_id], ys[stn_id]]);\n            });\n        } else {\n            // simulate a fake station on the side\n            // this station in fact lays on the previous side with an extra_e dx\n            const extra_e = 100;\n            const extra = {\n                right: [stn_pos.at(-1)![0] + extra_e, stn_pos.at(-1)![1]] as [number, number],\n                bottom: [\n                    stn_pos.at(-1)![0] + (Y_BOTTOM - stn_pos.at(-1)![1]) * -bank,\n                    stn_pos.at(-1)![1] + (Y_BOTTOM - stn_pos.at(-1)![1]),\n                ] as [number, number],\n                left: [stn_pos.at(-1)![0] - extra_e, stn_pos.at(-1)![1]] as [number, number],\n            };\n            stn_pos.push(extra[side]);\n        }\n    });\n    stn_pos.push(corner(stn_pos.at(-1)![0], stn_pos.at(-1)![1], xs[loop_stns.top[0]], ys[loop_stns.top[0]], 'top'));\n\n    const path = stn_pos\n        .slice(1)\n        .map(([x, y]) => `L${x},${y}`)\n        .join(' ');\n    return `M${stn_pos[0][0]},${stn_pos[0][1]} ${path} Z`;\n};\n\nconst LoopStationGroup = (props: {\n    bank_angle: boolean;\n    loop_stns: LoopStns;\n    xs: {\n        [k: string]: number;\n    };\n    ys: {\n        [k: string]: number;\n    };\n}) => {\n    const { bank_angle, loop_stns, xs, ys } = props;\n\n    const railmap_bank: Record<keyof LoopStns, -1 | 0 | 1> = {\n        top: 0,\n        bottom: 0,\n        left: -1,\n        right: 1,\n    };\n    const railmap_direction: Record<keyof LoopStns, 'l' | 'r' | undefined> = {\n        left: 'r',\n        right: 'l',\n        top: undefined,\n        bottom: undefined,\n    };\n    const indoor_name_direction = (side: keyof LoopStns, i: number) =>\n        ({\n            top: i % 2 === 0 ? 'upward' : 'downward',\n            bottom: i % 2 === 0 ? 'upward' : 'downward',\n            left: 'left',\n            right: 'right',\n        }[side] as NameDirection);\n    return (\n        <g id=\"loop_stations\">\n            {bank_angle\n                ? Object.entries(loop_stns).map(([side, stn_ids]) =>\n                      stn_ids.map(stn_id => (\n                          <g key={stn_id} transform={`translate(${xs[stn_id]},${ys[stn_id]})`}>\n                              <StationSHMetro\n                                  stnId={stn_id}\n                                  stnState={1}\n                                  bank={railmap_bank[side as keyof LoopStns]}\n                                  direction={railmap_direction[side as keyof LoopStns]}\n                              />\n                          </g>\n                      ))\n                  )\n                : Object.entries(loop_stns).map(([side, stn_ids]) =>\n                      stn_ids.map((stn_id, i) => (\n                          <g key={stn_id} transform={`translate(${xs[stn_id]},${ys[stn_id]})`}>\n                              <StationSHMetroIndoor\n                                  stnId={stn_id}\n                                  nameDirection={indoor_name_direction(side as keyof LoopStns, i)}\n                                  services={[Services.local]}\n                              />\n                          </g>\n                      ))\n                  )}\n        </g>\n    );\n};\n","import React, { useRef, memo } from 'react';\nimport { InterchangeInfo, Name, Facilities, ColourHex } from '../../../../constants/constants';\nimport { useAppSelector } from '../../../../redux';\n\ninterface Props {\n    stnId: string;\n    stnState: -1 | 0 | 1;\n    color?: ColourHex; // Control the station color if coline is in effect.\n    bank?: -1 | 0 | 1; // Loopline requires station element to be horizontal. Default to 0 (no bank to other side).\n    direction?: 'l' | 'r'; // Loopline requires station element to change direction. Default to current param.\n}\n\nconst StationSHMetro = (props: Props) => {\n    const { stnId, stnState, color, bank: bank_, direction: direction_override } = props;\n    const { direction: direction_param, info_panel_type, stn_list } = useAppSelector(store => store.param);\n    const stnInfo = stn_list[stnId];\n    const direction = direction_override ?? direction_param;\n\n    // shift station name if the line bifurcate here\n    const branchNameDX =\n        ([...stnInfo.branch.left, ...stnInfo.branch.right].length ? 8 + 12 * stnInfo.name[1].split('\\\\').length : 0) *\n        (direction === 'r' ? -1 : 1);\n\n    let stationIconStyle = '';\n    let stationIconColor: { [pos: string]: string } = {};\n    if (info_panel_type === 'sh2020') {\n        if (stnInfo.services.length === 3) stationIconStyle = 'stn_sh_2020_direct';\n        else if (stnInfo.services.length === 2) stationIconStyle = 'stn_sh_2020_express';\n        else stationIconStyle = 'stn_sh_2020';\n        stationIconColor.fill = stnState === -1 ? 'gray' : color ? color : 'var(--rmg-theme-colour)';\n    } else {\n        // param.info_panel_type === 'sh' or others (from other styles)\n        if (stnInfo.services.length === 3) stationIconStyle = 'direct_sh';\n        else if (stnInfo.services.length === 2) stationIconStyle = 'express_sh';\n        else if ([...stnInfo.transfer.info[0], ...(stnInfo.transfer.info[1] || [])].length > 0)\n            stationIconStyle = 'int2_sh';\n        else stationIconStyle = 'stn_sh';\n        stationIconColor.stroke = stnState === -1 ? 'gray' : color ? color : 'var(--rmg-theme-colour)';\n    }\n\n    const bank = bank_ ?? 0;\n    const dx = (direction === 'l' ? 6 : -6) + branchNameDX + bank * 30;\n    const dy = (info_panel_type === 'sh2020' ? -20 : -6) + Math.abs(bank) * (info_panel_type === 'sh2020' ? 25 : 11);\n    const dr = bank ? 0 : direction === 'l' ? -45 : 45;\n    return (\n        <>\n            <use\n                xlinkHref={`#${stationIconStyle}`}\n                {...stationIconColor} // different styles use either `fill` or `stroke`\n                // sh and sh2020 have different headings of int_sh, so -1 | 1 is multiplied\n                transform={\n                    `translate(${bank * (info_panel_type === 'sh2020' ? 5 : 0)},0)` +\n                    `rotate(${bank * 90 * (info_panel_type === 'sh2020' ? 1 : -1)})`\n                }\n            />\n            <g transform={`translate(${dx},${dy})rotate(${dr})`}>\n                <StationNameGElement\n                    name={stnInfo.name}\n                    infos={stnInfo.transfer.info}\n                    stnState={stnState}\n                    direction={direction}\n                    facility={stnInfo.facility}\n                    bank={bank}\n                />\n            </g>\n        </>\n    );\n};\n\nexport default StationSHMetro;\n\ninterface StationNameGElementProps {\n    name: Name;\n    infos: InterchangeInfo[][];\n    stnState: -1 | 0 | 1;\n    direction: 'l' | 'r';\n    facility: Facilities;\n    bank: -1 | 0 | 1;\n}\n\nconst StationNameGElement = (props: StationNameGElementProps) => {\n    const { name, infos, stnState, direction, facility, bank } = props;\n    const nameENLn = props.name[1].split('\\\\').length;\n\n    // get the exact station name width so that the\n    // interchange station icon can be right after the station name\n    const stnNameEl = useRef<SVGGElement | null>(null);\n    // the original name position\n    const [bBox, setBBox] = React.useState({ width: 0 } as DOMRect);\n    React.useEffect(\n        () => setBBox(stnNameEl.current!.getBBox()),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [...name]\n    );\n    // the original name position's right x\n    const x = bBox.width + 5;\n\n    // rotate the station info now\n    // other wise the bcr will be inaccurate due to the rotation\n    // Chito: so, use BBox instead\n\n    // simplify the calculation times\n    const directionPolarity = direction === 'l' ? 1 : -1;\n\n    // main elements icon's dx will change if there is a facility icon or not\n    const mainDx = facility !== Facilities.none ? 30 : 0;\n\n    // interchange will have a line under the name, and should be stretched when placed horizontal in loop\n    const lineDx = bank ? -12 : 0;\n\n    return (\n        <>\n            {infos.flat().length > 0 && (\n                <>\n                    <line\n                        x1={(lineDx + mainDx) * directionPolarity}\n                        x2={(mainDx + x) * directionPolarity}\n                        stroke={stnState === -1 ? 'gray' : 'black'}\n                        strokeWidth={0.5}\n                    />\n                    <IntBoxGroup\n                        intInfos={infos}\n                        transform={`translate(${(mainDx + x) * directionPolarity},-10.75)`}\n                        direction={direction}\n                    />\n                </>\n            )}\n\n            {facility !== Facilities.none && <use xlinkHref={'#' + facility} x={10 * directionPolarity} y={-30} />}\n\n            <g\n                textAnchor={direction === 'l' ? 'start' : 'end'}\n                transform={`translate(${mainDx * directionPolarity},${-14.15625 - 2 - 12 * (nameENLn - 1)})`}\n            >\n                <StationName\n                    ref={stnNameEl}\n                    stnName={name}\n                    fill={stnState === -1 ? 'gray' : stnState === 0 ? 'red' : 'black'}\n                />\n\n                {/* deal out-of-station here as it is a y axis element. leave out-of-system in IntBoxGroup*/}\n                {infos[1]?.length > 0 && (\n                    <g\n                        transform={`translate(${\n                            (x + infos.reduce((sum, infos) => sum + infos.length, 0) * 15) * directionPolarity\n                        },-30)`}\n                    >\n                        <OSIText osiInfos={infos[1]} />\n                    </g>\n                )}\n            </g>\n        </>\n    );\n};\n\nconst StationName = React.forwardRef(\n    (props: { stnName: Name } & React.SVGProps<SVGGElement>, ref: React.Ref<SVGGElement>) => {\n        const { stnName, ...others } = props;\n\n        return (\n            <g ref={ref} {...others}>\n                {React.useMemo(\n                    () => (\n                        <>\n                            {stnName[0].split('\\\\').map((txt, i, array) => (\n                                <text key={i} className=\"rmg-name__zh\" dy={(array.length - 1 - i) * -15}>\n                                    {txt}\n                                </text>\n                            ))}\n                            <g fontSize={9.6}>\n                                {stnName[1].split('\\\\').map((txt, i) => (\n                                    <text key={i} className=\"rmg-name__en\" dy={12 * (i + 1)}>\n                                        {txt}\n                                    </text>\n                                ))}\n                            </g>\n                        </>\n                    ),\n                    // eslint-disable-next-line react-hooks/exhaustive-deps\n                    [...stnName]\n                )}\n            </g>\n        );\n    }\n);\n\nconst IntBoxGroup = (props: { intInfos: InterchangeInfo[][]; direction: 'l' | 'r' } & React.SVGProps<SVGGElement>) => {\n    const { intInfos, direction, ...others } = props;\n\n    // also known as non out-of-system transfers\n    const boxInfos = [\n        ...intInfos[0],\n        ...(intInfos[1] || []),\n        // some dirty tricks here as shmetro shows maglev icon even it is a out-of-system transfer\n        // and display a maglev icon is much easier in boxInfos than in OSysIText\n        ...(intInfos[2]?.filter(info => Boolean(info[4].match(/^磁(悬)*浮/))) || []),\n    ];\n\n    let dx = 0; // update in every boxInfos\n\n    return (\n        <g fontSize={14} textAnchor=\"middle\" {...others}>\n            {boxInfos.map((info, i) => {\n                const isLineNumber = Boolean(info[4].match(/^\\d.*$/));\n                const isMaglev = Boolean(info[4].match(/^磁(悬)*浮/));\n\n                if (props.direction === 'r') {\n                    dx -= (isLineNumber || isMaglev ? 20 : info[4].length * 14 + 12 + 0) + (i === 0 ? 0 : 5);\n                }\n\n                let el = <g />;\n                if (isMaglev) {\n                    el = (\n                        <g transform={`translate(${dx},-16)scale(0.1428571429)`} key={i}>\n                            <IntBoxMaglev info={info} />\n                        </g>\n                    );\n                } else if (isLineNumber) {\n                    el = (\n                        <g transform={`translate(${dx},0)`} key={i}>\n                            <IntBoxNumber info={info} />\n                        </g>\n                    );\n                } else {\n                    el = (\n                        <g transform={`translate(${dx},0)`} key={i}>\n                            <IntBoxLetter info={info} />\n                        </g>\n                    );\n                }\n\n                if (props.direction === 'l') {\n                    dx += isLineNumber || isMaglev ? 20 + 5 : info[4].length * 14 + 12 + 5;\n                }\n                return el;\n            })}\n\n            {[...(intInfos[2] || [])].length > 0 && (\n                <g transform={`translate(${dx - (props.direction === 'r' ? 5 : 0)},0)`} key={boxInfos.length + 1}>\n                    <OSysIText osysiInfos={intInfos[2]} direction={props.direction} />\n                </g>\n            )}\n        </g>\n    );\n};\n\nconst IntBoxMaglev = memo(\n    (props: { info: InterchangeInfo }) => (\n        <>\n            <use xlinkHref=\"#intbox_maglev\" fill={props.info[2]} stroke={props.info[2]} />\n        </>\n    ),\n    (prevProps, nextProps) => prevProps.info.toString() === nextProps.info.toString()\n);\n\nconst IntBoxNumber = memo(\n    (props: { info: InterchangeInfo }) => (\n        <>\n            <use xlinkHref=\"#intbox_number\" fill={props.info[2]} />\n            <text x={10} className=\"rmg-name__zh\" fill={props.info[3]} dominantBaseline=\"central\">\n                {/* // line starts with numbers */}\n                {props.info[4].match(/(\\d*)\\w+/)![0]}\n            </text>\n        </>\n    ),\n    (prevProps, nextProps) => prevProps.info.toString() === nextProps.info.toString()\n);\n\nconst IntBoxLetter = memo(\n    (props: { info: InterchangeInfo }) => {\n        // box width: 16 * number of characters + 12\n        const textCount = props.info[4].split('\\\\')[0].length;\n        return (\n            <>\n                <rect height={22} width={textCount * 14 + 12} y={-11} fill={props.info[2]} />\n                <text x={textCount * 7 + 6} className=\"rmg-name__zh\" fill={props.info[3]} dominantBaseline=\"central\">\n                    {props.info[4].split('\\\\')[0]}\n                </text>\n            </>\n        );\n    },\n    (prevProps, nextProps) => prevProps.info.toString() === nextProps.info.toString()\n);\n\nconst OSIText = (props: { osiInfos: InterchangeInfo[] }) => {\n    // get the all names from the out of station interchanges\n    const lineNames = props.osiInfos.map(info => info[4]).join('，');\n    return React.useMemo(\n        () => (\n            <g textAnchor=\"middle\" fontSize=\"50%\">\n                <text className=\"rmg-name__zh\" dy={-5}>\n                    {`换乘${lineNames}`}\n                </text>\n                <text className=\"rmg-name__zh\" dy={5}>\n                    仅限公共交通卡\n                </text>\n                <text className=\"rmg-name__en\" dy={12.5} fontSize=\"75%\">\n                    Only for Public Transportation Card\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [lineNames.toString()]\n    );\n};\n\nconst OSysIText = (props: { osysiInfos: InterchangeInfo[]; direction: 'l' | 'r' }) => {\n    // get the all names from out of system transfers\n    const lineNames = props.osysiInfos.map(info => info[4]).join('，');\n    const lineNamesEn = props.osysiInfos.map(info => info[5]).join(', ');\n\n    return React.useMemo(\n        () => (\n            <g textAnchor={props.direction === 'l' ? 'start' : 'end'} fontSize=\"50%\">\n                <text className=\"rmg-name__zh\" dy={3}>\n                    转乘{lineNames}\n                </text>\n                <text className=\"rmg-name__en\" dy={10} fontSize=\"75%\">\n                    To {lineNamesEn}\n                </text>\n            </g>\n        ),\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        [props.osysiInfos.toString(), props.direction]\n    );\n};\n","import * as Global from '../../../methods';\nimport { RMGParam, ShortDirection, StationDict, StationInfo } from '../../../constants/constants';\n\n/**\n * Compute the adjacency list of the graph.\n * @param stnList Key-value pairs of station info\n * @param leftW Callback of left wide factor\n * @param rightW Callback of right wide factor\n */\nexport const adjacencyList = (\n    stnList: { [stnId: string]: StationInfo },\n    leftW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number,\n    rightW: (stnList: { [stnId: string]: StationInfo }, stnId: string) => number\n) => {\n    return Object.keys(stnList).reduce(\n        (acc, cur) => ({\n            ...acc,\n            [cur]: stnList[cur].children.reduce(\n                (a, c) => ({ ...a, [c]: 1 + leftW(stnList, c) + rightW(stnList, cur) }),\n                {}\n            ),\n        }),\n        {} as { [from: string]: { [to: string]: number } }\n    );\n};\n\n/**\n * Compute critical path and its length from `from` node to `to` node with critical path method.\n * @param from ID of station on the left\n * @param to ID of station on the right\n * @param adjMat Adjacency matrix in the form of `Object` returned from `adjacencyList` method.\n */\nexport const criticalPathMethod = (from: string, to: string, adjMat: ReturnType<typeof adjacencyList>) => {\n    if (from === to) {\n        return { len: 0, nodes: [from] };\n    }\n    let allLengths: number[] = [];\n    let criticalPaths: string[][] = [];\n    Object.keys(adjMat[from]).forEach(child => {\n        let cp = criticalPathMethod(child, to, adjMat);\n        if (cp.len < 0) return;\n        allLengths.push(adjMat[from][child] + cp.len);\n        cp.nodes.unshift(from);\n        criticalPaths.push(cp.nodes);\n    });\n    let maxLength = Math.max(...allLengths);\n    return {\n        len: maxLength,\n        nodes: criticalPaths[allLengths.indexOf(maxLength)],\n    };\n};\n\nexport const getXShareMTR = (stnId: string, adjMat: ReturnType<typeof adjacencyList>, branches: string[][]) => {\n    let criticalPath = criticalPathMethod('linestart', 'lineend', adjMat);\n    if (criticalPath.nodes.includes(stnId)) {\n        return criticalPathMethod(criticalPath.nodes[1], stnId, adjMat).len;\n    } else {\n        // must has 1 parent and 1 child only\n        let branchOfStn = branches.filter(branch => branch.includes(stnId))[0];\n\n        let partSource = stnId;\n        while (!criticalPath.nodes.includes(partSource)) {\n            partSource = branchOfStn[branchOfStn.indexOf(partSource) - 1];\n        }\n        let partSink = stnId;\n        while (!criticalPath.nodes.includes(partSink)) {\n            partSink = branchOfStn[branchOfStn.indexOf(partSink) + 1];\n        }\n\n        let leftOpenJaw = partSource === 'linestart';\n        let rightOpenJaw = partSink === 'lineend';\n\n        // expand to fit\n        let lens = [];\n        if (!leftOpenJaw && !rightOpenJaw) {\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, partSink, adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else if (leftOpenJaw) {\n            lens[0] = 0;\n            lens[1] = criticalPathMethod(criticalPath.nodes[1], partSink, adjMat).len;\n            lens[2] = criticalPathMethod(branchOfStn[1], stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, partSink, adjMat).len;\n        } else {\n            // right open jaw\n            lens[0] = criticalPathMethod(criticalPath.nodes[1], partSource, adjMat).len;\n            lens[1] = criticalPathMethod(partSource, criticalPath.nodes.slice(-2)[0], adjMat).len;\n            lens[2] = criticalPathMethod(partSource, stnId, adjMat).len;\n            lens[3] = criticalPathMethod(stnId, branchOfStn.slice(-2)[0], adjMat).len;\n        }\n        return lens[0] + (lens[2] * lens[1]) / (lens[2] + lens[3]);\n    }\n};\n\nconst getYShare = (stnId: string, stnList: { [stnId: string]: StationInfo }) => {\n    return Global.getYShareMTR(stnId, stnList);\n};\n\n/**\n * Vertical position (in pixels) of station icon related to vertical position of line.\n */\nexport const getYReal = (stnId: string, param: RMGParam) => {\n    return -getYShare(stnId, param.stn_list) * param.branch_spacing;\n};\n\nconst _isPredecessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx2 !== -1 && idx2 < idx1) return true;\n    }\n    return false;\n};\n\nconst _isSuccessor = (stnId1: string, stnId2: string, routes: string[][]) => {\n    for (let route of routes) {\n        let idx1 = route.indexOf(stnId1);\n        let idx2 = route.indexOf(stnId2);\n        if (idx1 !== -1 && idx1 < idx2) return true;\n    }\n    return false;\n};\n\nexport const getStnState = (\n    currentId: string,\n    routes: string[][],\n    direction: 'l' | 'r'\n): { [stnId: string]: -1 | 0 | 1 } => {\n    console.log(\"computing stations' states\");\n    return [...new Set(([] as string[]).concat(...routes))].reduce(\n        (acc, cur: string) => ({\n            ...acc,\n            [cur]:\n                cur === currentId\n                    ? 0\n                    : (\n                          direction === ShortDirection.right\n                              ? _isSuccessor(currentId, cur, routes)\n                              : _isPredecessor(currentId, cur, routes)\n                      )\n                    ? 1\n                    : -1,\n        }),\n        {}\n    );\n};\n\nexport class Stations {\n    yShares = {} as { [stnId: string]: number };\n    xShares = {} as { [stnId: string]: number };\n    namePoss = {} as { [stnId: string]: boolean };\n    stnList = {} as StationDict;\n    criticalPath = {} as { len: number; nodes: string[] };\n\n    constructor(data: { stnList?: any; criticalPath?: any }) {\n        this.stnList = data.stnList;\n        this.criticalPath = data.criticalPath;\n    }\n\n    /**\n     * Increment of the weight of in-bound edge of a station, which increases the horizontal interval from its parents.\n     */\n    protected leftWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Increment of the weight of out-bound edge of a station, which increases the horizontal interval from its children.\n     */\n    protected rightWideFactor = (stnId: string) => {\n        return 0;\n    };\n\n    /**\n     * Path weight from station 1 to station 2 (station 2 must be a child of station 1, otherwise return `-Infinity`).\n     */\n    public pathWeight = (stnId1: string, stnId2: string) => {\n        if (!this.stnList[stnId1].children.includes(stnId2)) {\n            return -Infinity;\n        }\n        return 1 + this.rightWideFactor(stnId1) + this.leftWideFactor(stnId2);\n    };\n\n    protected getYShare(stnId: string, branches?: string[][]): number {\n        if (stnId in this.yShares) return this.yShares[stnId];\n\n        if (\n            ['linestart', 'lineend'].includes(stnId) ||\n            this.stnList[stnId].parents.length > 1 ||\n            this.stnList[stnId].children.length > 1\n        ) {\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n        var stnPred = this.stnList[stnId].parents[0];\n        if (stnPred) {\n            // parent exist\n            if (this.stnList[stnPred].children.length === 1) {\n                // no sibling, then y same as parent\n                let res = this.getYShare(stnPred);\n                this.yShares[stnId] = res;\n                return res;\n            } else {\n                // sibling exists, then y depends on its idx of being children\n                let res: 1 | -1 = this.stnList[stnPred].children.indexOf(stnId) === 0 ? 1 : -1;\n                this.yShares[stnId] = res;\n                return res;\n            }\n        } else {\n            // no parent, must be linestart\n            this.yShares[stnId] = 0;\n            return 0;\n        }\n    }\n\n    static getYShares(stnList: StationDict, branches?: string[][]) {\n        console.log('computing y shares');\n        let stations = new this({ stnList });\n\n        Object.keys(stnList).forEach(stnId => {\n            if (['linestart', 'lineend'].includes(stnId)) return;\n            if (stnId in stations.yShares) return;\n            stations.getYShare(stnId, branches);\n        });\n\n        return stations.yShares;\n    }\n\n    /**\n     * Parameters of the arcs involved in the `<path>` element.\n     */\n    private pathTurnParams = (branchSpacing: number) => {\n        let tr = 35; // turning radius\n        let dx_a = tr / 2; // dx of a\n        let dy_a = tr - dx_a * Math.sqrt(3); // dy of a\n        let dy_l = branchSpacing - 2 * dy_a; // dy of l\n        let dx_l = dy_l * Math.sqrt(3); // dx of l\n        return { tr, dx_a, dy_a, dx_l, dy_l };\n    };\n\n    /**\n     * Path segment from a station towards its southeast (lower-right).\n     */\n    private pathTurnSE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,1 ${dx_a},${dy_a} l ${dx_l},${dy_l} a ${tr},${tr} 0 0,0 ${dx_a},${dy_a}`;\n    };\n\n    /**\n     * Path segment from a station towards its northeast (upper-right).\n     */\n    private pathTurnNE = (branchSpacing: number) => {\n        let { tr, dx_a, dy_a, dx_l, dy_l } = this.pathTurnParams(branchSpacing);\n        return `a ${tr},${tr} 0 0,0 ${dx_a},${-dy_a} l ${dx_l},${-dy_l} a ${tr},${tr} 0 0,1 ${dx_a},${-dy_a}`;\n    };\n\n    /**\n     * Generate `d` attribute of `<path>` element through all stations input.\n     */\n    protected _linePath(\n        stnIds: string[],\n        lineXs: [number, number],\n        branches: string[][],\n        realXs: { [stnId: string]: number },\n        realYs: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] },\n        e: number\n    ) {\n        var [prevId, prevY, prevX] = [] as unknown as [string, number, number];\n        var path = [] as string[];\n\n        let { dx_a, dx_l } = this.pathTurnParams(branchSpacing);\n        let stnDX = dx_a + dx_l / 2;\n        let stnExtraH = ((lineXs[1] - lineXs[0]) / cp.len) * 2;\n        let stnSpareH = ((lineXs[1] - lineXs[0]) / cp.len - 2 * stnDX) / 2;\n        if (stnSpareH + stnExtraH < 0) {\n            console.warn(`SVG width too small! ${stnSpareH + stnExtraH}`);\n        }\n\n        stnIds.forEach(stnId => {\n            let x = realXs[stnId];\n            let y = realYs[stnId];\n            if (!prevY && prevY !== 0) {\n                [prevId, prevX, prevY] = [stnId, x, y];\n                if (stnIds.length === 1) {\n                    path.push(`M ${x},${y}`);\n                } else if (!branches[0].includes(stnId)) {\n                    // started from branch\n                    path.push(`M ${x},${y}`);\n                } else if (branches[0].includes(stnIds[1])) {\n                    // started from branching station, this is main line\n                    path.push(`M ${x},${y}`);\n                } else {\n                    // started form branching station, this is branch line\n                    if (realXs[stnIds[1]] > 0) {\n                        path.push(`M ${x},${y + e}`);\n                    }\n                    if (realYs[stnIds[1]] < 0) {\n                        path.push(`M ${x},${y - e}`);\n                    }\n                }\n                return;\n            }\n            if (y > prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnSE(branchSpacing));\n            } else if (y < prevY) {\n                path.push(\n                    y === 0\n                        ? `h ${x - prevX - stnExtraH * this.leftWideFactor(stnId) - stnSpareH - stnDX * 2}`\n                        : `h ${stnExtraH * this.rightWideFactor(prevId) + stnSpareH}`\n                );\n                path.push(this.pathTurnNE(branchSpacing));\n            }\n            path.push(`H ${x}`);\n            [prevId, prevX, prevY] = [stnId, x, y];\n        });\n\n        // simplify path\n        return path.join(' ').replace(/( H ([\\d.]+))+/g, ' H $2');\n    }\n\n    static drawLine(\n        branches: string[][],\n        stnStates: { [stnId: string]: -1 | 0 | 1 },\n        stnList: { [stnId: string]: StationInfo },\n        lineXs: [number, number],\n        xs: { [stnId: string]: number },\n        ys: { [stnId: string]: number },\n        branchSpacing: number,\n        cp: { len: number; nodes: string[] },\n        e: number = 9.68\n    ) {\n        let linePaths = { main: [] as string[], pass: [] as string[] };\n        branches.forEach((branch, i) => {\n            branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n            var lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n            var linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n            if (lineMainStns.length === 1) {\n                linePassStns = branch;\n            }\n\n            if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n                // if two set disjoint\n                if (linePassStns[0] === branch[0]) {\n                    // -1 -1 1 1\n                    linePassStns.push(lineMainStns[0]);\n                } else if (\n                    lineMainStns[0] === branch[0] &&\n                    lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n                    linePassStns.length\n                ) {\n                    linePassStns = branch;\n                    lineMainStns = [];\n                } else {\n                    // 1 1 -1 -1\n                    linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n                }\n            }\n\n            linePaths.main.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    lineMainStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp,\n                    e\n                )\n            );\n            linePaths.pass.push(\n                new this({ stnList, criticalPath: cp })._linePath(\n                    linePassStns,\n                    lineXs,\n                    branches,\n                    xs,\n                    ys,\n                    branchSpacing,\n                    cp,\n                    e\n                )\n            );\n        });\n\n        return linePaths;\n    }\n}\n\nexport const drawLine = (branch: string[], stnStates: { [stnId: string]: -1 | 0 | 1 }) => {\n    branch = branch.filter(stnId => !['linestart', 'lineend'].includes(stnId));\n    let lineMainStns = branch.filter(stnId => stnStates[stnId] >= 0);\n    let linePassStns = branch.filter(stnId => stnStates[stnId] <= 0);\n\n    if (lineMainStns.length === 1) {\n        linePassStns = branch;\n    }\n\n    if (lineMainStns.filter(stnId => linePassStns.indexOf(stnId) !== -1).length === 0 && lineMainStns.length) {\n        // if two set disjoint\n        if (linePassStns[0] === branch[0]) {\n            // -1 -1 1 1\n            linePassStns.push(lineMainStns[0]);\n        } else if (\n            lineMainStns[0] === branch[0] &&\n            lineMainStns[lineMainStns.length - 1] === branch[branch.length - 1] &&\n            linePassStns.length\n        ) {\n            linePassStns = branch;\n            lineMainStns = [];\n        } else {\n            // 1 1 -1 -1\n            linePassStns.unshift(lineMainStns[lineMainStns.length - 1]);\n        }\n    }\n\n    return {\n        main: lineMainStns,\n        pass: linePassStns,\n    };\n};\n","import { ShortDirection, StationDict } from '../../../constants/constants';\n\n/**\n * Split the loopline into four sides according to left_and_right_factor and bottom_factor.\n * It assumes parameters will follow these rules:\n *     1. loopline.length > bottom_factor + left_and_right_factor * 2\n *     2. bottom_factor >= 0\n *     3. left_and_right_factor >= 0\n *     4. left_and_right_factor + bottom_factor > 0\n *\n * @param loopline The loop line aka branches[0].\n * @param current_stn_id Current station id.\n * @param bottom_factor How many stations the bottom side will have.\n * @param left_and_right_factor How many stations the left and right side will have.\n * @returns Each array returned should be consecutive, and when combined in top -> right -> bottom -> left order,\n * it will also be consecutive. Note that the length of right, bottom, and left can be 0.\n */\nexport const split_loop_stns = (\n    loopline: string[],\n    current_stn_id: string,\n    bottom_factor: number,\n    left_and_right_factor: number\n) => {\n    const top_factor = loopline.length - left_and_right_factor * 2 - bottom_factor;\n    const current_stn_idx = loopline.findIndex(val => val === current_stn_id);\n    const non_undefined_loopline = [...loopline, ...loopline, ...loopline];\n    const split_a = loopline.length + current_stn_idx - Math.floor(top_factor / 2) + (top_factor % 2 === 0 ? 1 : 0);\n    const split_b = loopline.length + current_stn_idx + Math.floor(top_factor / 2);\n    return {\n        top: non_undefined_loopline.slice(split_a, split_b + 1),\n        left: non_undefined_loopline.slice(split_a - left_and_right_factor, split_a),\n        right: non_undefined_loopline.slice(split_b + 1, split_b + 1 + left_and_right_factor),\n        bottom: non_undefined_loopline.slice(\n            split_b + 1 + left_and_right_factor,\n            split_b + 1 + left_and_right_factor + bottom_factor\n        ),\n    };\n};\n\nexport type LoopStns = ReturnType<typeof split_loop_stns>;\n\n/**\n * Calculate the xshares and yshares of the loop stations.\n *\n * @param loopline The loop line aka branches[0].\n * @param loop_stns Object returned from split_loop_stns.\n * @returns Values sit between -1 and 1.\n */\nexport const get_xshares_yshares_of_loop = (loopline: string[], loop_stns: LoopStns) => {\n    const x_shares = Object.fromEntries(loopline.map(stn_id => [stn_id, -1]));\n    const y_shares = Object.fromEntries(loopline.map(stn_id => [stn_id, -1]));\n\n    const [Y_TOP, Y_BOTTOM, X_LEFT, X_RIGHT] = [-1, 1, -1, 1];\n\n    // make sure first and last station do not position at the corner\n    const e = 0.1; // e should be smaller than 1\n\n    loop_stns.top.forEach((stn_id, i) => {\n        x_shares[stn_id] = -(1 - e) + ((2 - 2 * e) / loop_stns.top.length) * i + (1 - e) / loop_stns.top.length;\n        y_shares[stn_id] = Y_TOP;\n    });\n    loop_stns.right.forEach((stn_id, i) => {\n        x_shares[stn_id] = X_RIGHT;\n        y_shares[stn_id] = -(1 - e) + ((2 - 2 * e) / loop_stns.right.length) * i + (1 - e) / loop_stns.right.length;\n    });\n    loop_stns.bottom.forEach((stn_id, i) => {\n        x_shares[stn_id] = 1 - e - ((2 - 2 * e) / loop_stns.bottom.length) * i - (1 - e) / loop_stns.bottom.length;\n        y_shares[stn_id] = Y_BOTTOM;\n    });\n    loop_stns.left.forEach((stn_id, i) => {\n        x_shares[stn_id] = X_LEFT;\n        y_shares[stn_id] = 1 - e - ((2 - 2 * e) / loop_stns.left.length) * i - (1 - e) / loop_stns.left.length;\n    });\n\n    return {\n        x_shares: x_shares,\n        y_shares: y_shares,\n    };\n};\n\n/**\n * Get pivot stations from the loop line.\n */\nexport const get_pivot_stations = (\n    branches: string[][],\n    direction: ShortDirection,\n    stn_list: StationDict,\n    current_stn_id: string\n) => {\n    const loop_line = branches[0].filter(stn_id => !['linestart', 'lineend'].includes(stn_id));\n    const _ = [...loop_line, ...loop_line, ...loop_line];\n    const non_undefined_loop_line = direction === 'r' ? _ : _.reverse();\n    const current_stn_idx = non_undefined_loop_line.findIndex(stn_id => current_stn_id === stn_id) + loop_line.length;\n    return non_undefined_loop_line\n        .slice(current_stn_idx + 1)\n        .filter(stn_id => stn_list[stn_id].loop_pivot)\n        .slice(undefined, 2);\n};\n"],"names":["StationSHMetro","props","stnInfo","useAppSelector","store","param","stn_list","stnId","stationIconStyle","services","length","transfer","info","StationNameGElement","name","infos","nameDirection","xlinkHref","stroke","className","writingMode","fontSize","dy","upward","downward","left","right","transform","x1","x2","y1","y2","IntBoxGroup","intInfos","arrowDirection","StationName","stnName","fill","OSIText","osiInfos","OSysIText","osysiInfos","React","ref","others","split","nameENLn","dx","textAnchor","map","txt","i","array","intNameId","intInfo","reduce","color","lineNames","filter","match","replace","join","concat","lineNamesEn","trim","arrowLength","transferDy","id","strokeWidth","d","offset","stopColor","toString","bank_angle","branches","helper","current_stn_id","current_stn_idx","svg_width","svgWidth","svg_height","padding","direction","loop_info","left_and_right_factor","bottom_factor","loopline","stn_id","includes","loop_stns","split_loop_stns","get_xshares_yshares_of_loop","x_shares","y_shares","forEach","width","railmap","indoor","line_xs","xs","Object","keys","acc","cur","line_ys","ys","bank","l","r","bottom","path","_linePath","strokeLinejoin","LoopStationGroup","Y_TOP","Y_BOTTOM","corner","prev_x","prev_y","x","y","side","top","stn_pos","push","at","extra","slice","railmap_bank","railmap_direction","undefined","indoor_name_direction","entries","stnState","Services","bank_","direction_override","direction_param","info_panel_type","branchNameDX","branch","stationIconColor","Math","abs","dr","facility","stnNameEl","useRef","bBox","setBBox","current","getBBox","directionPolarity","mainDx","Facilities","lineDx","flat","sum","boxInfos","Boolean","isLineNumber","isMaglev","el","IntBoxMaglev","IntBoxNumber","IntBoxLetter","memo","prevProps","nextProps","dominantBaseline","textCount","height","adjacencyList","stnList","leftW","rightW","children","a","c","criticalPathMethod","from","to","adjMat","len","nodes","allLengths","criticalPaths","child","cp","unshift","maxLength","max","indexOf","getXShareMTR","criticalPath","branchOfStn","partSource","partSink","leftOpenJaw","lens","getStnState","currentId","routes","console","log","Set","ShortDirection","stnId1","stnId2","route","idx1","idx2","_isSuccessor","_isPredecessor","Stations","data","yShares","xShares","namePoss","leftWideFactor","rightWideFactor","pathWeight","Infinity","pathTurnParams","branchSpacing","dy_a","tr","sqrt","dy_l","dx_a","dx_l","pathTurnSE","pathTurnNE","this","parents","stnPred","res","getYShare","stnIds","lineXs","realXs","realYs","e","prevId","prevY","prevX","stnDX","stnExtraH","stnSpareH","warn","stations","stnStates","linePaths","main","pass","lineMainStns","linePassStns","drawLine","top_factor","findIndex","val","non_undefined_loopline","split_a","floor","split_b","fromEntries","get_pivot_stations","loop_line","_","non_undefined_loop_line","reverse","loop_pivot"],"sourceRoot":""}